{
  "name": "ProyectoFP",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -1904,
        6832
      ],
      "id": "416cd65c-6bdf-4bb4-8ea7-e65d104be117",
      "name": "Telegram Trigger",
      "webhookId": "4f62ba6d-f010-46d4-8604-678efc7d8b3d",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "f57a2232-8f49-4ac9-bc30-d1c25a74b6a1",
              "leftValue": "={{ $json.telegram_user }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -1616,
        6832
      ],
      "id": "d217f658-8221-4c8c-96c3-eceb2b27ca62",
      "name": "Existe?"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 92232691,
          "mode": "list",
          "cachedResultName": "Usuarios",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=92232691"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "nombre": "={{ $('Telegram Trigger').item.json.message.chat.first_name }}",
            "rol": "USUARIO",
            "permitido": "SI",
            "fecha_creacion": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "rol",
              "displayName": "rol",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "permitido",
              "displayName": "permitido",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_creacion",
              "displayName": "fecha_creacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1424,
        7056
      ],
      "id": "fb3c003a-b2b1-4418-8990-86306cc98d3b",
      "name": "Crear Usuario",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 92232691,
          "mode": "list",
          "cachedResultName": "Usuarios",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=92232691"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $json.message.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1760,
        6832
      ],
      "id": "2b95afdc-1845-45e3-b018-3cc5792af46d",
      "name": "Obtener Usuarios",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "f57a2232-8f49-4ac9-bc30-d1c25a74b6a1",
              "leftValue": "={{ $json.permitido === \"NO\"}}",
              "rightValue": 0,
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -1456,
        6720
      ],
      "id": "803bd3a3-4c0c-45ea-8e57-46e2df77446f",
      "name": "Permitido?"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_SELECCION",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}",
            "paso_actual": "0",
            "n_citas": "0",
            "n_tareas": "0",
            "n_habitos": "0"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "n_citas",
              "displayName": "n_citas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "n_tareas",
              "displayName": "n_tareas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "n_habitos",
              "displayName": "n_habitos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "tipo_lista_temporal",
              "displayName": "tipo_lista_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_item_temporal",
              "displayName": "nombre_item_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1232,
        7056
      ],
      "id": "10c2901e-0d71-41a6-bb22-3e4ddb48a207",
      "name": "Temporal",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_AGENDA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_TAREAS",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f2e74d39-8611-4160-8b40-e071a8f8be56",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "NUEVA_TAREA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "b70594e5-0143-4950-b9e7-55a0a31a26d5",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "ELIMINAR_TAREA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e818d0d0-c42e-4989-b4b5-a7d7fce3eefb",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "CAMBIAR_ESTADO",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "30c21ae0-4781-47e7-b732-6508c9a022a6",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_ADMIN",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f79ccd8b-4cc7-494b-bc36-3c64662ae483",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "CANCELAR",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "65764eaf-74d8-42a5-963b-1eee337dc0e9",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "REPROGRAMAR",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "7644a448-cf53-4b99-b436-38fb5658d72b",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "CONFIRMACION",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "45914235-baa3-426c-9098-4b66bdee1741",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "AGENDA_NUEVA_CITA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f29faeed-b1b1-4092-8ef3-82e03dbb4e15",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_CONFIG",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Configuracion"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "afac6d98-cf75-4950-b643-9c7ec3e4b166",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_HABITOS",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Habitos"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e7e87007-855a-47e8-b616-698b4e0c6126",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "NUEVO_HABITO",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Nuevo_Habito"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "93990716-499f-4e88-b14c-8a6c6f42a90f",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "ELIMINAR_HABITO",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "751e159a-45fb-4e81-bd99-1280c03a4d9a",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_LISTAS",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Menu_Listas"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "8b652cfa-eae2-444a-a313-25eac022d310",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "NUEVA_LISTA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Listas"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "ceb5dcee-efc9-49b8-8f91-bed8829b8d9d",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "ELIMINAR_LISTA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -432,
        7104
      ],
      "id": "d6ea2b55-fa8d-4a8b-b7d8-a16ef661a339",
      "name": "PANTALLAS"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1280,
        6736
      ],
      "id": "f3163378-bfac-4051-b1e3-89c5abdcb927",
      "name": "Datos Temporales",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Hola {{ $('Telegram Trigger').item.json.message.from.first_name }} ðŸ‘‹\n\nGracias por escribirnos.  \nEn este momento tu acceso al sistema estÃ¡ **bloqueado temporalmente** ðŸš«.\n\nSi crees que se trata de un error o necesitas mÃ¡s informaciÃ³n, no dudes en comunicarte con el administrador.\n\nCuando el acceso sea habilitado, podrÃ¡s usar el bot con normalidad.\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -1280,
        6544
      ],
      "id": "c8bb3bd3-bfa3-46ba-979c-e84e004c12f5",
      "name": "Acceso Denegado",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -816,
        7056
      ],
      "id": "dda64d01-726a-4528-a23c-16cc356e4418",
      "name": "MenÃº Principal",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "f57a2232-8f49-4ac9-bc30-d1c25a74b6a1",
              "leftValue": "={{ $json.pantalla_actual }}",
              "rightValue": "MENU_PRINCIPAL",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -1120,
        6736
      ],
      "id": "ca19cc0f-ce0f-438a-8aa3-21ea75216d2c",
      "name": "Principal?"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "f57a2232-8f49-4ac9-bc30-d1c25a74b6a1",
              "leftValue": "={{ $json.pantalla_actual }}",
              "rightValue": "MENU_SELECCION",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -944,
        6720
      ],
      "id": "cda6d54c-1cc3-4a0c-8af6-5bb694c894b2",
      "name": "SelecciÃ³n?"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "799b6e2d-3eb6-4300-9d8f-97b1e1c66977",
              "leftValue": "={{ !isNaN($('Telegram Trigger').item.json.message.text) && Number($('Telegram Trigger').item.json.message.text) >= 0 && Number($('Telegram Trigger').item.json.message.text) <= 9 }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -112,
        2128
      ],
      "id": "af5b541a-1a85-45fe-830a-b4ebd405607f",
      "name": "Veri OPC"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, ese nÃºmero no estÃ¡ dentro de las opciones disponibles.\n\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieres usar.\nðŸ”¢ AsegÃºrate de que estÃ© dentro del menÃº, Â¡asÃ­ avanzamos sin problema!\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nâœ¨ Estoy atento, elige una opciÃ³n y seguimos ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        32,
        1952
      ],
      "id": "7213b154-855d-47ae-9c73-91ff266d349a",
      "name": "OPC Invalido",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -976,
        6880
      ],
      "id": "3305e6eb-bfe3-410b-9847-a18e4765fecb",
      "name": "Act MSeleccion",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "0",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "ebb38b19-9662-4e4b-b219-0c87e2e7f335"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e818d0d0-c42e-4989-b4b5-a7d7fce3eefb",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f8ea4bb7-520a-4c4a-a25d-6d7b6fdca1a7",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "4",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Habitos"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "b50cda68-7563-4586-bbf1-cf34e011627c",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "5",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Listas"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "ea7646de-078e-4eda-a282-63cfee3ad057",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "6",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "c3bd8463-d6e0-41bf-8b42-55252c7f8547",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "7",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "b47ea6b7-dab9-4ee8-9516-d22373dc4fc1",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "8",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "bb6457a1-41f0-4456-81c1-ff8b931bcc5a",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        208,
        2080
      ],
      "id": "3558eb78-1d09-4cc5-acab-97157f90cb34",
      "name": "Cual Pantalla?"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        448,
        1392
      ],
      "id": "b43d122b-8968-43c4-a09b-9c02f5e444bb",
      "name": "AYUDA",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Estoy aquÃ­ para ayudarte a organizar tu dÃ­a sin complicaciones ðŸ˜Š\n\nConmigo puedes:\nðŸ“… Agendar y gestionar tus citas  \nðŸ“ Crear y organizar tareas  \nðŸ”” Configurar recordatorios  \nðŸ” Crear hÃ¡bitos y listas  \nðŸ“Š Consultar reportes bÃ¡sicos  \n\nÂ¿CÃ³mo usar el bot?\nâž¡ï¸ Siempre escribe solo el nÃºmero de la opciÃ³n que quieras elegir.\nâž¡ï¸ Yo te irÃ© guiando paso a paso.\nâž¡ï¸ En cualquier momento puedes escribir **9** para volver cancelar y volver al menÃº principal.\nâž¡ï¸ Si ves un mensaje de confirmaciÃ³n, revisa la informaciÃ³n antes de continuar.\n\nTip rÃ¡pido ðŸ’¡  \nSi no sabes por dÃ³nde empezar, te recomiendo ir a **Agenda (opciÃ³n 1)**.\n\nSi en algÃºn momento algo no sale como esperabas, no te preocupes.\nPuedes volver al menÃº principal cuando quieras.\n\nÂ¿Listo para continuar?  \nEscribe el nÃºmero de la opciÃ³n que quieras usar ðŸ‘‡\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        608,
        1392
      ],
      "id": "07d07009-ab52-46ae-b52b-ef42af364e21",
      "name": "Mensaje Ayuda",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, ese nÃºmero no estÃ¡ dentro de las opciones disponibles.\n\nðŸ”¢ AsegÃºrate de que estÃ© dentro del menÃº, Â¡asÃ­ avanzamos sin problema!\n\n1ï¸âƒ£ Agendar una nueva cita\n2ï¸âƒ£ Consultar tu agenda\n3ï¸âƒ£ Reprogramar una cita\n4ï¸âƒ£ Cancelar una cita\n5ï¸âƒ£ Marcar una cita como completada\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4832,
        1824
      ],
      "id": "64a454b9-8f59-4a81-87d6-f81223a872af",
      "name": "OPC Invalido1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "799b6e2d-3eb6-4300-9d8f-97b1e1c66977",
              "leftValue": "={{ !isNaN($('Telegram Trigger').item.json.message.text) && ((Number($('Telegram Trigger').item.json.message.text) >= 1 && Number($('Telegram Trigger').item.json.message.text) <= 5) || Number($('Telegram Trigger').item.json.message.text) === 9)}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4672,
        1984
      ],
      "id": "988ee414-668a-4cb6-9a59-76f42201d673",
      "name": "Veri OPC1"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "1",
            "pantalla_actual": "AGENDA_NUEVA_CITA",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        1616
      ],
      "id": "d736f899-00a6-43fd-9b1c-1a951c8d8d1d",
      "name": "Nueva Cita",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "05deba36-8c97-4e18-bf89-f5aa3e57ed13",
              "leftValue": "={{ $json.valido }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        7264,
        13312
      ],
      "id": "e423edf4-af45-496a-a3b1-6473f71fe1df",
      "name": "If1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }},\nla fecha {{ $('Telegram Trigger').item.json.message.text }} no es vÃ¡lida.\n\nðŸ“… AsegÃºrate de escribirla en el formato correcto YYYY-MM-DD\nðŸ•’ y que sea una fecha igual o posterior a hoy.\n\nâœï¸ Ejemplo vÃ¡lido: 2025-12-20\n\nðŸ‘‰ IntÃ©ntalo nuevamente, yo te acompaÃ±o ðŸ˜‰\n\nÂ¿CuÃ¡l es la fecha de la cita?\n\n9ï¸âƒ£ Cancelar y salir",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        7472,
        13184
      ],
      "id": "70da8a6b-5f1a-49c5-9bd2-c93face6e9fa",
      "name": "OPC Invalido2",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Paso 1 de 6\nÂ¿CuÃ¡l es la fecha de la cita?\n\nðŸ“Œ EscrÃ­bela en el siguiente formato:\nYYYY-MM-DD\nðŸ“ Ejemplo: 2025-12-20\n\n9ï¸âƒ£ Cancelar y salir\n\nðŸ‘‰ Solo escribe la fecha o el nÃºmero 9 si deseas cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5520,
        1648
      ],
      "id": "ed9016e1-36c4-4e80-989a-efce038595cf",
      "name": "Fecha Cita",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 2,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e818d0d0-c42e-4989-b4b5-a7d7fce3eefb",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 3,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f8ea4bb7-520a-4c4a-a25d-6d7b6fdca1a7",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 4,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "b50cda68-7563-4586-bbf1-cf34e011627c",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 5,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "bb6457a1-41f0-4456-81c1-ff8b931bcc5a",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 6,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        6464,
        13968
      ],
      "id": "b1578b80-3e4a-4f67-aab3-b804e4a043a7",
      "name": "Pasos Nueva Cita"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=â° Paso 2 de 6\nÂ¿A quÃ© hora serÃ¡ la cita?\n\nðŸ•’ Usa el formato de 24 horas:\nHH:MM\nðŸ“ Ejemplo: 14:30\n\n9ï¸âƒ£ Cancelar y volver atrÃ¡s\n\nðŸ‘‰ Escribe la hora o el nÃºmero 9 para cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        7904,
        13360
      ],
      "id": "44213f25-6659-456a-b69d-4643008c0c6b",
      "name": "Hora Cita",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "2",
            "pantalla_actual": "AGENDA_NUEVA_CITA",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7616,
        13360
      ],
      "id": "384d7a4d-b701-4758-9bf3-fc1ec1a5f734",
      "name": "Act Paso",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "05deba36-8c97-4e18-bf89-f5aa3e57ed13",
              "leftValue": "={{ $json.hora_valida }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        7360,
        13584
      ],
      "id": "17d29ab6-2645-44ad-ba7c-92180ae7e9f9",
      "name": "If3"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }},\nla hora {{ $('Telegram Trigger').item.json.message.text }} no es vÃ¡lida.\n\nðŸ•’ Debe escribirse en formato 24 horas (HH:MM)\nðŸ“Œ Si la hora es menor a 10, recuerda agregar el cero adelante\n    ðŸ‘‰ 07:00, 05:30, 09:15\n\nðŸš« Evita formatos como 7:00, 6 o 5\n\nâœï¸ Ejemplo vÃ¡lido: 14:30\n\nðŸ‘‰ IntÃ©ntalo nuevamente, yo te acompaÃ±o ðŸ˜‰\n\nÂ¿CuÃ¡l es la hora de la cita?\n\n9ï¸âƒ£ Cancelar y salir",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        7616,
        13520
      ],
      "id": "99d0b8c5-f0a2-47aa-8117-e8499103b179",
      "name": "OPC Invalido3",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const input = ($('Telegram Trigger').first().json.message.text || '').trim();\n\n// ðŸ‘‰ Validar formato YYYY-MM-DD\nconst regexFecha = /^\\d{4}-\\d{2}-\\d{2}$/;\n\nif (!regexFecha.test(input)) {\n  return [{\n    valido: false,\n    mensaje: 'âŒ Formato invÃ¡lido. Usa YYYY-MM-DD (ejemplo: 2025-12-20).'\n  }];\n}\n\n// ðŸ‘‰ Convertir fecha ingresada\nconst fechaIngresada = new Date(input + 'T00:00:00');\n\n// ðŸ‘‰ Validar que la fecha exista realmente\nif (isNaN(fechaIngresada.getTime())) {\n  return [{\n    valido: false,\n    mensaje: 'âŒ La fecha ingresada no es vÃ¡lida. Verifica el dÃ­a y el mes.'\n  }];\n}\n\n// ðŸ‘‰ Fecha actual (sin hora)\nconst hoy = new Date();\nhoy.setHours(0, 0, 0, 0);\n\n// ðŸ‘‰ No permitir fechas pasadas\nif (fechaIngresada < hoy) {\n  return [{\n    valido: false,\n    mensaje: 'â° No puedes agendar citas en fechas pasadas. Elige una fecha futura.'\n  }];\n}\n\n// âœ… Fecha vÃ¡lida\nreturn [{\n  valido: true,\n  fecha: input\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        7088,
        13328
      ],
      "id": "9ba8e411-39cf-4459-ab8e-b5919d05b1e1",
      "name": "Verificar Fecha"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "3",
            "pantalla_actual": "AGENDA_NUEVA_CITA",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7680,
        13680
      ],
      "id": "55589e76-e8ae-415a-a86b-ea69c01c1868",
      "name": "Act Paso1",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Paso 3 de 6\nðŸ‘¤ Â¿A nombre de quiÃ©n es la cita?\n\nâœï¸ Escribe el nombre completo de la persona.\n\nðŸ“Œ Ejemplo: Juan PÃ©rez GÃ³mez\n\n9ï¸âƒ£ Cancelar y salir",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        8000,
        13680
      ],
      "id": "918ba96d-6ebb-4371-9c48-30da24ae534e",
      "name": "Nombre Cita",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Paso 4 de 6\nðŸ—’ï¸ CuÃ©ntame brevemente el motivo de la cita\n\nâœï¸ Escribe una descripciÃ³n corta del motivo.\n\nðŸ“Œ Ejemplo: AsesorÃ­a tÃ©cnica\n\nðŸ‘‰ Usa pocas palabras, solo lo necesario.\n\n9ï¸âƒ£ Cancelar y salir",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        7440,
        13776
      ],
      "id": "2599160b-b780-4df9-a60a-d8326ceb524b",
      "name": "Motivo Cita",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "4",
            "pantalla_actual": "AGENDA_NUEVA_CITA",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7184,
        13776
      ],
      "id": "01c3c860-6f85-41e9-b0cd-de8c6d226f87",
      "name": "Act Paso2",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "5",
            "pantalla_actual": "AGENDA_NUEVA_CITA",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7184,
        13936
      ],
      "id": "87eacd1c-8d16-47c4-93d4-ac1a3afe499e",
      "name": "Act Paso3",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b321f78b-8819-4417-8c19-8cc290dbcec4",
              "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        5824,
        13520
      ],
      "id": "6f6930b0-3365-4dfe-a017-328fb739931f",
      "name": "If"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Paso 5 de 6\nðŸ“ Â¿CÃ³mo serÃ¡ la atenciÃ³n de la cita?\n\nElige la opciÃ³n que mejor describa cÃ³mo se realizarÃ¡:\n\n1ï¸âƒ£ Presencial\n2ï¸âƒ£ Virtual\n3ï¸âƒ£ Llamada telefÃ³nica\n\nðŸ‘‰ Escribe solo el nÃºmero de la opciÃ³n que prefieras.\n\n9ï¸âƒ£ Cancelar y salir",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        7568,
        13936
      ],
      "id": "e1f57b30-000a-4062-a1e5-023513655f44",
      "name": "Canal Cita",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "799b6e2d-3eb6-4300-9d8f-97b1e1c66977",
              "leftValue": "={{ !isNaN($('Telegram Trigger').item.json.message.text) && ((Number($('Telegram Trigger').item.json.message.text) >= 1 && Number($('Telegram Trigger').item.json.message.text) <= 3))}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        7184,
        14096
      ],
      "id": "aee38568-4d15-44c4-8a75-209573f21445",
      "name": "Veri OPC2"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, ese nÃºmero no corresponde a ninguna opciÃ³n vÃ¡lida.\n\nðŸ‘‰ Para continuar, escribe solo el nÃºmero del tipo de atenciÃ³n que deseas.\nðŸ”¢ AsegÃºrate de que estÃ© dentro de las opciones mostradas para que podamos avanzar sin enredos.\n\nðŸ“ Tipo de atenciÃ³n disponible:\n1ï¸âƒ£ Presencial\n2ï¸âƒ£ Virtual\n3ï¸âƒ£ Llamada\n9ï¸âƒ£ Cancelar y salir\n\nâœ¨ Estoy atento, elige una opciÃ³n y seguimos con tu cita ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        7488,
        14080
      ],
      "id": "a22563d6-b2a5-4ee7-83c0-a14649855a3b",
      "name": "OPC Invalido4",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "6",
            "pantalla_actual": "AGENDA_NUEVA_CITA",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        8000,
        14224
      ],
      "id": "ee3f8655-b2f0-43ef-9991-1f40584c29f3",
      "name": "Act Paso4",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "799b6e2d-3eb6-4300-9d8f-97b1e1c66977",
              "leftValue": "={{ !isNaN($('Telegram Trigger').item.json.message.text) && ((Number($('Telegram Trigger').item.json.message.text) >= 1 && Number($('Telegram Trigger').item.json.message.text) <= 3))}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        7024,
        14496
      ],
      "id": "afa973d4-a80e-4de2-b8f2-457bf06c2ece",
      "name": "Veri OPC3"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, ese nÃºmero no corresponde a ninguna opciÃ³n vÃ¡lida.\n\nðŸ‘‰ Para continuar, escribe solo el nÃºmero de la acciÃ³n que deseas realizar\nðŸ”¢ AsegÃºrate de que estÃ© dentro de las opciones mostradas para que podamos avanzar sin enredos.\n\nðŸ“… Fecha: {{ $('Datos Temporales').item.json.fecha_temporar }}\nâ° Hora: {{ $('Datos Temporales').item.json.hora_temporal }}\nðŸ‘¤ Cliente: {{ $('Datos Temporales').item.json.nombre_temporal }}\nðŸ—’ï¸ Motivo: {{ $('Datos Temporales').item.json.motivo_temporal }}\nðŸ“ Canal: {{ $('Datos Temporales').item.json.canal_temporal }}\n\nðŸ‘‰ Â¿QuÃ© deseas hacer ahora?\n\n1ï¸âƒ£ Confirmar y guardar la cita\n2ï¸âƒ£ Editar la informaciÃ³n\n3ï¸âƒ£ Cancelar el agendamiento\n\nâœ¨ Escribe solo el nÃºmero de la opciÃ³n que elijas y yo me encargo del resto ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        7264,
        14416
      ],
      "id": "02a0d6aa-6324-4df4-b6c4-0a426692c804",
      "name": "OPC Invalido5",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "fecha_temporar": "={{ $('Telegram Trigger').item.json.message.text }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7760,
        13360
      ],
      "id": "559cdf2a-8514-47e8-a2c5-65a6ce20c85f",
      "name": "Almacenar",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "hora_temporal": "={{ $('Telegram Trigger').item.json.message.text }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7824,
        13680
      ],
      "id": "b1ed5de1-ab18-4e38-8f9d-10eb38c81229",
      "name": "Almacenar1",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "nombre_temporal": "={{ $('Telegram Trigger').item.json.message.text }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7312,
        13776
      ],
      "id": "466baea2-5b2b-4dbd-91df-7f646fcf12c9",
      "name": "Almacenar2",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "motivo_temporal": "={{ $('Telegram Trigger').item.json.message.text }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7376,
        13936
      ],
      "id": "6186f4ba-5e3f-4245-87c7-2e48375459e6",
      "name": "Almacenar3",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const input = $('Telegram Trigger').first().json.message.text;\n\n// ExpresiÃ³n regular para formato HH:MM en 24 horas\nconst regexHora = /^([01]\\d|2[0-3]):([0-5]\\d)$/;\n\nconst esHoraValida = regexHora.test(input);\n\nreturn [\n  {\n    json: {\n      hora_ingresada: input,\n      hora_valida: esHoraValida\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        7184,
        13584
      ],
      "id": "5ec505a0-5405-4c35-996c-1a00b1654684",
      "name": "Validar Hora"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "canal_temporal": "Presencial"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7760,
        14080
      ],
      "id": "7dd436f4-fe6c-4568-b1b8-f67b7f4e3cf6",
      "name": "Almacenar4",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "canal_temporal": "Virtual"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7760,
        14224
      ],
      "id": "1ff82bff-0ee5-4170-99b4-99445d115cb5",
      "name": "Almacenar5",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "canal_temporal": "Llamada"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7760,
        14368
      ],
      "id": "3a04f0f8-3350-4130-9892-d62426b11ff1",
      "name": "Almacenar6",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“ Revisa la informaciÃ³n de tu cita\n\nAntes de guardarla, confirma que todo estÃ© correcto:\n\nðŸ“… Fecha: {{ $('Datos Temporales').item.json.fecha_temporar }}\nâ° Hora: {{ $('Datos Temporales').item.json.hora_temporal }}\nðŸ‘¤ Cliente: {{ $('Datos Temporales').item.json.nombre_temporal }}\nðŸ—’ï¸ Motivo: {{ $('Datos Temporales').item.json.motivo_temporal }}\nðŸ“ Canal: {{ $('Datos Temporales1').item.json.canal_temporal }}\n\nðŸ‘‰ Â¿QuÃ© deseas hacer ahora?\n\n1ï¸âƒ£ Confirmar y guardar la cita\n2ï¸âƒ£ Editar la informaciÃ³n\n3ï¸âƒ£ Cancelar el agendamiento\n\nâœ¨ Escribe solo el nÃºmero de la opciÃ³n que elijas y yo me encargo del resto ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        8320,
        14224
      ],
      "id": "9acc4dae-9d9b-442e-998f-9dec843956cc",
      "name": "ConfirmaciÃ³n Cita",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        8160,
        14224
      ],
      "id": "4e1d869b-0956-4a85-8aa2-bf25067a717d",
      "name": "Datos Temporales1",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e818d0d0-c42e-4989-b4b5-a7d7fce3eefb",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        7488,
        14224
      ],
      "id": "bdfeac6e-6a0c-4901-9253-37960726739a",
      "name": "Canales"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e818d0d0-c42e-4989-b4b5-a7d7fce3eefb",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        7232,
        14816
      ],
      "id": "118f5b1b-12b6-4e57-a091-ce550492eb0f",
      "name": "ConfirmaciÃ³n"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Citas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "creado_por": "={{ $json.autor }}",
            "fecha": "={{ $json.fecha }}",
            "nombre": "={{ $json.nombre }}",
            "motivo": "={{ $json.motivo }}",
            "hora": "={{ $json.hora }}",
            "canal": "={{ $json.canal }}",
            "estado": "Pendiente",
            "timestamp_creacion": "={{ new Date().toISOString() }}",
            "id_cita": "=CITA - 00{{ $json.contador }}{{ $json.autor }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_cita",
              "displayName": "id_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha",
              "displayName": "fecha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "hora",
              "displayName": "hora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "motivo",
              "displayName": "motivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_creacion",
              "displayName": "timestamp_creacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        8208,
        14624
      ],
      "id": "123de966-284b-4736-a25e-9b12528960ef",
      "name": "Append row in sheet",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Verifica si hay al menos un item con json vacÃ­o\nconst hayObjetoVacio = items.some(\n  item => item.json && Object.keys(item.json).length === 0\n);\n\n// Calcula la cantidad de citas\nconst cantidad_citas = hayObjetoVacio\n  ? items.length - 1\n  : items.length;\n\nreturn [\n  {\n    json: {\n      cantidad_citas,\n      fecha: $('Datos Temporales').first().json.fecha_temporar,\n      hora: $('Datos Temporales').first().json.hora_temporal,\n      nombre: $('Datos Temporales').first().json.nombre_temporal,\n      motivo: $('Datos Temporales').first().json.motivo_temporal,\n      canal: $('Datos Temporales').first().json.canal_temporal,\n      autor: $('Telegram Trigger').first().json.message.chat.id,\n      contador: $('Datos Temporales').first().json.n_citas\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        7712,
        14576
      ],
      "id": "0fc24f17-05e6-4c50-8bfc-ba52fc7ae72d",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Citas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            },
            {
              "lookupColumn": "fecha",
              "lookupValue": "={{ $('Datos Temporales').item.json.fecha_temporar }}"
            },
            {
              "lookupColumn": "hora",
              "lookupValue": "={{ $('Datos Temporales').item.json.hora_temporal }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7536,
        14576
      ],
      "id": "0057afbf-1918-4598-82fd-8caa851e211a",
      "name": "Cant Citas",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Code in JavaScript').item.json.autor }}",
            "paso_actual": "0",
            "pantalla_actual": "CONFIRMACION",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}",
            "fecha_temporar": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}",
            "n_citas": "={{ $('Code in JavaScript').item.json.contador + 1 }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "n_citas",
              "displayName": "n_citas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "n_tareas",
              "displayName": "n_tareas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "n_habitos",
              "displayName": "n_habitos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        8384,
        14624
      ],
      "id": "af6255b0-6a51-48ba-8916-07dedf6f8a26",
      "name": "Act Paso5",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Code in JavaScript').item.json.autor }}",
        "text": "=âœ… Â¡Listo! Tu cita quedÃ³ agendada con Ã©xito\n\nÂ¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n1ï¸âƒ£ Volver a Agenda\n2ï¸âƒ£ Ir al menÃº principal\n\nðŸ‘‰ Solo escribe el nÃºmero de la opciÃ³n que prefieras",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        8544,
        14624
      ],
      "id": "2b28bb1c-88cf-4284-9189-83f0d1333636",
      "name": "Que deseas hacer?",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "799b6e2d-3eb6-4300-9d8f-97b1e1c66977",
              "leftValue": "={{ !isNaN($('Telegram Trigger').item.json.message.text) && ((Number($('Telegram Trigger').item.json.message.text) >= 1 && Number($('Telegram Trigger').item.json.message.text) <= 2) || Number($('Telegram Trigger').item.json.message.text) === 9)}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        6272,
        12640
      ],
      "id": "daad8667-7d9a-4654-b62b-1104e67de8ee",
      "name": "Veri OPC4"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        6496,
        12656
      ],
      "id": "10b3d1bf-4413-47a1-ab30-fcd2fd58d4c9",
      "name": "Pasos Nueva Cita1"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_AGENDA"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6672,
        12544
      ],
      "id": "819ca673-f58e-4d4d-976b-3615525f9adc",
      "name": "Act Paso6",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6672,
        12768
      ],
      "id": "05b8e80f-1d27-4037-b9bb-6b4b55019ea7",
      "name": "Act Paso7",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, ese nÃºmero no estÃ¡ dentro de las opciones disponibles.\n\nðŸ”¢ AsegÃºrate de que estÃ© dentro del menÃº, Â¡asÃ­ avanzamos sin problema!\n\nÂ¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n1ï¸âƒ£ Volver a Agenda\n2ï¸âƒ£ Ir al menÃº principal\n\nðŸ‘‰ Solo escribe el nÃºmero de la opciÃ³n que prefieras",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6432,
        12464
      ],
      "id": "282a7545-b487-4bbc-bb2c-d4bc1d4a5ebc",
      "name": "OPC Invalido6",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“… Perfecto, entremos a tu agenda\n\nÂ¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Agendar una nueva cita\n2ï¸âƒ£ Consultar tu agenda\n3ï¸âƒ£ Reprogramar una cita\n4ï¸âƒ£ Cancelar una cita\n5ï¸âƒ£ Marcar una cita como completada\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6848,
        12464
      ],
      "id": "91d63b6c-c6a1-45c7-839f-145f6bea93e1",
      "name": "MenÃº Agenda1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6832,
        12704
      ],
      "id": "c2f1014a-8cc3-4d0f-b60e-a8f0928071f6",
      "name": "MenÃº Principal1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7648,
        15040
      ],
      "id": "21e5a5ac-ef47-4a81-9044-db4cb9a83aee",
      "name": "Act Paso8",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        7792,
        15040
      ],
      "id": "465595a4-f64e-4606-9914-3aba735e5a6d",
      "name": "MenÃº Principal3",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âŒ Proceso cancelado\nðŸ”™ Regresando al menÃº principalâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        7504,
        15040
      ],
      "id": "d74d3ba5-fd99-4ff0-90d2-d01a1fe7e525",
      "name": "Cancelado",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âŒ Proceso cancelado\nðŸ”™ Regresando al menÃº principalâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6464,
        12848
      ],
      "id": "ffbb0fa0-1316-47e8-8f8f-90b4b5562dc8",
      "name": "Cancelado1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "1",
            "pantalla_actual": "AGENDA_NUEVA_CITA",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7472,
        14832
      ],
      "id": "483d3c92-ab42-4152-a46d-c7847eaf25ff",
      "name": "Act Paso9",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Okey, Volvamos a empezar\n\nPaso 1 de 6\nÂ¿CuÃ¡l es la fecha de la cita?\n\nðŸ“Œ EscrÃ­bela en el siguiente formato:\nYYYY-MM-DD\nðŸ“ Ejemplo: 2025-12-20\n\n9ï¸âƒ£ Cancelar y salir\n\nðŸ‘‰ Solo escribe la fecha o el nÃºmero 9 si deseas cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        7680,
        14832
      ],
      "id": "8591e5db-69a9-4988-b7b8-50fb643ce777",
      "name": "Volver a empezar",
      "webhookId": "6ac59f7b-9940-4518-bca6-a00c60af2b5e",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.creado_por }}",
        "text": "=ðŸ“… Tienes {{ $json.total_citas }} citas agendadas:\n---------------------------------------------------\n{{ $json.citas.map(c => \n`ðŸ†” ${c.id}\nðŸ“† ${c.fecha}\nâ° ${c.hora}\nðŸ‘¤ ${c.nombre}\nðŸ“Œ ${c.motivo}\n\\n`\n).join('\\n') }}\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5920,
        1904
      ],
      "id": "d8dbba1b-97a9-4e24-a1b5-f63b6220a87e",
      "name": "Mi Agenda",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Citas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5360,
        1840
      ],
      "id": "c018117f-0004-4505-bd06-28ce99259443",
      "name": "Agenda",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const citas = items\n  .filter(item => item.json && Object.keys(item.json).length > 0)\n  .map(item => ({\n    id: item.json.id_cita,\n    fecha: item.json.fecha,\n    hora: item.json.hora,\n    nombre: item.json.nombre,\n    motivo: item.json.motivo,\n    canal: item.json.canal\n  }));\n\nreturn [\n  {\n    json: {\n      total_citas: citas.length,\n      citas,\n      creado_por: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5552,
        1840
      ],
      "id": "fd8d3023-c088-4270-9f87-9ebf8e816714",
      "name": "Recorrer Agenda"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8be02210-0d18-42b0-8ecd-f540f74c6858",
              "leftValue": "={{ $json.total_citas }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        5728,
        1840
      ],
      "id": "0e307bc6-8a55-4f8e-94a2-f7fa19db0cbe",
      "name": "If2"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“­ AÃºn no tienes citas agendadas\n\nCuando quieras, puedes crear una nueva y empezar a organizarte mejor ðŸ“…âœ¨\n\nðŸ‘‰ Escribe 1 para agendar una cita o 9 para volver al menÃº principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5920,
        1744
      ],
      "id": "ee3c1de7-cd25-4451-82a7-287070214ce3",
      "name": "No Citas",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Recorrer Agenda').item.json.creado_por }}",
        "text": "=Â¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Agendar una nueva cita\n2ï¸âƒ£ Consultar tu agenda\n3ï¸âƒ£ Reprogramar una cita\n4ï¸âƒ£ Cancelar una cita\n5ï¸âƒ£ Marcar una cita como completada\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6128,
        1824
      ],
      "id": "da1c4f13-4b63-404d-90f9-b4d4ca8e66fd",
      "name": "MenÃº Agenda2",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Citas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5568,
        2048
      ],
      "id": "a346ad47-7e08-4ad3-98a4-4d6b606f48ae",
      "name": "Agenda1",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Filtramos citas vÃ¡lidas\nconst citas = items\n  .filter(item => item.json && Object.keys(item.json).length > 0)\n  .map((item, index) => ({\n    numero: index + 1,\n    id: item.json.id_cita,\n    fecha: item.json.fecha,\n    hora: item.json.hora,\n    nombre: item.json.nombre\n  }));\n\n// Si no hay citas\nif (citas.length === 0) {\n  return [\n    {\n      json: {\n        mensaje: \"ðŸ“­ No tienes citas agendadas para reprogramar.\",\n        opciones: [],\n        cant_citas: 0\n      }\n    }\n  ];\n}\n\n// Construimos el mensaje dinÃ¡mico\nlet mensaje = \"âœï¸ **Elige la cita que deseas reprogramar:**\\n\\n\";\ncitas.forEach(cita => {\n  mensaje += `${cita.numero}. ${cita.fecha} ${cita.hora} - ${cita.nombre}\\n`;\n});\nmensaje += `\\n9ï¸âƒ£ Cancelar`;\n\n// Devolvemos el mensaje y las opciones\nreturn [\n  {\n    json: {\n      mensaje,\n      opciones: citas.map(c => c.numero).concat([9]),\n      citas,\n      creado_por: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5760,
        2048
      ],
      "id": "890025c3-d990-4172-bfd1-54b313fc7975",
      "name": "Recorrer Agenda1"
    },
    {
      "parameters": {
        "chatId": "={{ $json.creado_por }}",
        "text": "={{ \n  \"âœï¸ Elige la cita que deseas reprogramar:\\n\\n\" + \n  $json[\"citas\"].map(c => c.numero + \". \" + c.fecha + \" --- \" + c.hora + \" - \" + c.nombre).join(\"\\n\") + \n  \"\\n\\nðŸ…¾ï¸ Cancelar\" \n}}\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6192,
        2240
      ],
      "id": "11a70be9-3d14-4531-ab31-91a9f042389a",
      "name": "Mi Agenda1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Recorrer Agenda1').item.json.creado_por }}",
            "paso_actual": "1",
            "pantalla_actual": "REPROGRAMAR",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6416,
        2192
      ],
      "id": "47a9cba4-8713-4afb-b1a3-df1a7766ba40",
      "name": "Act Paso10",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e818d0d0-c42e-4989-b4b5-a7d7fce3eefb",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f8ea4bb7-520a-4c4a-a25d-6d7b6fdca1a7",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "4",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "b50cda68-7563-4586-bbf1-cf34e011627c",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "5",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "bb6457a1-41f0-4456-81c1-ff8b931bcc5a",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4992,
        2512
      ],
      "id": "68c35b45-cd5f-4a99-91b1-8ecacc08d9de",
      "name": "MenÃº Agenda3"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Citas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7824,
        11600
      ],
      "id": "8468e08e-f938-4b4a-a90a-1f516f067577",
      "name": "Agenda2",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Filtramos citas vÃ¡lidas\nconst citas = items\n  .filter(item => item.json && Object.keys(item.json).length > 0)\n  .map((item, index) => ({\n    numero: index + 1,\n    id: item.json.id_cita,\n    fecha: item.json.fecha,\n    hora: item.json.hora,\n    nombre: item.json.nombre\n  }));\n\n// Si no hay citas\nif (citas.length === 0) {\n  return [\n    {\n      json: {\n        mensaje: \"ðŸ“­ No tienes citas agendadas para reprogramar.\",\n        opciones: []\n      }\n    }\n  ];\n}\n\n// Construimos el mensaje dinÃ¡mico\nlet mensaje = \"âœï¸ **Elige la cita que deseas reprogramar:**\\n\\n\";\ncitas.forEach(cita => {\n  mensaje += `${cita.numero}. ${cita.fecha} ${cita.hora} - ${cita.nombre}\\n`;\n});\nmensaje += `\\n9ï¸âƒ£ Cancelar`;\n\n// Devolvemos el mensaje y las opciones\nreturn [\n  {\n    json: {\n      mensaje,\n      opciones: citas.map(c => c.numero).concat([9]),\n      citas,\n      creado_por: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        7984,
        11600
      ],
      "id": "ea3da04a-1d0b-4b75-a439-53c82e123052",
      "name": "Recorrer Agenda2"
    },
    {
      "parameters": {
        "jsCode": "const opcion = Number($('Telegram Trigger').first().json.message.text);\nconst citas = $input.first().json.citas;\n\nif (opcion === 0) {\n  return [\n    { json: { accion: 'cancelar', mensaje: 'âŒ Proceso cancelado, regresando al menÃº principalâ€¦' } }\n  ];\n}\n\nconst citaSeleccionada = citas.find(c => c.numero === opcion);\n\nif (!citaSeleccionada) {\n  return [\n    { json: { accion: 'error', mensaje: 'âš ï¸ OpciÃ³n invÃ¡lida, intenta de nuevo.' } }\n  ];\n}\n\nreturn [\n  { json: { cita: citaSeleccionada } }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        8144,
        11600
      ],
      "id": "73465817-7f75-461b-a61f-1e4cd053079c",
      "name": "Seleccion"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 2,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "06d2b836-5f9a-4a73-8980-a84e49678078",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 3,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        7600,
        11760
      ],
      "id": "26e9fca5-a193-4d15-b249-b5fd8cee3601",
      "name": "Pasos Reprogramar"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Recorrer Agenda2').item.json.creado_por }}",
            "paso_actual": "2",
            "pantalla_actual": "REPROGRAMAR",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}",
            "cita_edit": "={{ $json.cita.id }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        8528,
        11552
      ],
      "id": "6b2864da-6009-47a4-92f9-64135961783b",
      "name": "Act Paso11",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Recorrer Agenda2').item.json.creado_por }}",
        "text": "=Â¿CuÃ¡l es la nueva fecha de la cita?\n\nðŸ“Œ EscrÃ­bela en el siguiente formato:\nYYYY-MM-DD\nðŸ“ Ejemplo: 2025-12-20\n\nðŸ…¾ï¸ Cancelar y salir\n\nðŸ‘‰ Solo escribe la fecha o el nÃºmero 0 si deseas cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        8672,
        11552
      ],
      "id": "2093cab1-b974-4b7a-a78b-9e528f5bd2cb",
      "name": "Fecha Cita Edit",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b321f78b-8819-4417-8c19-8cc290dbcec4",
              "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
              "rightValue": "0",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        7120,
        11840
      ],
      "id": "b8bd33b1-8dd6-485b-8c48-11dfaf2e8a0a",
      "name": "If4"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7472,
        11584
      ],
      "id": "0a6994a1-e398-406f-a98c-7a44b76f5242",
      "name": "Act Paso12",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        7616,
        11584
      ],
      "id": "d7019e6f-f347-49b7-a647-930a9e8deb17",
      "name": "MenÃº Principal2",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âŒ Proceso cancelado\nðŸ”™ Regresando al menÃº principalâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        7328,
        11584
      ],
      "id": "7b9f31f0-f356-420f-8b55-3a1596060958",
      "name": "Cancelado2",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "05deba36-8c97-4e18-bf89-f5aa3e57ed13",
              "leftValue": "={{ $json.valido }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        7984,
        11808
      ],
      "id": "02ba50f9-e173-48da-81de-28f6d5ab06be",
      "name": "If5"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }},\nla fecha {{ $('Telegram Trigger').item.json.message.text }} no es vÃ¡lida.\n\nðŸ“… AsegÃºrate de escribirla en el formato correcto YYYY-MM-DD\nðŸ•’ y que sea una fecha igual o posterior a hoy.\n\nâœï¸ Ejemplo vÃ¡lido: 2025-12-20\n\nðŸ‘‰ IntÃ©ntalo nuevamente, yo te acompaÃ±o ðŸ˜‰\n\nÂ¿CuÃ¡l es la fecha de la cita?",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        8208,
        11760
      ],
      "id": "d2c06fe8-0486-4d13-a9f0-8987913aca93",
      "name": "OPC Invalido7",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Â¿A quÃ© hora serÃ¡ la cita?\n\nðŸ•’ Usa el formato de 24 horas:\nHH:MM\nðŸ“ Ejemplo: 14:30\n\nðŸ…¾ï¸ Cancelar y volver atrÃ¡s\n\nðŸ‘‰ Escribe la hora o el nÃºmero 0 para cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        8464,
        11936
      ],
      "id": "43d7246d-3693-4a35-ae51-ce19c9d00e20",
      "name": "Hora Cita1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "3",
            "pantalla_actual": "REPROGRAMAR",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        8176,
        11936
      ],
      "id": "cfef7488-dac5-4d00-8ade-af4d838c4f5f",
      "name": "Act Paso13",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const input = ($('Telegram Trigger').first().json.message.text || '').trim();\n\n// ðŸ‘‰ Validar formato YYYY-MM-DD\nconst regexFecha = /^\\d{4}-\\d{2}-\\d{2}$/;\n\nif (!regexFecha.test(input)) {\n  return [{\n    valido: false,\n    mensaje: 'âŒ Formato invÃ¡lido. Usa YYYY-MM-DD (ejemplo: 2025-12-20).'\n  }];\n}\n\n// ðŸ‘‰ Convertir fecha ingresada\nconst fechaIngresada = new Date(input + 'T00:00:00');\n\n// ðŸ‘‰ Validar que la fecha exista realmente\nif (isNaN(fechaIngresada.getTime())) {\n  return [{\n    valido: false,\n    mensaje: 'âŒ La fecha ingresada no es vÃ¡lida. Verifica el dÃ­a y el mes.'\n  }];\n}\n\n// ðŸ‘‰ Fecha actual (sin hora)\nconst hoy = new Date();\nhoy.setHours(0, 0, 0, 0);\n\n// ðŸ‘‰ No permitir fechas pasadas\nif (fechaIngresada < hoy) {\n  return [{\n    valido: false,\n    mensaje: 'â° No puedes agendar citas en fechas pasadas. Elige una fecha futura.'\n  }];\n}\n\n// âœ… Fecha vÃ¡lida\nreturn [{\n  valido: true,\n  fecha: input\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        7824,
        11808
      ],
      "id": "ebb973c4-240a-4192-8b1c-55e6c0dbca4c",
      "name": "Verificar Fecha1"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "fecha_temporar": "={{ $('Telegram Trigger').item.json.message.text }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        8320,
        11936
      ],
      "id": "d695f024-2b4a-4966-b98a-e04e6b658ece",
      "name": "Almacenar7",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "05deba36-8c97-4e18-bf89-f5aa3e57ed13",
              "leftValue": "={{ $json.hora_valida }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        8048,
        12224
      ],
      "id": "485dc2f9-9f7c-4ba1-8b1d-0209c6f6f5a3",
      "name": "If6"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }},\nla hora {{ $('Telegram Trigger').item.json.message.text }} no es vÃ¡lida.\n\nðŸ•’ Debe escribirse en formato 24 horas (HH:MM)\nðŸ“Œ Si la hora es menor a 10, recuerda agregar el cero adelante\n    ðŸ‘‰ 07:00, 05:30, 09:15\n\nðŸš« Evita formatos como 7:00, 6 o 5\n\nâœï¸ Ejemplo vÃ¡lido: 14:30\n\nðŸ‘‰ IntÃ©ntalo nuevamente, yo te acompaÃ±o ðŸ˜‰\n\nÂ¿CuÃ¡l es la hora de la cita?",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        8304,
        12160
      ],
      "id": "b91dac8d-937c-4890-914b-a3db0ce45d19",
      "name": "OPC Invalido8",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const input = $('Telegram Trigger').first().json.message.text;\n\n// ExpresiÃ³n regular para formato HH:MM en 24 horas\nconst regexHora = /^([01]\\d|2[0-3]):([0-5]\\d)$/;\n\nconst esHoraValida = regexHora.test(input);\n\nreturn [\n  {\n    json: {\n      hora_ingresada: input,\n      hora_valida: esHoraValida\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        7872,
        12160
      ],
      "id": "80aeb38c-3a83-49da-aa75-7a7a07f4a5c0",
      "name": "Validar Hora1"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "CONFIRMACION",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}",
            "fecha_temporar": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}",
            "cita_edit": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        8480,
        12352
      ],
      "id": "ab6a6948-1dc0-451b-897f-d1c5d77f2945",
      "name": "Act Paso15",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âœ… Â¡Listo! Tu cita quedÃ³ reprogramada con Ã©xito\n\n\nÂ¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n1ï¸âƒ£ Volver a Agenda\n2ï¸âƒ£ Ir al menÃº principal\n\nðŸ‘‰ Solo escribe el nÃºmero de la opciÃ³n que prefieras",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        8640,
        12352
      ],
      "id": "b57b03f9-eeb5-49ab-b126-a9f3a3f22543",
      "name": "Que deseas hacer?1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Citas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "fecha": "={{ $('Datos Temporales').item.json.fecha_temporar }}",
            "hora": "={{ $('Telegram Trigger').item.json.message.text }}",
            "timestamp_creacion": "={{ new Date().toISOString() }}",
            "id_cita": "={{ $('Datos Temporales').item.json.cita_edit }}",
            "row_number": 0
          },
          "matchingColumns": [
            "id_cita"
          ],
          "schema": [
            {
              "id": "id_cita",
              "displayName": "id_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha",
              "displayName": "fecha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora",
              "displayName": "hora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo",
              "displayName": "motivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_creacion",
              "displayName": "timestamp_creacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        8304,
        12352
      ],
      "id": "03df51df-19f1-417e-a3f2-7795d5d8b0c5",
      "name": "Update row in sheet",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8be02210-0d18-42b0-8ecd-f540f74c6858",
              "leftValue": "={{ $json.cant_citas }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        5952,
        2048
      ],
      "id": "49c94b99-ec5a-4d88-b98d-6744775c51fc",
      "name": "If7"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“­ AÃºn no tienes citas agendadas\n\nCuando quieras, puedes crear una nueva y empezar a organizarte mejor ðŸ“…âœ¨\n\nðŸ‘‰ Escribe 1 para agendar una cita o 9 para volver al menÃº principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6192,
        2048
      ],
      "id": "7de30ffd-8dd8-481b-8f45-3ce43ce2b122",
      "name": "No Citas1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.result.chat.id }}",
        "text": "=Â¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Agendar una nueva cita\n2ï¸âƒ£ Consultar tu agenda\n3ï¸âƒ£ Reprogramar una cita\n4ï¸âƒ£ Cancelar una cita\n5ï¸âƒ£ Marcar una cita como completada\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6400,
        2016
      ],
      "id": "e1d8f70b-e055-4921-acb2-381520a98835",
      "name": "MenÃº Agenda4",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Citas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5872,
        2384
      ],
      "id": "e303ca79-24e1-4f7f-a2e5-c2998d617096",
      "name": "Agenda3",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Filtramos citas vÃ¡lidas\nconst citas = items\n  .filter(item => item.json && Object.keys(item.json).length > 0)\n  .map((item, index) => ({\n    numero: index + 1,\n    id: item.json.id_cita,\n    fecha: item.json.fecha,\n    hora: item.json.hora,\n    nombre: item.json.nombre\n  }));\n\n// Si no hay citas\nif (citas.length === 0) {\n  return [\n    {\n      json: {\n        mensaje: \"ðŸ“­ No tienes citas agendadas para reprogramar.\",\n        opciones: [],\n        cant_citas: 0\n      }\n    }\n  ];\n}\n\n// Construimos el mensaje dinÃ¡mico\nlet mensaje = \"âœï¸ **Elige la cita que deseas reprogramar:**\\n\\n\";\ncitas.forEach(cita => {\n  mensaje += `${cita.numero}. ${cita.fecha} ${cita.hora} - ${cita.nombre}\\n`;\n});\nmensaje += `\\n9ï¸âƒ£ Cancelar`;\n\n// Devolvemos el mensaje y las opciones\nreturn [\n  {\n    json: {\n      mensaje,\n      opciones: citas.map(c => c.numero).concat([9]),\n      citas,\n      creado_por: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        6064,
        2384
      ],
      "id": "2827ae6b-44e3-4ba9-9bb6-03686f43cd6a",
      "name": "Recorrer Agenda3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8be02210-0d18-42b0-8ecd-f540f74c6858",
              "leftValue": "={{ $json.cant_citas }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        6256,
        2384
      ],
      "id": "7bd63770-b7f8-408f-b37e-0a645eda4788",
      "name": "If8"
    },
    {
      "parameters": {
        "chatId": "={{ $json.creado_por }}",
        "text": "={{ \n  \"âœï¸ Elige la cita que deseas cancelar:\\n\\n\" + \n  $json[\"citas\"].map(c => c.numero + \". \" + c.fecha + \" --- \" + c.hora + \" - \" + c.nombre).join(\"\\n\") + \n  \"\\n\\nðŸ…¾ï¸ Cancelar\" \n}}\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6544,
        2544
      ],
      "id": "04741f71-c55b-46ca-a173-8a3bc65917ba",
      "name": "Mi Agenda2",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $json.result.chat.id }}",
            "paso_actual": "1",
            "pantalla_actual": "CANCELAR",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6768,
        2496
      ],
      "id": "29300b98-d370-4ec7-92dd-7c3f6cabac85",
      "name": "Act Paso14",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“­ AÃºn no tienes citas agendadas\n\nCuando quieras, puedes crear una nueva y empezar a organizarte mejor ðŸ“…âœ¨\n\nðŸ‘‰ Escribe 1 para agendar una cita o 9 para volver al menÃº principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6544,
        2352
      ],
      "id": "7f758214-baeb-485e-872f-055a8554348b",
      "name": "No Citas2",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.result.chat.id }}",
        "text": "=Â¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Agendar una nueva cita\n2ï¸âƒ£ Consultar tu agenda\n3ï¸âƒ£ Reprogramar una cita\n4ï¸âƒ£ Cancelar una cita\n5ï¸âƒ£ Marcar una cita como completada\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6752,
        2320
      ],
      "id": "5f6df13d-ee3d-4e89-a47e-802b77be2351",
      "name": "MenÃº Agenda5",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b321f78b-8819-4417-8c19-8cc290dbcec4",
              "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
              "rightValue": "0",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        6800,
        10736
      ],
      "id": "235a43ba-a452-4f38-9528-f77fb07247d4",
      "name": "If9"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7120,
        10592
      ],
      "id": "e9a34008-a07e-4024-b57f-b02c8519b5d8",
      "name": "Act Paso16",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        7264,
        10592
      ],
      "id": "17ce5bc0-188d-421f-ae0d-6a6e4c799f45",
      "name": "MenÃº Principal4",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âŒ Proceso cancelado\nðŸ”™ Regresando al menÃº principalâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6976,
        10592
      ],
      "id": "37659afd-43f2-44ab-a5e1-5212ced7d3f0",
      "name": "Cancelado3",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Citas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7344,
        10784
      ],
      "id": "22c2a82e-3494-41c0-af1e-c139c902e4a3",
      "name": "Agenda4",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Filtramos citas vÃ¡lidas\nconst citas = items\n  .filter(item => item.json && Object.keys(item.json).length > 0)\n  .map((item, index) => ({\n    numero: index + 1,\n    id: item.json.id_cita,\n    fecha: item.json.fecha,\n    hora: item.json.hora,\n    nombre: item.json.nombre\n  }));\n\n// Si no hay citas\nif (citas.length === 0) {\n  return [\n    {\n      json: {\n        mensaje: \"ðŸ“­ No tienes citas agendadas para reprogramar.\",\n        opciones: []\n      }\n    }\n  ];\n}\n\n// Construimos el mensaje dinÃ¡mico\nlet mensaje = \"âœï¸ **Elige la cita que deseas reprogramar:**\\n\\n\";\ncitas.forEach(cita => {\n  mensaje += `${cita.numero}. ${cita.fecha} ${cita.hora} - ${cita.nombre}\\n`;\n});\nmensaje += `\\n9ï¸âƒ£ Cancelar`;\n\n// Devolvemos el mensaje y las opciones\nreturn [\n  {\n    json: {\n      mensaje,\n      opciones: citas.map(c => c.numero).concat([9]),\n      citas,\n      creado_por: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        7504,
        10784
      ],
      "id": "d0717488-6bcc-42b2-bde2-6a6554dfb9cf",
      "name": "Recorrer Agenda4"
    },
    {
      "parameters": {
        "jsCode": "const opcion = Number($('Telegram Trigger').first().json.message.text);\nconst citas = $input.first().json.citas;\n\nif (opcion === 0) {\n  return [\n    { json: { accion: 'cancelar', mensaje: 'âŒ Proceso cancelado, regresando al menÃº principalâ€¦' } }\n  ];\n}\n\nconst citaSeleccionada = citas.find(c => c.numero === opcion);\n\nif (!citaSeleccionada) {\n  return [\n    { json: { accion: 'error', mensaje: 'âš ï¸ OpciÃ³n invÃ¡lida, intenta de nuevo.' } }\n  ];\n}\n\nreturn [\n  { json: { cita: citaSeleccionada } }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        7664,
        10784
      ],
      "id": "979e9051-92fb-4e5d-8c47-b8266976daaf",
      "name": "Seleccion1"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Recorrer Agenda4').item.json.creado_por }}",
            "paso_actual": "2",
            "pantalla_actual": "CANCELAR",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}",
            "cita_edit": "={{ $json.cita.id }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        8064,
        10784
      ],
      "id": "221d705b-b9cd-4f7b-bb51-793edd1b06fb",
      "name": "Act Paso17",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 2,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        7056,
        10848
      ],
      "id": "db34e68e-4838-4539-b5e4-39d70ec74358",
      "name": "Pasos Cancelar"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "799b6e2d-3eb6-4300-9d8f-97b1e1c66977",
              "leftValue": "={{ !isNaN($('Telegram Trigger').item.json.message.text) && ((Number($('Telegram Trigger').item.json.message.text) >= 1 && Number($('Telegram Trigger').item.json.message.text) <= 2))}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        7376,
        11024
      ],
      "id": "62285555-f566-49ab-860e-b2e614acb8b8",
      "name": "Veri OPC5"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_AGENDA",
            "cita_edit": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        8272,
        11008
      ],
      "id": "ecaeb582-7dca-467f-a96c-7d7708039f95",
      "name": "Act Paso18",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "cita_edit": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7952,
        11248
      ],
      "id": "f1f86ac9-ca4d-4a56-85f8-aa9f49eb1bd3",
      "name": "Act Paso19",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, ese nÃºmero no estÃ¡ dentro de las opciones disponibles.\n\nðŸ”¢ AsegÃºrate de que estÃ© dentro del menÃº, Â¡asÃ­ avanzamos sin problema!\n\nâ— AtenciÃ³n: Â¿EstÃ¡ seguro que desea cancelar la cita ID {{ $json.cita_edit }}?\n\n1ï¸âƒ£ SÃ­, confirmar y cancelar la cita\n2ï¸âƒ£ No, mantener la cita\n\nâœ¨ Responde solo con el nÃºmero de la opciÃ³n que prefieras, Â¡yo me encargo del resto! ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        7648,
        10944
      ],
      "id": "c7edb697-c24e-4e80-964e-11b43f50a574",
      "name": "OPC Invalido9",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“… Perfecto, entremos a tu agenda\n\nÂ¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Agendar una nueva cita\n2ï¸âƒ£ Consultar tu agenda\n3ï¸âƒ£ Reprogramar una cita\n4ï¸âƒ£ Cancelar una cita\n5ï¸âƒ£ Marcar una cita como completada\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        8640,
        10992
      ],
      "id": "d760ab4a-525e-495e-9d79-8fb6a8e89757",
      "name": "MenÃº Agenda6",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        8192,
        11200
      ],
      "id": "4d66bc4f-ed29-4ff6-98cb-efe1891584e2",
      "name": "MenÃº Principal5",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        7648,
        11184
      ],
      "id": "2ce38232-58ad-4152-8dc2-20c53638e69a",
      "name": "DecisiÃ³n"
    },
    {
      "parameters": {
        "chatId": "={{ $('Recorrer Agenda4').item.json.creado_por }}",
        "text": "=â— AtenciÃ³n: Â¿EstÃ¡ seguro que desea completar o cancelar la cita ID {{ $json.cita_edit }}?\n\n1ï¸âƒ£ SÃ­, confirmar y completar o cancelar la cita\n2ï¸âƒ£ No, mantener la cita\n\nâœ¨ Responde solo con el nÃºmero de la opciÃ³n que prefieras, Â¡yo me encargo del resto! ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        8208,
        10784
      ],
      "id": "c3180ac6-f2d1-4609-a42e-13c0d064ea8c",
      "name": "ConfirmaciÃ³n Cancelar",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "delete",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Citas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=0"
        },
        "startIndex": "={{ $json.row_number }}"
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        8096,
        11040
      ],
      "id": "00177eb0-fb6e-4c27-a517-7540943cd074",
      "name": "Delete rows or columns from sheet",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Citas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id_cita",
              "lookupValue": "={{ $('Datos Temporales').item.json.cita_edit }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        7872,
        11088
      ],
      "id": "ca016b8f-8949-437c-a70c-22a35da52f7b",
      "name": "Agenda5",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âœ… Cita cancelada con Ã©xito.\nâª Te estamos regresando al MenÃº de Agendaâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        8448,
        11008
      ],
      "id": "11762252-9f7a-4954-9649-4f4a37e2007b",
      "name": "MenÃº Agenda7",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5392,
        2832
      ],
      "id": "b04bb698-0fbf-4911-8447-18a458921c4a",
      "name": "Act Paso20",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5584,
        2880
      ],
      "id": "5fb53768-234f-44a5-8968-0dea6e05354b",
      "name": "MenÃº Principal6",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ”™ Regresando al menÃº principalâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5216,
        2752
      ],
      "id": "38dc638f-bfa4-46ce-acb9-aef2b782dfc3",
      "name": "Cancelado4",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Citas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5536,
        2656
      ],
      "id": "109bf7c5-8587-4ee0-bc9b-0bde456ac065",
      "name": "Agenda6",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Filtramos citas vÃ¡lidas\nconst citas = items\n  .filter(item => item.json && Object.keys(item.json).length > 0)\n  .map((item, index) => ({\n    numero: index + 1,\n    id: item.json.id_cita,\n    fecha: item.json.fecha,\n    hora: item.json.hora,\n    nombre: item.json.nombre\n  }));\n\n// Si no hay citas\nif (citas.length === 0) {\n  return [\n    {\n      json: {\n        mensaje: \"ðŸ“­ No tienes citas agendadas para reprogramar.\",\n        opciones: [],\n        cant_citas: 0\n      }\n    }\n  ];\n}\n\n// Construimos el mensaje dinÃ¡mico\nlet mensaje = \"âœï¸ **Elige la cita que deseas reprogramar:**\\n\\n\";\ncitas.forEach(cita => {\n  mensaje += `${cita.numero}. ${cita.fecha} ${cita.hora} - ${cita.nombre}\\n`;\n});\nmensaje += `\\n9ï¸âƒ£ Cancelar`;\n\n// Devolvemos el mensaje y las opciones\nreturn [\n  {\n    json: {\n      mensaje,\n      opciones: citas.map(c => c.numero).concat([9]),\n      citas,\n      creado_por: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5776,
        2672
      ],
      "id": "77294f41-70ac-489f-9572-01c2d08252f4",
      "name": "Recorrer Agenda5"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8be02210-0d18-42b0-8ecd-f540f74c6858",
              "leftValue": "={{ $json.cant_citas }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        6000,
        2768
      ],
      "id": "2bfa7065-6081-475d-8373-57acff6a964d",
      "name": "If10"
    },
    {
      "parameters": {
        "chatId": "={{ $json.creado_por }}",
        "text": "={{ \n  \"âœï¸ Elige la cita que deseas marcar como completada:\\n\\n\" + \n  $json[\"citas\"].map(c => c.numero + \". \" + c.fecha + \" --- \" + c.hora + \" - \" + c.nombre).join(\"\\n\") + \n  \"\\n\\nðŸ…¾ï¸ Cancelar\" \n}}\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6256,
        2896
      ],
      "id": "511ae78c-e3e0-4ba0-bf6d-a303fb1c86c4",
      "name": "Mi Agenda3",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $json.result.chat.id }}",
            "paso_actual": "1",
            "pantalla_actual": "CANCELAR",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6544,
        2912
      ],
      "id": "d4656c4f-f8f0-4604-a279-2ae2967fd4fa",
      "name": "Act Paso21",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“­ AÃºn no tienes citas agendadas\n\nCuando quieras, puedes crear una nueva y empezar a organizarte mejor ðŸ“…âœ¨\n\nðŸ‘‰ Escribe 1 para agendar una cita o 9 para volver al menÃº principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6256,
        2704
      ],
      "id": "2bb12514-467a-47d7-990d-90c330179d69",
      "name": "No Citas3",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.result.chat.id }}",
        "text": "=Â¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Agendar una nueva cita\n2ï¸âƒ£ Consultar tu agenda\n3ï¸âƒ£ Reprogramar una cita\n4ï¸âƒ£ Cancelar una cita\n5ï¸âƒ£ Marcar una cita como completada\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6512,
        2704
      ],
      "id": "7afc02b5-6e2b-4116-a619-e92bec317edb",
      "name": "MenÃº Agenda8",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_PRINCIPAL",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        64,
        2720
      ],
      "id": "2b9753b0-97b1-40e8-8bf6-285c803117d6",
      "name": "Saliendo",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ AgendaBot se retira por ahora.\nðŸ’¬ Para volver, solo escrÃ­beme cualquier mensaje.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        256,
        2832
      ],
      "id": "32a41524-c031-4c34-a8ec-9b5ffb9fb1f2",
      "name": "Hasta Luego",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b4356d95-f796-454b-9da3-c31f8fa82a3d",
              "leftValue": "={{ $json.accion }}",
              "rightValue": "error",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        8336,
        11456
      ],
      "id": "d8d42dba-13b6-4438-bbb6-9100682024b4",
      "name": "If11"
    },
    {
      "parameters": {
        "chatId": "={{ $('Recorrer Agenda2').item.json.creado_por }}",
        "text": "=âŒ Upsâ€¦ esa opciÃ³n no estÃ¡ disponible\n\nðŸ‘‰ Por favor, intenta nuevamente ingresando una opciÃ³n vÃ¡lida.\n\nðŸ”™ Si deseas cancelar el proceso, envÃ­a ðŸ…¾ï¸",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        8592,
        11360
      ],
      "id": "1c271d91-20d4-4c68-b602-ddbbd07567f3",
      "name": "Error",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b4356d95-f796-454b-9da3-c31f8fa82a3d",
              "leftValue": "={{ $json.accion }}",
              "rightValue": "error",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        7824,
        10768
      ],
      "id": "bc6bd135-5ddc-4693-9be0-9c7830575420",
      "name": "If12"
    },
    {
      "parameters": {
        "chatId": "={{ $('Recorrer Agenda4').item.json.creado_por }}",
        "text": "=âŒ Upsâ€¦ esa opciÃ³n no estÃ¡ disponible\n\nðŸ‘‰ Por favor, intenta nuevamente ingresando una opciÃ³n vÃ¡lida.\n\nðŸ”™ Si deseas cancelar el proceso, envÃ­a ðŸ…¾ï¸",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        8096,
        10592
      ],
      "id": "7a25013f-66ea-4be1-a858-78c0280865ce",
      "name": "Error1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_TAREAS",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        464,
        1728
      ],
      "id": "587a4e4c-03d5-4171-890a-28e1a62ce0f3",
      "name": "MenÃº Tareas",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“’ Perfecto, entremos a tus Tareas\n\nÂ¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Crear una nueva tarea\n2ï¸âƒ£ Consultar tus tareas\n3ï¸âƒ£ Eliminar una tarea \n4ï¸âƒ£ Marcar una tarea como completada\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        608,
        1728
      ],
      "id": "e78bb45b-d385-46d4-bef0-1afd11ca5f69",
      "name": "MenÃº Tareas1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, ese nÃºmero no estÃ¡ dentro de las opciones disponibles.\n\nðŸ”¢ AsegÃºrate de que estÃ© dentro del menÃº, Â¡asÃ­ avanzamos sin problema!\n\n1ï¸âƒ£ Crear una nueva tarea\n2ï¸âƒ£ Consultar tus tareas\n3ï¸âƒ£ Eliminar una tarea\n4ï¸âƒ£ Marcar una tarea como completada\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5136,
        3776
      ],
      "id": "7fd92913-5e5f-4098-9082-80141cd4f01f",
      "name": "OPC Invalido10",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "799b6e2d-3eb6-4300-9d8f-97b1e1c66977",
              "leftValue": "={{ !isNaN($('Telegram Trigger').item.json.message.text) && ((Number($('Telegram Trigger').item.json.message.text) >= 1 && Number($('Telegram Trigger').item.json.message.text) <= 4) || Number($('Telegram Trigger').item.json.message.text) === 9)}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4976,
        3936
      ],
      "id": "4f67ad92-cdef-4ebc-bb11-aef2f5c69fa7",
      "name": "Veri OPC6"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8be02210-0d18-42b0-8ecd-f540f74c6858",
              "leftValue": "={{ $json.total_tareas }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        6032,
        3792
      ],
      "id": "8bb4b096-3653-41f5-815f-3f92dc3a80f0",
      "name": "If13"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Recorrer Tareas1').item.json.creado_por }}",
            "paso_actual": "1",
            "pantalla_actual": "ELIMINAR_TAREA",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6512,
        4144
      ],
      "id": "77f2d1be-f18d-4525-8e33-2ace5d45f49f",
      "name": "Act Paso22",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8be02210-0d18-42b0-8ecd-f540f74c6858",
              "leftValue": "={{ $json.total_tareas }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        6048,
        4000
      ],
      "id": "83f0a1a5-53bf-4428-b078-49ed8d6922ce",
      "name": "If14"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8be02210-0d18-42b0-8ecd-f540f74c6858",
              "leftValue": "={{ $json.total_tareas }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        6128,
        4352
      ],
      "id": "29d76193-84e8-4233-b3ad-9bcef58ad693",
      "name": "If15"
    },
    {
      "parameters": {
        "chatId": "={{ $json.creado_por }}",
        "text": "={{ \n  \"ðŸ—‘ï¸ *Completar tarea*\\n\\n\" +\n  \"âœï¸ Elige la tarea que deseas marcar como Completada:\\n\\n\" +\n  $json[\"tareas\"].map(t => \n    t.numero + \"ï¸âƒ£ *\" + t.titulo + \"*\\n\" +\n    \"   ðŸ“Œ Prioridad: \" + t.prioridad + \"\\n\" +\n    \"   ðŸ“Š Estado: \" + t.estado + \"\\n\" +\n    \"   ðŸ“… Fecha: \" + t.fecha + \"\\n\"\n  ).join(\"\\n\") +\n  \"\\nðŸ…¾ï¸ *0.* Cancelar\"\n}}\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6464,
        4544
      ],
      "id": "f091d429-b16e-484c-ae61-c8ff43657dba",
      "name": "Mi Agenda6",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $json.result.chat.id }}",
            "paso_actual": "1",
            "pantalla_actual": "CAMBIAR_ESTADO",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6736,
        4544
      ],
      "id": "21ffc28d-4715-43de-8c2b-e982c3dc3266",
      "name": "Act Paso23",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5840,
        4592
      ],
      "id": "146f9545-4901-4f52-8703-3fa4279f1414",
      "name": "Act Paso24",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6048,
        4608
      ],
      "id": "cb42a6a2-7ff1-4626-a9d5-541f5d991393",
      "name": "MenÃº Principal7",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ”™ Regresando al menÃº principalâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5600,
        4576
      ],
      "id": "d8f6522b-2fbc-4c15-b756-ec1b2daa4d2e",
      "name": "Cancelado5",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "1",
            "pantalla_actual": "NUEVA_TAREA",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5664,
        3600
      ],
      "id": "727f444a-ae46-45f6-90bc-94c79fd747c8",
      "name": "Nueva Tarea",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸŸ¢ Paso 1 de 4\nðŸ“ Â¿CÃ³mo se llama la tarea?\n\n9ï¸âƒ£ Cancelar y salir\n\nðŸ‘‰ Escribe el nombre de la tarea o envÃ­a 9 si prefieres cancelar el proceso ðŸ˜Š",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5824,
        3600
      ],
      "id": "2e1ca6a7-29cf-4bf4-9f31-dcd1ae1bc0a5",
      "name": "Nombre Tarea",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e818d0d0-c42e-4989-b4b5-a7d7fce3eefb",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f8ea4bb7-520a-4c4a-a25d-6d7b6fdca1a7",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "4",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "bb6457a1-41f0-4456-81c1-ff8b931bcc5a",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        5392,
        4112
      ],
      "id": "2a53c977-eb7d-4575-b904-8f4e0cdec76f",
      "name": "MenÃº Tarea"
    },
    {
      "parameters": {
        "jsCode": "const tareas = items\n  .filter(item => item.json && Object.keys(item.json).length > 0)\n  .map(item => ({\n    id: item.json.id_tarea,\n    titulo: item.json.titulo,\n    prioridad: item.json.prioridad,\n    estado: item.json.estado,\n    fecha: item.json.fecha_objetivo\n  }));\n\nreturn [\n  {\n    json: {\n      total_tareas: tareas.length,\n      tareas,\n      creado_por: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5856,
        3792
      ],
      "id": "5c20dfa2-58f1-484f-b30f-84febbadd4f5",
      "name": "Recorrer Tareas"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“­ AÃºn no tienes tareas registradas\n\nCuando quieras, puedes crear una nueva y empezar a organizarte mejor ðŸ“…âœ¨\n\nðŸ‘‰ Escribe 1 para registrar una tarea o 9 para volver al menÃº principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6224,
        3696
      ],
      "id": "47955d6f-81a7-4192-a79d-af4657d307d5",
      "name": "No Tareas",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.creado_por }}",
        "text": "=ðŸ“… *Tienes {{ $json.total_tareas }} tareas registradas*:\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n{{ \n  $json.tareas.map(c => \n`ðŸ†” *ID:* ${c.id}\nðŸ“ *Tarea:* ${c.titulo}\nâš¡ *Prioridad:* ${c.prioridad}\nðŸ“Š *Estado:* ${c.estado}\nðŸ“… *Fecha:* ${c.fecha}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`\n  ).join('\\n')\n}}\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6224,
        3856
      ],
      "id": "80cbcbfe-5d3f-42da-ae28-f46b4018f86c",
      "name": "Mis Tareas",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Recorrer Tareas').item.json.creado_por }}",
        "text": "=Â¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Crear una nueva tarea\n2ï¸âƒ£ Consultar tus tareas\n3ï¸âƒ£ Eliminar una tarea\n4ï¸âƒ£ Marcar una tarea como completada\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6480,
        3760
      ],
      "id": "961a9b32-b588-496e-aba3-348cfe60988a",
      "name": "MenÃº Tareas2",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 963194097,
          "mode": "list",
          "cachedResultName": "Tareas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=963194097"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5664,
        3792
      ],
      "id": "814b7abf-51bd-4903-b4a9-8bd3727e3d03",
      "name": "Tareas",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 963194097,
          "mode": "list",
          "cachedResultName": "Tareas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=963194097"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5664,
        4000
      ],
      "id": "b0509133-2a16-4c52-87f1-aedfb5f5aa16",
      "name": "Tareas1",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Filtramos citas vÃ¡lidas\nconst tareas = items\n  .filter(item => item.json && Object.keys(item.json).length > 0)\n  .map((item, index) => ({\n    numero: index + 1,\n    id: item.json.id_tarea,\n    titulo: item.json.titulo,\n    prioridad: item.json.prioridad,\n    estado: item.json.estado,\n    fecha: item.json.fecha_objetivo\n  }));\n\n// Si no hay tareas\nif (tareas.length === 0) {\n  return [\n    {\n      json: {\n        mensaje: \"ðŸ“­ No tienes tareas agendadas para reprogramar.\",\n        opciones: [],\n        total_tareas: 0\n      }\n    }\n  ];\n}\n\n// Construimos el mensaje dinÃ¡mico\nlet mensaje = \"âœï¸ **Elige la tarea que deseas reprogramar:**\\n\\n\";\ntareas.forEach(tarea => {\n  mensaje += `${tarea.numero}. ${tarea.titulo} ${tarea.prioridad} - ${tarea.estado} ${tarea.fecha}\\n`;\n});\nmensaje += `\\n9ï¸âƒ£ Cancelar`;\n\n// Devolvemos el mensaje y las opciones\nreturn [\n  {\n    json: {\n      mensaje,\n      opciones: tareas.map(t => t.numero).concat([9]),\n      tareas,\n      total_tareas:tareas.length ,\n      creado_por: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5856,
        4000
      ],
      "id": "7ba38164-e859-43f0-b72a-364dde560d16",
      "name": "Recorrer Tareas1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“­ AÃºn no tienes tareas registradas\n\nCuando quieras, puedes crear una nueva y empezar a organizarte mejor ðŸ“…âœ¨\n\nðŸ‘‰ Escribe 1 para registrar una tarea o 9 para volver al menÃº principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6288,
        4016
      ],
      "id": "b7900a5b-3579-4f4a-a481-a7558eadd253",
      "name": "No Tareas1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Recorrer Tareas1').item.json.creado_por }}",
        "text": "=Â¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Crear una nueva tarea\n2ï¸âƒ£ Consultar tus tareas\n3ï¸âƒ£ Eliminar una tarea\n4ï¸âƒ£ Marcar una tarea como completada\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6512,
        3984
      ],
      "id": "1729a6a3-9b7d-4efc-b23f-c09062d2de3f",
      "name": "MenÃº Tareas3",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.creado_por }}",
        "text": "={{ \n  \"ðŸ—‘ï¸ *Eliminar tarea*\\n\\n\" +\n  \"âœï¸ Elige la tarea que deseas eliminar:\\n\\n\" +\n  $json[\"tareas\"].map(t => \n    t.numero + \"ï¸âƒ£ *\" + t.titulo + \"*\\n\" +\n    \"   ðŸ“Œ Prioridad: \" + t.prioridad + \"\\n\" +\n    \"   ðŸ“Š Estado: \" + t.estado + \"\\n\" +\n    \"   ðŸ“… Fecha: \" + t.fecha + \"\\n\"\n  ).join(\"\\n\") +\n  \"\\nðŸ…¾ï¸ *0.* Cancelar\"\n}}\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6288,
        4176
      ],
      "id": "4bcdc4fb-3171-4fe5-9922-0f1791c184dc",
      "name": "Mis Tareas1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 963194097,
          "mode": "list",
          "cachedResultName": "Tareas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=963194097"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5712,
        4352
      ],
      "id": "d88bd907-7fc5-456d-a52c-3917263021dd",
      "name": "Tareas2",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Filtramos citas vÃ¡lidas\nconst tareas = items\n  .filter(item => item.json && Object.keys(item.json).length > 0)\n  .map((item, index) => ({\n    numero: index + 1,\n    id: item.json.id_tarea,\n    titulo: item.json.titulo,\n    prioridad: item.json.prioridad,\n    estado: item.json.estado,\n    fecha: item.json.fecha_objetivo\n  }));\n\n// Si no hay tareas\nif (tareas.length === 0) {\n  return [\n    {\n      json: {\n        mensaje: \"ðŸ“­ No tienes tareas agendadas para reprogramar.\",\n        opciones: [],\n        total_tareas: 0\n      }\n    }\n  ];\n}\n\n// Devolvemos el mensaje y las opciones\nreturn [\n  {\n    json: {\n      opciones: tareas.map(t => t.numero).concat([9]),\n      tareas,\n      total_tareas:tareas.length ,\n      creado_por: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5920,
        4352
      ],
      "id": "f9fba07d-7533-41cd-9c91-e63b1e844c84",
      "name": "Recorrer Tareas2"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“­ AÃºn no tienes tareas registradas\n\nCuando quieras, puedes crear una nueva y empezar a organizarte mejor ðŸ“…âœ¨\n\nðŸ‘‰ Escribe 1 para registrar una tarea o 9 para volver al menÃº principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6448,
        4352
      ],
      "id": "53177269-9a27-4dca-bbe8-d5c0828dba98",
      "name": "No Tareas2",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.result.chat.id }}",
        "text": "=Â¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Crear una nueva tarea\n2ï¸âƒ£ Consultar tus tareas\n3ï¸âƒ£ Eliminar una tarea\n4ï¸âƒ£ Marcar una tarea como completada\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6704,
        4336
      ],
      "id": "0074f97c-d4ae-4259-a4f6-f96c7d2a41b5",
      "name": "MenÃº Tareas4",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "05deba36-8c97-4e18-bf89-f5aa3e57ed13",
              "leftValue": "={{ $json.valido }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        6000,
        5168
      ],
      "id": "9c29e298-7a55-49f3-b23e-809f52000c8e",
      "name": "If16"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }},\nla fecha {{ $('Telegram Trigger').item.json.message.text }} no es vÃ¡lida.\n\nðŸ“… AsegÃºrate de escribirla en el formato correcto YYYY-MM-DD\nðŸ•’ y que sea una fecha igual o posterior a hoy.\n\nâœï¸ Ejemplo vÃ¡lido: 2025-12-20\n\nðŸ‘‰ IntÃ©ntalo nuevamente, yo te acompaÃ±o ðŸ˜‰\n\nÂ¿CuÃ¡l es la fecha de la cita?\n\n9ï¸âƒ£ Cancelar y salir",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6176,
        5024
      ],
      "id": "6c86ddca-b0d9-4d7d-b2d8-b1499bf283cb",
      "name": "OPC Invalido11",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "3",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6304,
        5152
      ],
      "id": "15a2febb-6c54-47b6-92fc-96714d88ab93",
      "name": "Act Paso25",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const input = ($('Telegram Trigger').first().json.message.text || '').trim();\n\n// ðŸ‘‰ Validar formato YYYY-MM-DD\nconst regexFecha = /^\\d{4}-\\d{2}-\\d{2}$/;\n\nif (!regexFecha.test(input)) {\n  return [{\n    valido: false,\n    mensaje: 'âŒ Formato invÃ¡lido. Usa YYYY-MM-DD (ejemplo: 2025-12-20).'\n  }];\n}\n\n// ðŸ‘‰ Convertir fecha ingresada\nconst fechaIngresada = new Date(input + 'T00:00:00');\n\n// ðŸ‘‰ Validar que la fecha exista realmente\nif (isNaN(fechaIngresada.getTime())) {\n  return [{\n    valido: false,\n    mensaje: 'âŒ La fecha ingresada no es vÃ¡lida. Verifica el dÃ­a y el mes.'\n  }];\n}\n\n// ðŸ‘‰ Fecha actual (sin hora)\nconst hoy = new Date();\nhoy.setHours(0, 0, 0, 0);\n\n// ðŸ‘‰ No permitir fechas pasadas\nif (fechaIngresada < hoy) {\n  return [{\n    valido: false,\n    mensaje: 'â° No puedes agendar citas en fechas pasadas. Elige una fecha futura.'\n  }];\n}\n\n// âœ… Fecha vÃ¡lida\nreturn [{\n  valido: true,\n  fecha: input\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5824,
        5184
      ],
      "id": "c0da7812-feaa-40c8-8cb2-eaa80d7043d1",
      "name": "Verificar Fecha2"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "2",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5392,
        5040
      ],
      "id": "93201b24-80fd-4801-a824-87c6afbcdd18",
      "name": "Act Paso27",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "799b6e2d-3eb6-4300-9d8f-97b1e1c66977",
              "leftValue": "={{ !isNaN($('Telegram Trigger').item.json.message.text) && ((Number($('Telegram Trigger').item.json.message.text) >= 1 && Number($('Telegram Trigger').item.json.message.text) <= 3))}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        5888,
        5376
      ],
      "id": "a10ededa-3610-4373-86b6-397205967ca1",
      "name": "Veri OPC7"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, ese nÃºmero no corresponde a ninguna opciÃ³n vÃ¡lida.\n\nðŸ‘‰ Para continuar, escribe solo el nÃºmero del tipo de atenciÃ³n que deseas.\nðŸ”¢ AsegÃºrate de que estÃ© dentro de las opciones mostradas para que podamos avanzar sin enredos.\n\nðŸ“ Â¿QuÃ© prioridad tiene la tarea?\n\nElige la opciÃ³n que mejor la describa:\n\n1ï¸âƒ£ Alta\n2ï¸âƒ£ Media\n3ï¸âƒ£ Baja\n\nðŸ‘‰ Escribe solo el nÃºmero de la opciÃ³n que prefieras ðŸ˜Š\n\n9ï¸âƒ£ Cancelar y salir",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6192,
        5360
      ],
      "id": "c5f2c385-3baa-4ddb-abe6-5b9dec6f31da",
      "name": "OPC Invalido13",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "4",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6704,
        5504
      ],
      "id": "e992e0f7-176a-453f-9098-a6b2fe8ce413",
      "name": "Act Paso29",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "799b6e2d-3eb6-4300-9d8f-97b1e1c66977",
              "leftValue": "={{ !isNaN($('Telegram Trigger').item.json.message.text) && ((Number($('Telegram Trigger').item.json.message.text) >= 1 && Number($('Telegram Trigger').item.json.message.text) <= 3))}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        5872,
        5760
      ],
      "id": "e9ecbeff-fd2c-40fa-aa65-6c0649587f83",
      "name": "Veri OPC8"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, ese nÃºmero no corresponde a ninguna opciÃ³n vÃ¡lida.\n\nðŸ‘‰ Para continuar, escribe solo el nÃºmero de la acciÃ³n que deseas realizar\nðŸ”¢ AsegÃºrate de que estÃ© dentro de las opciones mostradas para que podamos avanzar sin enredos.\n\nðŸ“… Fecha: {{ $('Datos Temporales').item.json.fecha_temporar }}\nâ° Hora: {{ $('Datos Temporales').item.json.hora_temporal }}\nðŸ‘¤ Cliente: {{ $('Datos Temporales').item.json.nombre_temporal }}\nðŸ—’ï¸ Motivo: {{ $('Datos Temporales').item.json.motivo_temporal }}\nðŸ“ Canal: {{ $('Datos Temporales').item.json.canal_temporal }}\n\nðŸ‘‰ Â¿QuÃ© deseas hacer ahora?\n\n1ï¸âƒ£ Confirmar y guardar la cita\n2ï¸âƒ£ Editar la informaciÃ³n\n3ï¸âƒ£ Cancelar el agendamiento\n\nâœ¨ Escribe solo el nÃºmero de la opciÃ³n que elijas y yo me encargo del resto ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6144,
        5728
      ],
      "id": "035543e8-ab77-4d9d-9aef-18f559772014",
      "name": "OPC Invalido14",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "fecha_temporar": "={{ $('Telegram Trigger').item.json.message.text }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6448,
        5152
      ],
      "id": "c99ab58f-acf2-4927-b883-e8828ac5aa9b",
      "name": "Almacenar8",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "nombre_temporal": "={{ $('Telegram Trigger').item.json.message.text }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5520,
        5040
      ],
      "id": "a5381f28-b55e-4cc0-adea-91eb4b91179f",
      "name": "Almacenar10",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "canal_temporal": "Alta"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6464,
        5360
      ],
      "id": "c374e8b1-5ba4-49e8-8e12-22228a7d7548",
      "name": "Almacenar12",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "canal_temporal": "Media"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6464,
        5504
      ],
      "id": "1bbc7831-2f9f-410c-976f-f182ea765837",
      "name": "Almacenar13",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "canal_temporal": "Baja"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6464,
        5648
      ],
      "id": "9a96a05c-c011-43ae-ad2c-6b359595787a",
      "name": "Almacenar14",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6864,
        5504
      ],
      "id": "a485a054-6121-464d-a756-775bdef4b5e2",
      "name": "Datos Temporales2",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e818d0d0-c42e-4989-b4b5-a7d7fce3eefb",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        6048,
        6128
      ],
      "id": "158f9aab-e6b3-4552-8885-9a92d453a017",
      "name": "ConfirmaciÃ³n1"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 963194097,
          "mode": "list",
          "cachedResultName": "Tareas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=963194097"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "creado_por": "={{ $json.autor }}",
            "estado": "Pendiente",
            "id_tarea": "=TAREA - 00{{ $json.contador }}{{ $json.autor }}",
            "titulo": "={{ $json.titulo }}",
            "prioridad": "={{ $json.prioridad }}",
            "fecha_objetivo": "={{ $json.fecha }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_tarea",
              "displayName": "id_tarea",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "titulo",
              "displayName": "titulo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "prioridad",
              "displayName": "prioridad",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_objetivo",
              "displayName": "fecha_objetivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6656,
        5984
      ],
      "id": "13ebbcfb-ced9-4e59-86c0-f58fd3f9c804",
      "name": "Append row in sheet1",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Verifica si hay al menos un item con json vacÃ­o\nconst hayObjetoVacio = items.some(\n  item => item.json && Object.keys(item.json).length === 0\n);\n\n// Calcula la cantidad de citas\nconst cantidad_tareas = hayObjetoVacio\n  ? items.length - 1\n  : items.length;\n\nreturn [\n  {\n    json: {\n      cantidad_tareas,\n      titulo:$('Datos Temporales').first().json.nombre_temporal,\n      prioridad: $('Datos Temporales').first().json.canal_temporal,\n      fecha: $('Datos Temporales').first().json.fecha_temporar,\n      autor: $('Telegram Trigger').first().json.message.chat.id,\n      contador: $('Datos Temporales').first().json.n_tareas\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        6480,
        5984
      ],
      "id": "14e19e21-4252-493c-b455-224637c468f7",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Code in JavaScript1').item.json.autor }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_TAREAS",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}",
            "fecha_temporar": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}",
            "cita_edit": "={{\"\"}}",
            "n_tareas": "={{ $('Code in JavaScript1').item.json.contador + 1 }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "n_citas",
              "displayName": "n_citas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "n_tareas",
              "displayName": "n_tareas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6832,
        5984
      ],
      "id": "79920a72-65cf-497f-b6f4-7cc0cded8093",
      "name": "Act Paso30",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Code in JavaScript1').item.json.autor }}",
        "text": "=âœ… Â¡Listo! Tu tarea quedÃ³ registrada con Ã©xito\n\nÂ¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Crear una nueva tarea\n2ï¸âƒ£ Consultar tus tareas\n3ï¸âƒ£ Eliminar una tarea\n4ï¸âƒ£ Marcar una tarea como completada\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6992,
        5984
      ],
      "id": "dbbb3102-a8bd-4937-8d53-4c18df23bc9f",
      "name": "Que deseas hacer?2",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6416,
        6448
      ],
      "id": "f1fd1822-bb2b-4771-a1dc-182ab53618d3",
      "name": "Act Paso31",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6560,
        6448
      ],
      "id": "db5a0ee8-3bcd-4386-8bf5-34c0af692713",
      "name": "MenÃº Principal8",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âŒ Proceso cancelado\nðŸ”™ Regresando al menÃº principalâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6272,
        6448
      ],
      "id": "b0adaff0-63ec-4eb3-b28f-d6fc3512e697",
      "name": "Cancelado6",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "1",
            "pantalla_actual": "NUEVA_TAREA",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6320,
        6176
      ],
      "id": "9bde91bd-ff53-48aa-8ba0-263124539dbf",
      "name": "Act Paso32",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Okey, Volvamos a empezar\n\nðŸŸ¢ Paso 1 de 5\nðŸ“ Â¿CÃ³mo se llama la tarea?\n\n9ï¸âƒ£ Cancelar y salir\n\nðŸ‘‰ Escribe el nombre de la tarea o envÃ­a 9 si prefieres cancelar el proceso ðŸ˜Š",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6496,
        6176
      ],
      "id": "ab21bb69-5d2d-456c-8e58-c50566148e24",
      "name": "Volver a empezar1",
      "webhookId": "6ac59f7b-9940-4518-bca6-a00c60af2b5e",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 2,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e818d0d0-c42e-4989-b4b5-a7d7fce3eefb",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 3,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f8ea4bb7-520a-4c4a-a25d-6d7b6fdca1a7",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 4,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        5232,
        5376
      ],
      "id": "3d922953-cb8c-4d81-afbc-41af28e22091",
      "name": "Pasos Nueva Tarea"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸŸ¢ Paso 3 de 4\nðŸ“ Â¿QuÃ© prioridad tiene la tarea?\n\nElige la opciÃ³n que mejor la describa:\n\n1ï¸âƒ£ Alta\n2ï¸âƒ£ Media\n3ï¸âƒ£ Baja\n\nðŸ‘‰ Escribe solo el nÃºmero de la opciÃ³n que prefieras ðŸ˜Š\n\n9ï¸âƒ£ Cancelar y salir",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6656,
        5120
      ],
      "id": "11da2b29-e7bd-4dd7-b368-2f89f2ce2241",
      "name": "Proridad",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e818d0d0-c42e-4989-b4b5-a7d7fce3eefb",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        6192,
        5504
      ],
      "id": "b5a1d687-8080-4f7f-9769-79efe517c6bc",
      "name": "Prioridad"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“ Revisa la informaciÃ³n de tu tarea\n\nAntes de guardarla, confirma que todo estÃ© correcto ðŸ‘€âœ…\n\nðŸ“Œ TÃ­tulo: {{ $('Datos Temporales').item.json.nombre_temporal }}\nâš¡ Prioridad: {{ $('Datos Temporales2').item.json.canal_temporal }}\nðŸ“… Fecha objetivo: {{ $('Datos Temporales').item.json.fecha_temporar }}\n\nðŸ‘‰ Â¿QuÃ© deseas hacer ahora?\n\n1ï¸âƒ£ Confirmar y guardar la tarea\n2ï¸âƒ£ Editar la informaciÃ³n\n3ï¸âƒ£ Cancelar el registro\n\nâœ¨ Escribe solo el nÃºmero de la opciÃ³n que elijas y yo me encargo del resto ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        7024,
        5504
      ],
      "id": "7ceb6d7a-41e5-40f6-b56e-8b80f14ec5fe",
      "name": "ConfirmaciÃ³n Tarea",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 963194097,
          "mode": "list",
          "cachedResultName": "Tareas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=963194097"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6304,
        5984
      ],
      "id": "a0a81d7b-e4d7-4fca-b859-0300388149e8",
      "name": "Cant Tareas",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b321f78b-8819-4417-8c19-8cc290dbcec4",
              "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
              "rightValue": "0",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        5152,
        6816
      ],
      "id": "882223d2-cdcd-4408-8c56-db6918f3f9f3",
      "name": "If17"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5472,
        6672
      ],
      "id": "4e24e7d2-3102-4ca2-b8c3-d72751b33025",
      "name": "Act Paso26",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5616,
        6672
      ],
      "id": "02bd248f-403c-4d45-a87f-5130779ba7bb",
      "name": "MenÃº Principal9",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âŒ Proceso cancelado\nðŸ”™ Regresando al menÃº principalâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5328,
        6672
      ],
      "id": "a45c7627-c8cc-4976-a5cd-7df4a478ffaa",
      "name": "Cancelado7",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 963194097,
          "mode": "list",
          "cachedResultName": "Tareas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=963194097"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5696,
        6864
      ],
      "id": "87bac004-8774-40a5-a120-9d7d8b592ec6",
      "name": "Agenda7",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const opcion = Number($('Telegram Trigger').first().json.message.text);\nconst tareas = $input.first().json.tareas;\n\nif (opcion === 0) {\n  return [\n    { json: { accion: 'cancelar', mensaje: 'âŒ Proceso cancelado, regresando al menÃº principalâ€¦' } }\n  ];\n}\n\nconst tareaSeleccionada = tareas.find(t => t.numero === opcion);\n\nif (!tareaSeleccionada) {\n  return [\n    { json: { accion: 'error', mensaje: 'âš ï¸ OpciÃ³n invÃ¡lida, intenta de nuevo.' } }\n  ];\n}\n\nreturn [\n  { json: { tarea: tareaSeleccionada } }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        6016,
        6864
      ],
      "id": "52b4e8dd-7372-4c34-8fa9-c0bea494137a",
      "name": "Seleccion2"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Recorrer Tareas3').item.json.creado_por }}",
            "paso_actual": "2",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}",
            "cita_edit": "={{ $json.tarea.id }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6416,
        6864
      ],
      "id": "dbab11a3-aecd-4bf3-bd9b-89072a7b20db",
      "name": "Act Paso28",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 2,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        5408,
        6928
      ],
      "id": "aba1d4e9-ab29-4b64-b44d-4f0c76a800a9",
      "name": "Pasos Cancelar1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "799b6e2d-3eb6-4300-9d8f-97b1e1c66977",
              "leftValue": "={{ !isNaN($('Telegram Trigger').item.json.message.text) && ((Number($('Telegram Trigger').item.json.message.text) >= 1 && Number($('Telegram Trigger').item.json.message.text) <= 2) || Number($('Telegram Trigger').item.json.message.text) === 9)}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        5728,
        7104
      ],
      "id": "eacb7432-7536-4f81-912d-9dfb5b700fef",
      "name": "Veri OPC9"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_TAREAS",
            "cita_edit": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6832,
        7088
      ],
      "id": "60a09dec-215c-4db1-8ac1-50b98559bb35",
      "name": "Act Paso33",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "cita_edit": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6512,
        7328
      ],
      "id": "b52b3a6c-6b68-4cd4-a5bd-cd574dba133f",
      "name": "Act Paso34",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, ese nÃºmero no estÃ¡ dentro de las opciones disponibles.\n\nðŸ”¢ AsegÃºrate de que estÃ© dentro del menÃº, Â¡asÃ­ avanzamos sin problema!\n\nâ— AtenciÃ³n: Â¿EstÃ¡ seguro que desea cancelar la cita ID {{ $json.cita_edit }}?\n\n1ï¸âƒ£ SÃ­, confirmar y cancelar la cita\n2ï¸âƒ£ No, mantener la cita\n\nâœ¨ Responde solo con el nÃºmero de la opciÃ³n que prefieras, Â¡yo me encargo del resto! ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6000,
        7024
      ],
      "id": "b0ed57bb-3d6c-47ae-89ac-221c768da0cb",
      "name": "OPC Invalido15",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Â¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Crear una nueva tarea\n2ï¸âƒ£ Consultar tus tareas\n3ï¸âƒ£ Eliminar una tarea\n4ï¸âƒ£ Marcar una tarea como completada\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        7200,
        7072
      ],
      "id": "9f2be702-c1a6-4d8c-9a73-c81b82c0c68b",
      "name": "MenÃº Agenda9",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6944,
        7296
      ],
      "id": "2e02104e-c16b-46ec-9296-24f2e34d5247",
      "name": "MenÃº Principal10",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        6208,
        7264
      ],
      "id": "351a6857-5ef9-4c22-b0bf-84e49f7b3f0a",
      "name": "DecisiÃ³n1"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "delete",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 963194097,
          "mode": "list",
          "cachedResultName": "Tareas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=963194097"
        },
        "startIndex": "={{ $json.row_number }}"
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6656,
        7120
      ],
      "id": "9c42fce7-0f26-4e8b-8dc5-0f5c76597f26",
      "name": "Delete rows or columns from sheet1",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 963194097,
          "mode": "list",
          "cachedResultName": "Tareas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=963194097"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id_tarea",
              "lookupValue": "={{ $('Datos Temporales').item.json.cita_edit }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6432,
        7168
      ],
      "id": "ba42d363-9bd5-4853-ac58-420f9fb23c57",
      "name": "Agenda8",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b4356d95-f796-454b-9da3-c31f8fa82a3d",
              "leftValue": "={{ $json.accion }}",
              "rightValue": "error",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        6176,
        6848
      ],
      "id": "c6306567-83b4-4932-9560-3bc4bd6a91e6",
      "name": "If18"
    },
    {
      "parameters": {
        "chatId": "={{ $('Recorrer Tareas3').item.json.creado_por }}",
        "text": "=âŒ Upsâ€¦ esa opciÃ³n no estÃ¡ disponible\n\nðŸ‘‰ Por favor, intenta nuevamente ingresando una opciÃ³n vÃ¡lida.\n\nðŸ”™ Si deseas cancelar el proceso, envÃ­a ðŸ…¾ï¸",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6448,
        6672
      ],
      "id": "533d0f4e-dcd6-48a7-acda-00f6395d090c",
      "name": "Error2",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Filtramos citas vÃ¡lidas\nconst tareas = items\n  .filter(item => item.json && Object.keys(item.json).length > 0)\n  .map((item, index) => ({\n    numero: index + 1,\n    id: item.json.id_tarea,\n    titulo: item.json.titulo,\n    prioridad: item.json.prioridad,\n    estado: item.json.estado,\n    fecha: item.json.fecha_objetivo\n  }));\n\n// Si no hay citas\nif (tareas.length === 0) {\n  return [\n    {\n      json: {\n        mensaje: \"ðŸ“­ No tienes citas agendadas para reprogramar.\",\n        opciones: []\n      }\n    }\n  ];\n}\n\n// Devolvemos el mensaje y las opciones\nreturn [\n  {\n    json: {\n      opciones: tareas.map(c => c.numero).concat([9]),\n      tareas,\n      creado_por: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5856,
        6864
      ],
      "id": "59c7fe51-bb67-4db8-9d63-159392fc955e",
      "name": "Recorrer Tareas3"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âœ… Tarea Eliminada con Ã©xito.\nâª Te estamos regresando al MenÃº de Tareasâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        7008,
        7088
      ],
      "id": "0dca1317-ed21-481c-b7f0-8d68e6ae1b6a",
      "name": "MenÃº Tareas5",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b321f78b-8819-4417-8c19-8cc290dbcec4",
              "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
              "rightValue": "0",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        5232,
        8080
      ],
      "id": "98b0cf30-4ff4-400d-9d1a-9880526d229f",
      "name": "If19"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5552,
        7936
      ],
      "id": "7d3accc5-3b10-4c0f-9350-e7790bfedc6e",
      "name": "Act Paso35",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5696,
        7936
      ],
      "id": "ed102785-d3e5-4649-acb0-cc7f13a7bdf6",
      "name": "MenÃº Principal11",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âŒ Proceso cancelado\nðŸ”™ Regresando al menÃº principalâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5408,
        7936
      ],
      "id": "67ae3588-82c0-4364-af6a-594624962a57",
      "name": "Cancelado8",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 963194097,
          "mode": "list",
          "cachedResultName": "Tareas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=963194097"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5776,
        8128
      ],
      "id": "580b737c-7004-4a75-b0f9-bde7e9f3d0f0",
      "name": "Agenda9",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const opcion = Number($('Telegram Trigger').first().json.message.text);\nconst tareas = $input.first().json.tareas;\n\nif (opcion === 0) {\n  return [\n    { json: { accion: 'cancelar', mensaje: 'âŒ Proceso cancelado, regresando al menÃº principalâ€¦' } }\n  ];\n}\n\nconst tareaSeleccionada = tareas.find(t => t.numero === opcion);\n\nif (!tareaSeleccionada) {\n  return [\n    { json: { accion: 'error', mensaje: 'âš ï¸ OpciÃ³n invÃ¡lida, intenta de nuevo.' } }\n  ];\n}\n\nreturn [\n  { json: { tarea: tareaSeleccionada } }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        6096,
        8128
      ],
      "id": "abded201-c0c4-4216-82ca-c98dd96cf56c",
      "name": "Seleccion3"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Recorrer Tareas4').item.json.creado_por }}",
            "paso_actual": "2",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}",
            "cita_edit": "={{ $json.tarea.id }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6464,
        8128
      ],
      "id": "e504605c-8115-4a52-b43f-5cd2fa0f30a5",
      "name": "Act Paso36",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "799b6e2d-3eb6-4300-9d8f-97b1e1c66977",
              "leftValue": "={{ !isNaN($('Telegram Trigger').item.json.message.text) && ((Number($('Telegram Trigger').item.json.message.text) >= 1 && Number($('Telegram Trigger').item.json.message.text) <= 2) || Number($('Telegram Trigger').item.json.message.text) === 9)}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        5808,
        8368
      ],
      "id": "ecc56c3b-4071-45a8-a2d7-35d5f90c0238",
      "name": "Veri OPC10"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_TAREAS",
            "cita_edit": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6560,
        8400
      ],
      "id": "674b271e-ac2e-4659-995e-5bff6c8e74bf",
      "name": "Act Paso37",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "cita_edit": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6384,
        8592
      ],
      "id": "b5670d4b-2d61-4303-b718-ea3caef5f958",
      "name": "Act Paso38",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, ese nÃºmero no estÃ¡ dentro de las opciones disponibles.\n\nðŸ”¢ AsegÃºrate de que estÃ© dentro del menÃº, Â¡asÃ­ avanzamos sin problema!\n\nâ— AtenciÃ³n: Â¿EstÃ¡ seguro que desea cancelar la cita ID {{ $json.cita_edit }}?\n\n1ï¸âƒ£ SÃ­, confirmar y cancelar la cita\n2ï¸âƒ£ No, mantener la cita\n\nâœ¨ Responde solo con el nÃºmero de la opciÃ³n que prefieras, Â¡yo me encargo del resto! ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6080,
        8288
      ],
      "id": "cc0a895a-b8ef-4f01-89f5-ac81d1e71f05",
      "name": "OPC Invalido16",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Â¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Crear una nueva tarea\n2ï¸âƒ£ Consultar tus tareas\n3ï¸âƒ£ Eliminar una tarea\n4ï¸âƒ£ Marcar una tarea como completada\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6928,
        8384
      ],
      "id": "8116ee00-bb42-4a42-88c5-dbfeed6c9c0b",
      "name": "MenÃº Agenda10",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6624,
        8544
      ],
      "id": "1973e397-e173-4f8a-a7b1-e155c33de0f3",
      "name": "MenÃº Principal12",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        6080,
        8528
      ],
      "id": "b1ffab41-5f28-4e43-a445-ffa3cb84db60",
      "name": "DecisiÃ³n2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b4356d95-f796-454b-9da3-c31f8fa82a3d",
              "leftValue": "={{ $json.accion }}",
              "rightValue": "error",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        6256,
        8112
      ],
      "id": "a12417d6-7153-45a8-80ed-60458f58295f",
      "name": "If20"
    },
    {
      "parameters": {
        "chatId": "={{ $('Recorrer Tareas4').item.json.creado_por }}",
        "text": "=âŒ Upsâ€¦ esa opciÃ³n no estÃ¡ disponible\n\nðŸ‘‰ Por favor, intenta nuevamente ingresando una opciÃ³n vÃ¡lida.\n\nðŸ”™ Si deseas cancelar el proceso, envÃ­a ðŸ…¾ï¸",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6528,
        7936
      ],
      "id": "5826f1a2-e230-4f65-9535-8b6de479d7f0",
      "name": "Error3",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Filtramos citas vÃ¡lidas\nconst tareas = items\n  .filter(item => item.json && Object.keys(item.json).length > 0)\n  .map((item, index) => ({\n    numero: index + 1,\n    id: item.json.id_tarea,\n    titulo: item.json.titulo,\n    prioridad: item.json.prioridad,\n    estado: item.json.estado,\n    fecha: item.json.fecha_objetivo\n  }));\n\n// Si no hay citas\nif (tareas.length === 0) {\n  return [\n    {\n      json: {\n        mensaje: \"ðŸ“­ No tienes citas agendadas para reprogramar.\",\n        opciones: []\n      }\n    }\n  ];\n}\n\n// Devolvemos el mensaje y las opciones\nreturn [\n  {\n    json: {\n      opciones: tareas.map(c => c.numero).concat([9]),\n      tareas,\n      creado_por: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5936,
        8128
      ],
      "id": "dcf6e9cd-ce73-492f-baa3-f4afb4238904",
      "name": "Recorrer Tareas4"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âœ… Tarea Completada con Ã©xito.\nâª Te estamos regresando al MenÃº de Tareasâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6736,
        8400
      ],
      "id": "966d03e1-2291-4a8d-b445-c7420a58fe6b",
      "name": "MenÃº Tareas6",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 2,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        5488,
        8192
      ],
      "id": "553ad921-1d37-40bd-a00d-9b0cd024cbdb",
      "name": "Pasos CambiarEstado"
    },
    {
      "parameters": {
        "chatId": "={{ $('Recorrer Tareas4').item.json.creado_por }}",
        "text": "=â— AtenciÃ³n: Â¿EstÃ¡ seguro que desea completar la tarea ID {{ $json.cita_edit }}?\n\n1ï¸âƒ£ SÃ­, confirmar y completar la tarea\n2ï¸âƒ£ No, mantener la tarea como Pendiente\n\nâœ¨ Responde solo con el nÃºmero de la opciÃ³n que prefieras, Â¡yo me encargo del resto! ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6640,
        8128
      ],
      "id": "305d4013-ba81-47d2-a151-029600a2649f",
      "name": "ConfirmaciÃ³n Cambio Estado",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 963194097,
          "mode": "list",
          "cachedResultName": "Tareas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=963194097"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_tarea": "={{ $('Datos Temporales').item.json.cita_edit }}",
            "estado": "Completado"
          },
          "matchingColumns": [
            "id_tarea"
          ],
          "schema": [
            {
              "id": "id_tarea",
              "displayName": "id_tarea",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "titulo",
              "displayName": "titulo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "prioridad",
              "displayName": "prioridad",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_objetivo",
              "displayName": "fecha_objetivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6368,
        8416
      ],
      "id": "9f3595d5-b3fb-45a7-a4ba-cdf7474b6a97",
      "name": "Act Paso39",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸŸ¢ Paso 2 de 4\nÂ¿CuÃ¡l es la fecha de la tarea?\n\nðŸ“Œ EscrÃ­bela en el siguiente formato:\nYYYY-MM-DD\nðŸ“ Ejemplo: 2025-12-20\n\n9ï¸âƒ£ Cancelar y salir\n\nðŸ‘‰ Solo escribe la fecha o el nÃºmero 9 si deseas cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5664,
        5040
      ],
      "id": "8e405406-556f-4e26-8a4c-dcb971079484",
      "name": "Fecha Tarea",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Recorrer Tareas3').item.json.creado_por }}",
        "text": "=â— AtenciÃ³n: Â¿EstÃ¡ seguro que desea eliminar la tarea ID {{ $json.cita_edit }}?\n\n1ï¸âƒ£ SÃ­, confirmar y eliminar la tarea\n2ï¸âƒ£ No, mantener la tarea\n\nâœ¨ Responde solo con el nÃºmero de la opciÃ³n que prefieras, Â¡yo me encargo del resto! ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6560,
        6864
      ],
      "id": "d983babb-eff3-4746-81a0-07051ee0d078",
      "name": "ConfirmaciÃ³n Eliminar",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "fbb107e7-5b95-4dfe-9c4f-c9ded23064cf",
              "leftValue": "={{ $json.cantidad_citas }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        7920,
        14576
      ],
      "id": "3ef0f37e-a725-468a-8729-a55bc1ffa25d",
      "name": "If21"
    },
    {
      "parameters": {
        "chatId": "={{ $('Code in JavaScript').item.json.autor }}",
        "text": "=ðŸš« Â¡Ups! Ya hay una cita agendada para esa fecha y hora â°\n\nPara que lo tengas claro, estos son los detalles de la cita existente ðŸ‘‡\n\nðŸ“Œ ID de la cita: {{ $('Cant Citas').item.json.id_cita }}\nðŸ“… Fecha: {{ $('Cant Citas').item.json.fecha }}\nâ° Hora: {{ $('Cant Citas').item.json.hora }}\nðŸ‘¤ Nombre: {{ $('Cant Citas').item.json.nombre }}\nðŸ“ Motivo: {{ $('Cant Citas').item.json.motivo }}\nðŸ“² Canal: {{ $('Cant Citas').item.json.canal }}\n\nÂ¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n1ï¸âƒ£ Volver a Agenda\n2ï¸âƒ£ Ir al menÃº principal\n\nðŸ‘‰ Solo escribe el nÃºmero de la opciÃ³n que prefieras",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        8384,
        14464
      ],
      "id": "92b8b45d-530f-4426-b7cc-1bafbaaf8047",
      "name": "Que deseas hacer?3",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Code in JavaScript').item.json.autor }}",
            "paso_actual": "0",
            "pantalla_actual": "CONFIRMACION",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}",
            "fecha_temporar": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "n_citas",
              "displayName": "n_citas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "n_tareas",
              "displayName": "n_tareas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        8208,
        14464
      ],
      "id": "6b4aa328-2f3b-46d4-ab5b-62bca30edf6d",
      "name": "Act Paso40",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -1920,
        7440
      ],
      "id": "9016e792-3074-403d-a905-0d22403dd1ae",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Citas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1344,
        7440
      ],
      "id": "7bdf52c9-e25a-4667-89a0-2f74c003700a",
      "name": "Cant Citas1",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const MINUTOS_ANTES = 15;\n\n// Hora actual Colombia\nconst ahora = new Date(\n  new Date().toLocaleString(\"en-US\", { timeZone: \"America/Bogota\" })\n);\n\nreturn items.map(item => {\n  const { fecha, hora } = item.json;\n\n  let enviar = false;\n  let minutos_restantes = null;\n\n  if (fecha && hora) {\n    const fechaCita = new Date(\n      new Date(`${fecha}T${hora}:00`).toLocaleString(\"en-US\", {\n        timeZone: \"America/Bogota\"\n      })\n    );\n\n    const diffMin = (fechaCita - ahora) / 60000;\n\n    if (diffMin > 0 && diffMin <= MINUTOS_ANTES) {\n      enviar = true;\n      minutos_restantes = Math.ceil(diffMin);\n    }\n  }\n\n  return {\n    json: {\n      ...item.json,\n      enviar_recordatorio: enviar,\n      minutos_restantes\n    }\n  };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1152,
        7440
      ],
      "id": "e8e4b7be-6193-4209-9a57-f3525eb297a3",
      "name": "Code in JavaScript2",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "11486ee5-dc76-4187-8702-b1f4efe61d07",
              "leftValue": "={{ $json.enviar_recordatorio }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -976,
        7440
      ],
      "id": "07705afb-f08f-44bf-8c33-d6e7f7ce2c56",
      "name": "If22"
    },
    {
      "parameters": {
        "chatId": "={{ $json.creado_por }}",
        "text": "=â° Recordatorio\n\nHola ðŸ‘‹\nTe recuerdo que tienes una cita programada:\n\nðŸ‘¤ Nombre: {{ $json.nombre }}\nðŸ“… Fecha: {{ $json.fecha }}\nðŸ•’ Hora: {{ $json.hora }}\nðŸ“ Motivo: {{ $json.motivo }}\nðŸ“ Canal: {{ $json.canal }}\n\n\nFaltan {{ $json.minutos_restantes }} minutos ðŸ˜‰\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -704,
        7408
      ],
      "id": "f9bd220f-361e-4412-aab6-89c17d6ed4b4",
      "name": "MenÃº Principal13",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_HABITOS",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2288,
        1840
      ],
      "id": "11a72404-738a-4673-b0e2-8bdeac0dbe7a",
      "name": "MenÃº Habitos",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“’ Perfecto, entremos a tus Habitos\n\nÂ¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Crear una nuevo habito\n2ï¸âƒ£ Consultar tus habitos\n3ï¸âƒ£ Eliminar un habito\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2432,
        1840
      ],
      "id": "476cd926-add8-44d5-ad90-9b0ccf29d976",
      "name": "MenÃº Habitos1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, ese nÃºmero no estÃ¡ dentro de las opciones disponibles.\n\nðŸ”¢ AsegÃºrate de que estÃ© dentro del menÃº, Â¡asÃ­ avanzamos sin problema!\n\n1ï¸âƒ£ Crear una nuevo habito\n2ï¸âƒ£ Consultar tus habitos\n3ï¸âƒ£ Eliminar un habito\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1408,
        12704
      ],
      "id": "e2e791e2-fb4c-48e1-b0d4-414907bb6817",
      "name": "OPC Invalido12",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "799b6e2d-3eb6-4300-9d8f-97b1e1c66977",
              "leftValue": "={{ !isNaN($('Telegram Trigger').item.json.message.text) && ((Number($('Telegram Trigger').item.json.message.text) >= 1 && Number($('Telegram Trigger').item.json.message.text) <= 4) || Number($('Telegram Trigger').item.json.message.text) === 9)}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1248,
        12864
      ],
      "id": "831045e0-99eb-4355-9468-16d703ef3a3d",
      "name": "Veri OPC11"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8be02210-0d18-42b0-8ecd-f540f74c6858",
              "leftValue": "={{ $json.total_habitos }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        2320,
        12512
      ],
      "id": "513e8573-892e-4192-ae8a-0ccf53e3e17f",
      "name": "If23"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2336,
        13072
      ],
      "id": "e90de71d-70da-4f78-b23d-022671ba081c",
      "name": "Act Paso43",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2544,
        13088
      ],
      "id": "a2cb6edd-26dd-49fc-b56d-120359172eb4",
      "name": "MenÃº Principal14",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ”™ Regresando al menÃº principalâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2096,
        13056
      ],
      "id": "dd0a27a0-52ec-47c7-af55-5b0983ce9c2b",
      "name": "Cancelado9",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e818d0d0-c42e-4989-b4b5-a7d7fce3eefb",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "bb6457a1-41f0-4456-81c1-ff8b931bcc5a",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        1680,
        12832
      ],
      "id": "ea417286-24ba-4480-b559-0aa451e93355",
      "name": "Menu Habitos1"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "1",
            "pantalla_actual": "NUEVO_HABITO",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "n_citas",
              "displayName": "n_citas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "n_tareas",
              "displayName": "n_tareas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1952,
        12320
      ],
      "id": "9f60f9b8-f29c-4779-a8fc-3e8f0e16a1dd",
      "name": "Nuevo Habito",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸŸ¢ Paso 1 de 4\nðŸ“ Â¿CÃ³mo se llama el Habito?\n\n0ï¸âƒ£ Cancelar y salir\n\nðŸ‘‰ Escribe el nombre del habito o envÃ­a 0 si prefieres cancelar el proceso ðŸ˜Š",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2112,
        12320
      ],
      "id": "9637612d-a70f-44b5-bce2-09adf6899127",
      "name": "NombreHabito",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "2",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1648,
        13712
      ],
      "id": "2fd6cb0d-068d-466b-9e06-2fde633aab8f",
      "name": "Act Paso45",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "799b6e2d-3eb6-4300-9d8f-97b1e1c66977",
              "leftValue": "={{ !isNaN($('Telegram Trigger').item.json.message.text) && ((Number($('Telegram Trigger').item.json.message.text) >= 1 && Number($('Telegram Trigger').item.json.message.text) <= 3))}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1888,
        14720
      ],
      "id": "c3aa7550-7610-47cf-bc0f-f1c1dff1103c",
      "name": "Veri OPC13"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, ese nÃºmero no corresponde a ninguna opciÃ³n vÃ¡lida.\n\nðŸ‘‰ Para continuar, escribe solo el nÃºmero de la acciÃ³n que deseas realizar\nðŸ”¢ AsegÃºrate de que estÃ© dentro de las opciones mostradas para que podamos avanzar sin enredos.\n\nðŸ“… Fecha: {{ $('Datos Temporales').item.json.fecha_temporar }}\nâ° Hora: {{ $('Datos Temporales').item.json.hora_temporal }}\nðŸ‘¤ Cliente: {{ $('Datos Temporales').item.json.nombre_temporal }}\nðŸ—’ï¸ Motivo: {{ $('Datos Temporales').item.json.motivo_temporal }}\nðŸ“ Canal: {{ $('Datos Temporales').item.json.canal_temporal }}\n\nðŸ‘‰ Â¿QuÃ© deseas hacer ahora?\n\n1ï¸âƒ£ Confirmar y guardar la cita\n2ï¸âƒ£ Editar la informaciÃ³n\n3ï¸âƒ£ Cancelar el agendamiento\n\nâœ¨ Escribe solo el nÃºmero de la opciÃ³n que elijas y yo me encargo del resto ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2112,
        14752
      ],
      "id": "e49a54c6-6fb6-4eae-9833-682c484230d6",
      "name": "OPC Invalido19",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "nombre_temporal": "={{ $('Telegram Trigger').item.json.message.text }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1776,
        13712
      ],
      "id": "e5e50a6b-e194-43e5-a8bc-87bffcb77387",
      "name": "Almacenar11",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e818d0d0-c42e-4989-b4b5-a7d7fce3eefb",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        2160,
        14992
      ],
      "id": "300a456a-ff0d-404d-b482-56a179de4732",
      "name": "ConfirmaciÃ³n2"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1067611566,
          "mode": "list",
          "cachedResultName": "Habitos",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1067611566"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "creado_por": "={{ $json.autor }}",
            "estado": "Activo",
            "id_habito": "=HABITO - 00{{ $json.contador }}{{ $json.autor }}",
            "nombre": "={{ $json.nombre }}",
            "frecuencia": "={{ $json.frecuencia }}",
            "hora_recordatorio": "={{ $json.hora }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_habito",
              "displayName": "id_habito",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "frecuencia",
              "displayName": "frecuencia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_recordatorio",
              "displayName": "hora_recordatorio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2800,
        14688
      ],
      "id": "9125bade-4154-41fa-a60a-1f8022ac0bfe",
      "name": "Append row in sheet2",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Verifica si hay al menos un item con json vacÃ­o\nconst hayObjetoVacio = items.some(\n  item => item.json && Object.keys(item.json).length === 0\n);\n\n// Calcula la cantidad de citas\nconst cantidad_habitos = hayObjetoVacio\n  ? items.length - 1\n  : items.length;\n\nreturn [\n  {\n    json: {\n      cantidad_habitos,\n      nombre:$('Datos Temporales').first().json.nombre_temporal,\n      hora: $('Datos Temporales').first().json.hora_temporal,\n      frecuencia: $('Datos Temporales').first().json.fecha_temporar,\n      autor: $('Telegram Trigger').first().json.message.chat.id,\n      contador: $('Datos Temporales').first().json.n_habitos\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2624,
        14688
      ],
      "id": "3e750509-1bfd-4671-a0d2-55f399a13e64",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Code in JavaScript3').item.json.autor }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_HABITOS",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}",
            "fecha_temporar": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}",
            "cita_edit": "={{\"\"}}",
            "n_habitos": "={{ $('Code in JavaScript3').item.json.contador + 1 }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "n_citas",
              "displayName": "n_citas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "n_tareas",
              "displayName": "n_tareas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "n_habitos",
              "displayName": "n_habitos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2976,
        14688
      ],
      "id": "2d394766-363c-4979-86f4-3b0d5b3c7e27",
      "name": "Act Paso47",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Code in JavaScript3').item.json.autor }}",
        "text": "=âœ… Â¡Listo! Tu habito quedÃ³ registrado con Ã©xito\n\nÂ¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Crear una nuevo habito\n2ï¸âƒ£ Consultar tus habitos\n3ï¸âƒ£ Eliminar un habito\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3136,
        14688
      ],
      "id": "f33a71b9-f7bc-43a5-ad9d-3f9a93ed1c3b",
      "name": "Que deseas hacer?4",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2560,
        15152
      ],
      "id": "568929b7-ed31-4a22-970b-034a38e1b555",
      "name": "Act Paso48",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2704,
        15152
      ],
      "id": "ec1495a6-e486-40bd-8e18-d5e6f9d7891d",
      "name": "MenÃº Principal15",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âŒ Proceso cancelado\nðŸ”™ Regresando al menÃº principalâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2416,
        15152
      ],
      "id": "4da9f0fe-43df-4b33-99db-338018b0738d",
      "name": "Cancelado10",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "1",
            "pantalla_actual": "NUEVA_HABITO",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2464,
        14880
      ],
      "id": "bb1a2895-1d36-4c13-8fb1-a9c303b65068",
      "name": "Act Paso49",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Okey, Volvamos a empezar\n\nðŸŸ¢ Paso 1 de 4\nðŸ“ Â¿CÃ³mo se llama el Habito?\n\n0ï¸âƒ£ Cancelar y salir\n\nðŸ‘‰ Escribe el nombre del habito o envÃ­a 0 si prefieres cancelar el proceso ðŸ˜Š",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2640,
        14880
      ],
      "id": "a70aa9ea-7bb8-40b7-9daf-b5b76ff4a1d0",
      "name": "Volver a empezar2",
      "webhookId": "6ac59f7b-9940-4518-bca6-a00c60af2b5e",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1067611566,
          "mode": "list",
          "cachedResultName": "Habitos",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1067611566"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1952,
        12512
      ],
      "id": "7e553fe9-c013-43e4-ab63-6dab3f39f60e",
      "name": "Habitos",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const habitos = items\n  .filter(item => item.json && Object.keys(item.json).length > 0)\n  .map(item => ({\n    id: item.json.id_habito,\n    nombre: item.json.nombre,\n    frecuencia: item.json.frecuencia,\n    hora_recordatorio: item.json.hora_recordatorio,\n    estado: item.json.estado\n  }));\n\nreturn [\n  {\n    json: {\n      total_habitos: habitos.length,\n      habitos,\n      creado_por: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2144,
        12512
      ],
      "id": "5a71034f-f1a8-452d-a009-400cf21833be",
      "name": "Recorrer Habitos"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“­ AÃºn no tienes habitos registrados\n\nCuando quieras, puedes crear un nuevo habito ðŸ“…âœ¨\n\nðŸ‘‰ Escribe 1 para registrar un habito o 9 para volver al menÃº principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2512,
        12416
      ],
      "id": "41be5fcb-ac56-4e90-bd4f-0f4e6c0ad730",
      "name": "No Habitos",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.creado_por }}",
        "text": "=ðŸ“… *Tienes {{ $json.total_habitos }} habitos registrados*:\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n{{ \n  $json.habitos.map(h => \n`ðŸ†” *ID:* ${h.id}\nðŸ“ *Habito:* ${h.nombre}\nâš¡ *Hora Recordatorio:* ${h.hora_recordatorio}\nðŸ“Š *Estado:* ${h.estado}\nðŸ“… *Frecuencia:* ${h.frecuencia} Hora(s)\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`\n  ).join('\\n')\n}}\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2512,
        12576
      ],
      "id": "08de6d4b-8c1d-4577-8f72-df7d5528d247",
      "name": "Mis Habitos",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Â¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Crear una nuevo habito\n2ï¸âƒ£ Consultar tus habitos\n3ï¸âƒ£ Eliminar un habito\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2768,
        12480
      ],
      "id": "dfd64303-204b-4832-9efe-e6d8f9d59a35",
      "name": "MenÃº Habitos2",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8be02210-0d18-42b0-8ecd-f540f74c6858",
              "leftValue": "={{ $json.total_habitos }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        2336,
        12720
      ],
      "id": "eb1c6341-dffd-4594-9454-30970a324313",
      "name": "If24"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Recorrer Habitos1').item.json.creado_por }}",
            "paso_actual": "1",
            "pantalla_actual": "ELIMINAR_HABITO",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2800,
        12864
      ],
      "id": "6d028b0b-7fb3-4d60-bf9a-0e5e594b5592",
      "name": "Act Paso41",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1067611566,
          "mode": "list",
          "cachedResultName": "Habitos",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1067611566"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1968,
        12768
      ],
      "id": "82c84700-2644-4f47-9a3f-89c37560a424",
      "name": "Habitos1",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“­ AÃºn no tienes habitos registrados\n\nCuando quieras, puedes crear un nuevo habito ðŸ“…âœ¨\n\nðŸ‘‰ Escribe 1 para registrar un habito o 9 para volver al menÃº principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2576,
        12736
      ],
      "id": "0f556c20-b662-4fba-8f29-152fb6d62483",
      "name": "No Habitos1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Â¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Crear una nuevo habito\n2ï¸âƒ£ Consultar tus habitos\n3ï¸âƒ£ Eliminar un habito\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2832,
        12688
      ],
      "id": "4dee8c9e-517e-4fcf-9e81-693a61f45aec",
      "name": "MenÃº Habitos3",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.creado_por }}",
        "text": "={{ \n  \"ðŸ—‘ï¸ *Eliminar habito*\\n\\n\" +\n  \"âœï¸ Elige el habito que deseas eliminar:\\n\\n\" +\n  $json[\"habitos\"].map(h => \n    h.numero + \"ï¸âƒ£ *\" + h.nombre + \"*\\n\" +\n    \"   ðŸ“Œ Recordatorio: \" + h.hora_recordatorio + \"\\n\" +\n    \"   ðŸ“Š Estado: \" + h.estado + \"\\n\" +\n    \"   ðŸ“… Frecuencia: \" + h.frecuencia + \"\\n\"\n  ).join(\"\\n\") +\n  \"\\nðŸ…¾ï¸ *0.* Cancelar\"\n}}\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2576,
        12896
      ],
      "id": "609f81e5-1041-423d-aa13-172ab3cf2450",
      "name": "Mis Habitos1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 2,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e818d0d0-c42e-4989-b4b5-a7d7fce3eefb",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 3,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f8ea4bb7-520a-4c4a-a25d-6d7b6fdca1a7",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 4,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        1376,
        14080
      ],
      "id": "74e7fe8a-cf7d-4d60-9cb8-a28cef0ed64b",
      "name": "Pasos Nueva Habito"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸŸ¢ Paso 2 de 4\nâ° Â¿Cada cuÃ¡ntas horas quieres realizar este hÃ¡bito?\n\nðŸ“Œ Escribe solo un nÃºmero entero positivo en horas.\nEjemplo: 8\nâŒ No escribas â€œ8 horasâ€, solo el nÃºmero.\n\n0ï¸âƒ£ Cancelar y salir\n\nðŸ‘‰ Ingresa la frecuencia en horas y continuamos ðŸš€",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1920,
        13712
      ],
      "id": "399dfe52-84a0-4fcc-bc15-78bffc99aa01",
      "name": "Frecuencia Habito",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b321f78b-8819-4417-8c19-8cc290dbcec4",
              "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
              "rightValue": "0",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        848,
        13600
      ],
      "id": "81f151c0-4600-4195-a27f-5c86e7efeb7b",
      "name": "If25"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1328,
        13504
      ],
      "id": "7ef2c2a6-344c-414a-b75f-2bd225414b18",
      "name": "Act Paso42",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1472,
        13504
      ],
      "id": "7e443848-2a0b-42ea-8337-c176a44011a8",
      "name": "MenÃº Principal16",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âŒ Proceso cancelado\nðŸ”™ Regresando al menÃº principalâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1184,
        13504
      ],
      "id": "0809f2fb-758e-4b79-816c-df62dac88412",
      "name": "Cancelado11",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "799b6e2d-3eb6-4300-9d8f-97b1e1c66977",
              "leftValue": "={{ !isNaN($('Telegram Trigger').item.json.message.text) && ((Number($('Telegram Trigger').item.json.message.text) > 0 ))}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1872,
        13952
      ],
      "id": "2f3f1ac0-bc42-4f8a-b357-dff4f06dba55",
      "name": "Veri OPC14"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, recuerda que debes ingresar un nÃºmero entero mayor a 0, que represente cada cuÃ¡ntas horas realizarÃ¡s el hÃ¡bito.\nðŸ‘‰ Ejemplo: 8\n\nðŸ” IntentÃ©moslo de nuevo\n\nðŸ“ Â¿CÃ³mo se llama el hÃ¡bito?\n\n0ï¸âƒ£ Cancelar y salir\n\nðŸ‘‰ Escribe el nombre del hÃ¡bito o envÃ­a 0 si prefieres cancelar el proceso ðŸ˜Š",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2176,
        13776
      ],
      "id": "0d2e0494-ae4c-4652-af5f-a120d8dc2baf",
      "name": "OPC Invalido20",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "3",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2128,
        13936
      ],
      "id": "af42d984-5399-4069-a54d-1804d4c704bc",
      "name": "Act Paso50",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "fecha_temporar": "={{ $('Telegram Trigger').item.json.message.text }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "n_citas",
              "displayName": "n_citas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "n_tareas",
              "displayName": "n_tareas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2304,
        13936
      ],
      "id": "0380799d-1e6d-418a-825c-1470c364b253",
      "name": "Almacenar18",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "05deba36-8c97-4e18-bf89-f5aa3e57ed13",
              "leftValue": "={{ $json.hora_valida }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        2208,
        14240
      ],
      "id": "c7e0eaa8-667f-4275-8623-1157965e8b33",
      "name": "If26"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }},\nla hora {{ $('Telegram Trigger').item.json.message.text }} no es vÃ¡lida.\n\nðŸ•’ Debe escribirse en formato 24 horas (HH:MM)\nðŸ“Œ Si la hora es menor a 10, recuerda agregar el cero adelante\n    ðŸ‘‰ 07:00, 05:30, 09:15\n\nðŸš« Evita formatos como 7:00, 6 o 5\n\nâœï¸ Ejemplo vÃ¡lido: 14:30\n\nðŸ‘‰ IntÃ©ntalo nuevamente, yo te acompaÃ±o ðŸ˜‰\n\nÂ¿CuÃ¡l es la hora del recordatorio?\n\n0ï¸âƒ£ Cancelar y salir",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2464,
        14176
      ],
      "id": "e86bef17-f420-4e5d-8b32-07a81fc4671a",
      "name": "OPC Invalido17",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "4",
            "pantalla_actual": "NUEVO_HABITO",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2528,
        14336
      ],
      "id": "42d6dd6a-c426-4f27-8f9c-ac9f74362faf",
      "name": "Act Paso44",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "hora_temporal": "={{ $('Telegram Trigger').item.json.message.text }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2672,
        14336
      ],
      "id": "b4374b8f-ee89-48ad-90cf-a5d2fa858315",
      "name": "Almacenar9",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const input = $('Telegram Trigger').first().json.message.text;\n\n// ExpresiÃ³n regular para formato HH:MM en 24 horas\nconst regexHora = /^([01]\\d|2[0-3]):([0-5]\\d)$/;\n\nconst esHoraValida = regexHora.test(input);\n\nreturn [\n  {\n    json: {\n      hora_ingresada: input,\n      hora_valida: esHoraValida\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2032,
        14240
      ],
      "id": "07b69057-f5bd-4434-8ba4-409d19ba3ef2",
      "name": "Validar Hora2"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=â° Paso 2 de 3\nÂ¿A quÃ© hora serÃ¡ el recordatorio?\n\nðŸ•’ Usa el formato de 24 horas:\nHH:MM\nðŸ“ Ejemplo: 14:30\n\n0ï¸âƒ£ Cancelar y volver atrÃ¡s\n\nðŸ‘‰ Escribe la hora o el nÃºmero 0 para cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2592,
        13888
      ],
      "id": "199acb0d-1218-420e-9648-e1d809e1c827",
      "name": "Hora Cita2",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2816,
        14336
      ],
      "id": "c95ac1df-49c3-4ff2-aa8f-7c60084f0da4",
      "name": "Datos Temporales3",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“ Revisa la informaciÃ³n de tu habito\n\nAntes de guardarla, confirma que todo estÃ© correcto:\n\nðŸ“ *Habito:* {{ $json.nombre_temporal }}\nâš¡ *Hora Recordatorio:* {{$json.hora_temporal}}\nðŸ“… *Frecuencia:* Cada {{$json.fecha_temporar}} Horas\n\nðŸ‘‰ Â¿QuÃ© deseas hacer ahora?\n\n1ï¸âƒ£ Confirmar y guardar\n2ï¸âƒ£ Editar la informaciÃ³n\n3ï¸âƒ£ Cancelar el registro\n\nâœ¨ Escribe solo el nÃºmero de la opciÃ³n que elijas y yo me encargo del resto ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2976,
        14336
      ],
      "id": "a5257548-36fc-4085-8442-c8041c0a261a",
      "name": "ConfirmaciÃ³n Habito",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1067611566,
          "mode": "list",
          "cachedResultName": "Habitos",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1067611566"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2448,
        14688
      ],
      "id": "be62428b-8da1-42fa-88da-008e8102a959",
      "name": "Cant Habitos",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b321f78b-8819-4417-8c19-8cc290dbcec4",
              "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
              "rightValue": "0",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        976,
        15472
      ],
      "id": "0be42bae-1296-4c75-92c7-cb47909990ee",
      "name": "If27"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1296,
        15328
      ],
      "id": "bc0dc9a6-00a6-43d2-a593-24af3b7c05ca",
      "name": "Act Paso46",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1440,
        15328
      ],
      "id": "7ded3802-0da3-4934-aec5-bf46bca758cf",
      "name": "MenÃº Principal17",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âŒ Proceso cancelado\nðŸ”™ Regresando al menÃº principalâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1152,
        15328
      ],
      "id": "a82495b3-8c81-46f5-baca-96788fcfcd4f",
      "name": "Cancelado12",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const opcion = Number($('Telegram Trigger').first().json.message.text);\nconst habitos = $input.first().json.habitos;\n\nif (opcion === 0) {\n  return [\n    { json: { accion: 'cancelar', mensaje: 'âŒ Proceso cancelado, regresando al menÃº principalâ€¦' } }\n  ];\n}\n\nconst habitoSeleccionada = habitos.find(h => h.numero === opcion);\n\nif (!habitoSeleccionada) {\n  return [\n    { json: { accion: 'error', mensaje: 'âš ï¸ OpciÃ³n invÃ¡lida, intenta de nuevo.' } }\n  ];\n}\n\nreturn [\n  { json: { habito: habitoSeleccionada } }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1840,
        15520
      ],
      "id": "35fa5c23-c061-4555-95e4-c0a0df294c91",
      "name": "Seleccion4"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Recorrer Habitos2').item.json.creado_por }}",
            "paso_actual": "2",
            "pantalla_actual": "ELIMINAR_HABITO",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}",
            "cita_edit": "={{ $json.habito.id }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2240,
        15520
      ],
      "id": "44d2af6c-c15f-4ce3-b2d4-2fa13e44f32b",
      "name": "Act Paso51",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 2,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        1232,
        15584
      ],
      "id": "84fc0ff1-fab1-4f89-84a8-040f14eb0630",
      "name": "Pasos Cancelar2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "799b6e2d-3eb6-4300-9d8f-97b1e1c66977",
              "leftValue": "={{ !isNaN($('Telegram Trigger').item.json.message.text) && ((Number($('Telegram Trigger').item.json.message.text) >= 1 && Number($('Telegram Trigger').item.json.message.text) <= 2))}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1552,
        15760
      ],
      "id": "79815615-2d84-46d2-9e3e-9bf291d92924",
      "name": "Veri OPC12"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_HABITOS",
            "cita_edit": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2448,
        15744
      ],
      "id": "d5afb4d6-be01-4072-8252-47e0784a8560",
      "name": "Act Paso52",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "cita_edit": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2128,
        15984
      ],
      "id": "564c4494-114d-4d14-a5ce-b80fb4f0acf1",
      "name": "Act Paso53",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, ese nÃºmero no estÃ¡ dentro de las opciones disponibles.\n\nðŸ”¢ AsegÃºrate de que estÃ© dentro del menÃº, Â¡asÃ­ avanzamos sin problema!\n\nâ— AtenciÃ³n: Â¿EstÃ¡ seguro que desea cancelar la cita ID {{ $json.cita_edit }}?\n\n1ï¸âƒ£ SÃ­, confirmar y eliminar el habito\n2ï¸âƒ£ No, mantener el habito\n\nâœ¨ Responde solo con el nÃºmero de la opciÃ³n que prefieras, Â¡yo me encargo del resto! ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1824,
        15680
      ],
      "id": "8138e966-5927-4df8-8919-0b297868d951",
      "name": "OPC Invalido18",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2368,
        15936
      ],
      "id": "574adab4-9061-4b49-92bd-9ab77efe9b43",
      "name": "MenÃº Principal18",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        1824,
        15920
      ],
      "id": "e85c4fb5-561f-44cf-a0e1-bc7a540d1456",
      "name": "DecisiÃ³n3"
    },
    {
      "parameters": {
        "chatId": "={{ $('Recorrer Habitos2').item.json.creado_por }}",
        "text": "=â— AtenciÃ³n: Â¿EstÃ¡ seguro que desea completar o cancelar el habito ID {{ $json.cita_edit }}?\n\n1ï¸âƒ£ SÃ­, confirmar y eliminar el habito\n2ï¸âƒ£ No, mantener el habito\n\nâœ¨ Responde solo con el nÃºmero de la opciÃ³n que prefieras, Â¡yo me encargo del resto! ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2384,
        15520
      ],
      "id": "4c7b8539-dcd0-4c67-8742-cf5722e77db5",
      "name": "ConfirmaciÃ³n Cancelar1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "delete",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1067611566,
          "mode": "list",
          "cachedResultName": "Habitos",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1067611566"
        },
        "startIndex": "={{ $json.row_number }}"
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2272,
        15776
      ],
      "id": "c20c41d1-7744-4f25-a52d-9b3a61a3959c",
      "name": "Delete rows or columns from sheet2",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1067611566,
          "mode": "list",
          "cachedResultName": "Habitos",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1067611566"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id_habito",
              "lookupValue": "={{ $('Datos Temporales').item.json.cita_edit }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2048,
        15824
      ],
      "id": "cb5abdbd-1eaf-4820-83ba-ce615f3c29f4",
      "name": "Agenda11",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b4356d95-f796-454b-9da3-c31f8fa82a3d",
              "leftValue": "={{ $json.accion }}",
              "rightValue": "error",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        2000,
        15504
      ],
      "id": "f0c65a95-dc71-45e7-a3bc-cac1b0cd214a",
      "name": "If28"
    },
    {
      "parameters": {
        "chatId": "={{ $('Recorrer Agenda6').item.json.creado_por }}",
        "text": "=âŒ Upsâ€¦ esa opciÃ³n no estÃ¡ disponible\n\nðŸ‘‰ Por favor, intenta nuevamente ingresando una opciÃ³n vÃ¡lida.\n\nðŸ”™ Si deseas cancelar el proceso, envÃ­a ðŸ…¾ï¸",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2272,
        15328
      ],
      "id": "12e76e17-c1c3-4fb2-a9e7-4c8d5fb4c59a",
      "name": "Error4",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1067611566,
          "mode": "list",
          "cachedResultName": "Habitos",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1067611566"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1520,
        15520
      ],
      "id": "58168a37-9edc-40be-a72e-396a46e97fee",
      "name": "Habitos2",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Filtramos citas vÃ¡lidas\nconst habitos = items\n  .filter(item => item.json && Object.keys(item.json).length > 0)\n  .map((item, index) => ({\n    numero: index + 1,\n    id: item.json.id_habito,\n    nombre: item.json.nombre,\n    frecuencia: item.json.frecuencia,\n    hora_recordatorio: item.json.hora_recordatorio,\n    estado: item.json.estado\n  }));\n\n// Si no hay tareas\nif (habitos.length === 0) {\n  return [\n    {\n      json: {\n        mensaje: \"ðŸ“­ No tienes tareas agendadas para reprogramar.\",\n        opciones: [],\n        total_habitos: 0\n      }\n    }\n  ];\n}\n\n\n// Devolvemos el mensaje y las opciones\nreturn [\n  {\n    json: {\n      opciones: habitos.map(t => t.numero).concat([9]),\n      habitos,\n      total_tareas:habitos.length ,\n      creado_por: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2144,
        12720
      ],
      "id": "6a0a4f09-0ac1-4868-acce-8e3d7f73a92d",
      "name": "Recorrer Habitos1"
    },
    {
      "parameters": {
        "jsCode": "// Filtramos citas vÃ¡lidas\nconst habitos = items\n  .filter(item => item.json && Object.keys(item.json).length > 0)\n  .map((item, index) => ({\n    numero: index + 1,\n    id: item.json.id_habito,\n    nombre: item.json.nombre,\n    frecuencia: item.json.frecuencia,\n    hora_recordatorio: item.json.hora_recordatorio,\n    estado: item.json.estado\n  }));\n\n// Si no hay tareas\nif (habitos.length === 0) {\n  return [\n    {\n      json: {\n        mensaje: \"ðŸ“­ No tienes tareas agendadas para reprogramar.\",\n        opciones: [],\n        total_habitos: 0\n      }\n    }\n  ];\n}\n\n\n// Devolvemos el mensaje y las opciones\nreturn [\n  {\n    json: {\n      opciones: habitos.map(t => t.numero).concat([9]),\n      habitos,\n      total_tareas:habitos.length ,\n      creado_por: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1680,
        15520
      ],
      "id": "e30f5d7d-0188-4b1c-bd65-2904e19201da",
      "name": "Recorrer Habitos2"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âœ… Habito eliminado con Ã©xito.\nâª Te estamos regresando al MenÃº de Habitosâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2624,
        15744
      ],
      "id": "c532fc00-9902-428e-b466-27a23f90e98d",
      "name": "MenÃº Habitos4",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=\nÂ¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Crear una nuevo habito\n2ï¸âƒ£ Consultar tus habitos\n3ï¸âƒ£ Eliminar un habito\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2816,
        15728
      ],
      "id": "eaee5d97-a214-4a35-8f21-476350eca485",
      "name": "MenÃº Habitos5",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b321f78b-8819-4417-8c19-8cc290dbcec4",
              "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4656,
        5248
      ],
      "id": "cabdc33d-bc2e-4bce-91b1-d0cc0bb657c3",
      "name": "If29"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5056,
        4944
      ],
      "id": "00173168-fbf3-4408-8e9d-a69ae52d5e53",
      "name": "Act Paso54",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5200,
        4944
      ],
      "id": "9ad62970-ffec-4448-a2a9-9dd364082c9e",
      "name": "MenÃº Principal19",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âŒ Proceso cancelado\nðŸ”™ Regresando al menÃº principalâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4912,
        4944
      ],
      "id": "0ad13f30-0ad2-44f4-ba3a-553a912f9d7f",
      "name": "Cancelado13",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Citas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1600,
        2160
      ],
      "id": "ff06fb25-d53a-4655-862e-b762f344bce3",
      "name": "Agenda10",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 963194097,
          "mode": "list",
          "cachedResultName": "Tareas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=963194097"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1744,
        2160
      ],
      "id": "91e01c36-ddb8-4175-86d8-15311f821337",
      "name": "Tareas3",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1067611566,
          "mode": "list",
          "cachedResultName": "Habitos",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1067611566"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1888,
        2160
      ],
      "id": "94c20371-8479-45c0-aba9-c52463c8be5f",
      "name": "Habitos3",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ===============================\n// ENTRADAS (por orden de nodos)\n// ===============================\nconst citasRaw = $items(\"Agenda10\").map(i => i.json);\nconst tareasRaw = $items(\"Tareas3\").map(i => i.json);\nconst habitosRaw = $items(\"Habitos3\").map(i => i.json);\nconst usuarios = $items(\"Usuarios\").map(i => i.json);\n\n// ===============================\n// FILTRAR OBJETOS VACÃOS\n// ===============================\nconst citas = citasRaw.filter(c => c && Object.keys(c).length > 0);\nconst tareas = tareasRaw.filter(t => t && Object.keys(t).length > 0);\nconst habitos = habitosRaw.filter(h => h && Object.keys(h).length > 0);\n\n// ===============================\n// MAPA DE USUARIOS\n// ===============================\nconst usuariosMap = {};\n\nusuarios.forEach(u => {\n  usuariosMap[u.telegram_user] = {\n    telegram_user: u.telegram_user,\n    nombre: u.nombre,\n    rol: u.rol,\n    permitido: u.permitido,\n    citas: 0,\n    tareas: 0,\n    habitos: 0\n  };\n});\n\n// ===============================\n// CONTADORES GENERALES\n// ===============================\nconst reporteGeneral = {\n  total_usuarios: usuarios.length,\n  total_citas: citas.length,\n  total_tareas: tareas.length,\n  total_habitos: habitos.length,\n  citas_por_estado: {},\n  habitos_por_estado: {}\n};\n\nconst hayRegistros =\n  reporteGeneral.total_citas > 0 ||\n  reporteGeneral.total_tareas > 0 ||\n  reporteGeneral.total_habitos > 0;\n\n// ===============================\n// PROCESAR CITAS\n// ===============================\ncitas.forEach(c => {\n  const userId = c.creado_por;\n\n  if (usuariosMap[userId]) {\n    usuariosMap[userId].citas++;\n  }\n\n  const estado = c.estado || \"Sin estado\";\n  reporteGeneral.citas_por_estado[estado] =\n    (reporteGeneral.citas_por_estado[estado] || 0) + 1;\n});\n\n// ===============================\n// PROCESAR TAREAS\n// ===============================\ntareas.forEach(t => {\n  const userId = t.creado_por;\n\n  if (usuariosMap[userId]) {\n    usuariosMap[userId].tareas++;\n  }\n});\n\n// ===============================\n// PROCESAR HABITOS\n// ===============================\nhabitos.forEach(h => {\n  const userId = h.creado_por;\n\n  if (usuariosMap[userId]) {\n    usuariosMap[userId].habitos++;\n  }\n\n  const estado = h.estado || \"Sin estado\";\n  reporteGeneral.habitos_por_estado[estado] =\n    (reporteGeneral.habitos_por_estado[estado] || 0) + 1;\n});\n\n// ===============================\n// CONSTRUIR MENSAJE TELEGRAM\n// ===============================\nlet mensaje = `ðŸ“Š *REPORTE GENERAL*\\n\\n`;\n\nmensaje += `ðŸ‘¥ *Usuarios:* ${reporteGeneral.total_usuarios}\\n`;\nmensaje += `ðŸ“… *Citas:* ${reporteGeneral.total_citas}\\n`;\nmensaje += `ðŸ“ *Tareas:* ${reporteGeneral.total_tareas}\\n`;\nmensaje += `ðŸ” *HÃ¡bitos:* ${reporteGeneral.total_habitos}\\n\\n`;\n\n// ===============================\n// DETALLES SOLO SI HAY REGISTROS\n// ===============================\nif (hayRegistros) {\n  if (Object.keys(reporteGeneral.citas_por_estado).length > 0) {\n    mensaje += `ðŸ“Œ *Citas por estado:*\\n`;\n    for (const estado in reporteGeneral.citas_por_estado) {\n      mensaje += `â€¢ ${estado}: ${reporteGeneral.citas_por_estado[estado]}\\n`;\n    }\n    mensaje += `\\n`;\n  }\n\n  if (Object.keys(reporteGeneral.habitos_por_estado).length > 0) {\n    mensaje += `ðŸ” *HÃ¡bitos por estado:*\\n`;\n    for (const estado in reporteGeneral.habitos_por_estado) {\n      mensaje += `â€¢ ${estado}: ${reporteGeneral.habitos_por_estado[estado]}\\n`;\n    }\n    mensaje += `\\n`;\n  }\n\n  mensaje += `ðŸ‘¤ *REPORTE POR USUARIO*\\n`;\n\n  Object.values(usuariosMap).forEach(u => {\n    if (u.citas > 0 || u.tareas > 0 || u.habitos > 0) {\n      mensaje += `\\nðŸ‘¤ *${u.nombre}*\\n`;\n      mensaje += `ðŸ“… Citas: ${u.citas}\\n`;\n      mensaje += `ðŸ“ Tareas: ${u.tareas}\\n`;\n      mensaje += `ðŸ” HÃ¡bitos: ${u.habitos}\\n`;\n    }\n  });\n} else {\n  mensaje += `ðŸŽ‰ *No hay informaciÃ³n registrada para reportar.*\\n`;\n  mensaje += `Todo estÃ¡ limpio por ahora ðŸ˜Œ`;\n}\n\n// ===============================\n// SALIDA FINAL\n// ===============================\nreturn [\n  {\n    json: {\n      mensaje,\n      usuario: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2224,
        2160
      ],
      "id": "7204a313-2d52-42d2-b7e8-f3f7ae795cb0",
      "name": "Code in JavaScript4"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 92232691,
          "mode": "list",
          "cachedResultName": "Usuarios",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=92232691"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2048,
        2160
      ],
      "id": "d72fdef8-2b6a-4e8b-9c5f-2a6f85572378",
      "name": "Usuarios",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{$json.usuario}}",
        "text": "={{$json.mensaje}}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2400,
        2160
      ],
      "id": "49875c53-0d9d-4f65-a2f6-00787b546897",
      "name": "Hasta Luego1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_LISTAS",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2240,
        1984
      ],
      "id": "dfe7b270-9ffd-4f78-a51f-da11efb94d03",
      "name": "MenÃº Listas",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“’ Perfecto, entremos a tus Listas\n\nÂ¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Crear una nueva listas\n2ï¸âƒ£ Consultar tus listas\n3ï¸âƒ£ Eliminar una lista\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2384,
        1984
      ],
      "id": "63884ca0-528d-435f-917d-d951b2cc09ac",
      "name": "Menu Listas",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, ese nÃºmero no estÃ¡ dentro de las opciones disponibles.\n\nðŸ”¢ AsegÃºrate de que estÃ© dentro del menÃº, Â¡asÃ­ avanzamos sin problema!\n\n1ï¸âƒ£ Crear una nueva lista\n2ï¸âƒ£ Consultar tus listas\n3ï¸âƒ£ Eliminar una lista\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1088,
        17328
      ],
      "id": "0658130e-0128-4225-ab15-700a56d9c83f",
      "name": "OPC Invalido21",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "799b6e2d-3eb6-4300-9d8f-97b1e1c66977",
              "leftValue": "={{ !isNaN($('Telegram Trigger').item.json.message.text) && ((Number($('Telegram Trigger').item.json.message.text) >= 1 && Number($('Telegram Trigger').item.json.message.text) <= 4) || Number($('Telegram Trigger').item.json.message.text) === 9)}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        928,
        17488
      ],
      "id": "6ffa9906-b5bb-4200-81a5-ae8c76c6abd1",
      "name": "Veri OPC15"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8be02210-0d18-42b0-8ecd-f540f74c6858",
              "leftValue": "={{ $json.total_listas }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        2336,
        17120
      ],
      "id": "f6e75bea-64e8-4c73-bad2-58c5ed2f6595",
      "name": "If30"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2032,
        17824
      ],
      "id": "b5a903fe-0551-4a47-a55d-4b7e0df3395c",
      "name": "Act Paso55",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2240,
        17840
      ],
      "id": "60a7a2ba-6a0a-4ad4-8455-7d1640a0f335",
      "name": "MenÃº Principal20",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ”™ Regresando al menÃº principalâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1792,
        17808
      ],
      "id": "e470768f-a3cf-45ca-87f1-230c479e5f8b",
      "name": "Cancelado14",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8be02210-0d18-42b0-8ecd-f540f74c6858",
              "leftValue": "={{ $json.total_habitos }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        2032,
        17472
      ],
      "id": "1cac88a0-85e9-430d-9460-451c3e55f142",
      "name": "If31"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('RecorrerListas').item.json.creado_por }}",
            "paso_actual": "1",
            "pantalla_actual": "ELIMINAR_LISTA",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2496,
        17616
      ],
      "id": "5da301a6-c89e-4fc3-8845-fa5aabac7d87",
      "name": "Act Paso56",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e818d0d0-c42e-4989-b4b5-a7d7fce3eefb",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "bb6457a1-41f0-4456-81c1-ff8b931bcc5a",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        1360,
        17456
      ],
      "id": "32121909-8c60-4c03-8d98-b16f458a7aad",
      "name": "Menu Listas1"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "1",
            "pantalla_actual": "NUEVA_LISTA",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "n_citas",
              "displayName": "n_citas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "n_tareas",
              "displayName": "n_tareas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1632,
        16944
      ],
      "id": "9526496b-92db-44d6-adf5-c55ca4c507bd",
      "name": "Nombre Lista",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸŸ¢ Paso 1 de 4\nðŸ“ Â¿CÃ³mo se llama la lista?\n\n0ï¸âƒ£ Cancelar y salir\n\nðŸ‘‰ Escribe el nombre de la lista o envÃ­a 0 si prefieres cancelar el proceso ðŸ˜Š",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1792,
        16944
      ],
      "id": "802bf334-5b93-4c33-80f7-2af581f67ff7",
      "name": "Nombre Lista1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?gid=68281904#gid=68281904",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 68281904,
          "mode": "list",
          "cachedResultName": "Listas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=68281904"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1632,
        17136
      ],
      "id": "baa9f969-2e57-4666-b1b7-b1b821babc2e",
      "name": "Listas",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const listas = items\n  .filter(item => item.json && Object.keys(item.json).length > 0)\n  .map(item => ({\n    id: item.json.id_lista,\n    nombre_lista: item.json.nombre_lista,\n    tipo: item.json.tipo,\n    creado_por: item.json.creado_por\n  }));\n\nreturn [\n  {\n    json: {\n      total_listas: listas.length,\n      listas,\n      creado_por: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1824,
        17136
      ],
      "id": "732e802a-82bb-4ad0-acc8-f3542ee2aa1d",
      "name": "recorrer_listas"
    },
    {
      "parameters": {
        "chatId": "={{ $json.creado_por }}",
        "text": "=ðŸ“­ AÃºn no tienes listas registradas\n\nCuando quieras, puedes crear una nueva lista ðŸ“…âœ¨\n\nðŸ‘‰ Escribe 1 para registrar una lista o 9 para volver al menÃº principal\n\n1ï¸âƒ£ Crear una nueva lista\n2ï¸âƒ£ Consultar tus listas\n3ï¸âƒ£ Eliminar una lista\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2592,
        16848
      ],
      "id": "ea463529-0c79-42df-8f18-54e3b4374817",
      "name": "No Listas",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.creado_por }}",
        "text": "=ðŸ“‹ *Tus listas:*\n\n{{\n  $json.listas.map((l, i) =>\n`${['1ï¸âƒ£','2ï¸âƒ£','3ï¸âƒ£','4ï¸âƒ£','5ï¸âƒ£','6ï¸âƒ£','7ï¸âƒ£','8ï¸âƒ£','9ï¸âƒ£','ðŸ”Ÿ'][i] || 'ðŸ”¹'} *${l.nombre_lista}* (${l.tipo})\n${l.items.length\n  ? l.items.map(it => `- ${it}`).join('\\n')\n  : '- Sin items'}\n`\n  ).join('\\n')\n}}\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2576,
        17152
      ],
      "id": "90d25445-9088-464b-8d97-f859a3a712d2",
      "name": "Mis Listas",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Code in JavaScript5').item.json.creado_por }}",
        "text": "=Â¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Crear una nueva lista\n2ï¸âƒ£ Consultar tus listas\n3ï¸âƒ£ Eliminar una lista\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2880,
        16944
      ],
      "id": "0b14564f-1d3d-4606-88d5-264b632fd48a",
      "name": "Menu Listas2",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 578812490,
          "mode": "list",
          "cachedResultName": "Items_Lista",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=578812490"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1984,
        17136
      ],
      "id": "b7ff1568-4117-4c9b-a48f-410f04206b32",
      "name": "items_listas",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 1ï¸âƒ£ Traer listas desde el nodo recorrer_listas\nconst listas = $items(\"recorrer_listas\")[0].json.listas;\n\n// 2ï¸âƒ£ Traer todos los items desde Google Sheets\nconst itemsListas = $items(\"items_listas\").map(i => i.json);\n\n// 3ï¸âƒ£ Asociar items a cada lista\nconst listasConItems = listas.map(lista => {\n  const itemsDeLista = itemsListas\n    .filter(it => it.id_lista == lista.id)\n    .map(it => it.item);\n\n  return {\n    id: lista.id,\n    nombre_lista: lista.nombre_lista,\n    tipo: lista.tipo,\n    items: itemsDeLista\n  };\n});\n\n// 4ï¸âƒ£ Salida final\nreturn [\n  {\n    json: {\n      total_listas: listasConItems.length,\n      listas: listasConItems,\n      creado_por: $items(\"recorrer_listas\")[0].json.creado_por\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2144,
        17136
      ],
      "id": "e362ee7b-502e-4257-b193-32ae90a70c03",
      "name": "Code in JavaScript5"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 68281904,
          "mode": "list",
          "cachedResultName": "Listas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=68281904"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1664,
        17520
      ],
      "id": "e124c9e8-c3cb-4f94-9b55-352b54ffa66f",
      "name": "Listas1",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 1ï¸âƒ£ Filtrar listas vÃ¡lidas\nconst listas = items\n  .filter(item => item.json && Object.keys(item.json).length > 0)\n  .map((item, index) => ({\n    numero: index + 1,\n    id_lista: item.json.id_lista,\n    nombre_lista: item.json.nombre_lista,\n    tipo: item.json.tipo,\n    creado_por: item.json.creado_por\n  }));\n\n// 2ï¸âƒ£ Si no hay listas\nif (listas.length === 0) {\n  return [\n    {\n      json: {\n        mensaje: \"ðŸ“­ No tienes listas para borrar.\",\n        opciones: [],\n        total_listas: 0\n      }\n    }\n  ];\n}\n\n// 3ï¸âƒ£ Devolver opciones y listas\nreturn [\n  {\n    json: {\n      opciones: listas.map(l => l.numero).concat([9]), // 9 = volver / cancelar\n      listas,\n      total_listas: listas.length,\n      creado_por: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1840,
        17472
      ],
      "id": "92f5444a-d675-4761-8b49-eae975ab049d",
      "name": "RecorrerListas"
    },
    {
      "parameters": {
        "chatId": "={{ $json.creado_por }}",
        "text": "={{\n  \"ðŸ—‘ï¸ *Eliminar lista*\\n\\n\" +\n  \"âœï¸ Elige la lista que deseas eliminar:\\n\\n\" +\n  $json[\"listas\"].map(l =>\n    l.numero + \"ï¸âƒ£ *\" + l.nombre_lista + \"*\\n\" +\n    \"   ðŸ—‚ Tipo: \" + l.tipo + \"\\n\"\n  ).join(\"\\n\") +\n  \"\\nðŸ…¾ï¸ *0.* Cancelar\"\n}}\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2272,
        17648
      ],
      "id": "a5a2fd49-3c92-404b-af30-1eb3d08443f8",
      "name": "MisListas",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“­ AÃºn no tienes listas registradas.\n\nCuando quieras, puedes crear un nueva lista ðŸ“…âœ¨\n\nðŸ‘‰ Escribe 1 para registrar un habito o 9 para volver al menÃº principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2272,
        17488
      ],
      "id": "ed1e979a-7b8b-4822-a752-ed096da9663b",
      "name": "NoListas",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('RecorrerListas').item.json.creado_por }}",
        "text": "=Â¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Crear una nueva lista\n2ï¸âƒ£ Consultar tus listas\n3ï¸âƒ£ Eliminar una lista\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2528,
        17440
      ],
      "id": "a1dde324-b549-475f-b5f6-3eccfbbbbd40",
      "name": "MenuListas",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "2",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5872,
        15376
      ],
      "id": "2e798c55-fd7f-4b0c-9529-6f69e2e18925",
      "name": "Act Paso57",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "nombre_temporal": "={{ $('Telegram Trigger').item.json.message.text }}",
            "canal_temporal": "={{ $json.id_generado }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "n_citas",
              "displayName": "n_citas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "n_tareas",
              "displayName": "n_tareas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "n_habitos",
              "displayName": "n_habitos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "tipo_lista_temporal",
              "displayName": "tipo_lista_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_item_temporal",
              "displayName": "nombre_item_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6192,
        15312
      ],
      "id": "2de0b6b1-9ab2-44b8-b27f-8773349c554a",
      "name": "Almacenar15",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b321f78b-8819-4417-8c19-8cc290dbcec4",
              "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
              "rightValue": "0",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        5264,
        15200
      ],
      "id": "dfaae600-1bce-40f4-8110-2a0b98119a4b",
      "name": "If32"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5744,
        15104
      ],
      "id": "c02a88d1-c4bf-40c7-8aeb-51cbb2be5b94",
      "name": "Act Paso61",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5888,
        15104
      ],
      "id": "237510d1-0dc9-4870-9f62-0f2e10f01845",
      "name": "MenÃº Principal22",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âŒ Proceso cancelado\nðŸ”™ Regresando al menÃº principalâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5600,
        15104
      ],
      "id": "31a7e79f-2cf6-44b5-a72e-4e931c27660e",
      "name": "Cancelado16",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "3",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6128,
        15552
      ],
      "id": "cc7e3797-8c92-4684-aa6d-56e9d1898b9b",
      "name": "Act Paso62",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?gid=1173250165#gid=1173250165",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "motivo_temporal": "={{ $('Telegram Trigger').item.json.message.text }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "n_citas",
              "displayName": "n_citas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "n_tareas",
              "displayName": "n_tareas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6288,
        15552
      ],
      "id": "dc3c1076-233f-47a8-8d6d-7a067d2702c6",
      "name": "Almacenar19",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=â° Paso 3 de 4\nEscribe el nombre de tu primer Item para aÃ±adirlo a la lista\n\n\n0ï¸âƒ£ Cancelar y volver atrÃ¡s\n\nðŸ‘‰ Escribe el nombre del item o 0 para cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6432,
        15552
      ],
      "id": "eb9204ba-8387-4dd2-8306-76c3a1ea4140",
      "name": "Hora Cita3",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 2,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e818d0d0-c42e-4989-b4b5-a7d7fce3eefb",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 3,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f8ea4bb7-520a-4c4a-a25d-6d7b6fdca1a7",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 4,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        5632,
        15616
      ],
      "id": "1cc86a31-7d12-434e-80c6-17648003594b",
      "name": "Pasos Nueva Lista"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸŸ¢ Paso 2 de 4\nâ° Escribe el tipo de lista\n\n0ï¸âƒ£ Cancelar y salir\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6336,
        15312
      ],
      "id": "63979967-1270-430a-8620-13058ac19e9a",
      "name": "Tipopregunta",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "function generarId() {\n  return (\n    Date.now().toString(36) +\n    Math.random().toString(36).slice(2, 10)\n  );\n}\n\nreturn [\n  {\n    json: {\n      id_generado: generarId()\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        6064,
        15312
      ],
      "id": "3e5a9b4d-2385-436d-9b54-88f384bddb21",
      "name": "Code in JavaScript6"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "09570020-8341-48ef-b659-0c1e74ab5bdb",
              "leftValue": "={{ $('Telegram Trigger').item.json.message.text.toUpperCase() === 'FIN' }}",
              "rightValue": "=FIN",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        6032,
        15760
      ],
      "id": "2d6b8d96-2511-4466-8b04-f109f495b525",
      "name": "If33"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?gid=578812490#gid=578812490",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 578812490,
          "mode": "list",
          "cachedResultName": "Items_Lista",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=578812490"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_lista": "={{ $('Datos Temporales').item.json.canal_temporal }}",
            "item": "={{ $('Telegram Trigger').item.json.message.text }}",
            "id_item": "={{ $json.id_generado }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_item",
              "displayName": "id_item",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "id_lista",
              "displayName": "id_lista",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "item",
              "displayName": "item",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6384,
        15904
      ],
      "id": "fab0835b-2daa-4fed-8aec-6e03376e99a5",
      "name": "Append row in sheet3",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "function generarId() {\n  return (\n    Date.now().toString(36) +\n    Math.random().toString(36).slice(2, 10)\n  );\n}\n\nreturn [\n  {\n    json: {\n      id_generado: generarId()\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        6208,
        15904
      ],
      "id": "6b55e1c1-398d-4b87-8f23-a5232e34c260",
      "name": "Code in JavaScript7"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=â° Paso 4 de 4\nEscribe el nombre del Item para aÃ±adirlo.\nEscribe \"Fin\" para finalizar.\n\n\n0ï¸âƒ£ Cancelar y volver atrÃ¡s\n\nðŸ‘‰ Escribe el nombre del item o 0 para cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6560,
        15904
      ],
      "id": "f68f6e2a-4ef7-4c60-abc9-7e3f44c8671b",
      "name": "Hora Cita4",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "mode": "url",
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?gid=1173250165#gid=1173250165",
          "__regex": "https:\\/\\/(?:drive|docs)\\.google\\.com(?:\\/.*|)\\/d\\/([0-9a-zA-Z\\-_]+)(?:\\/.*|)"
        },
        "sheetName": {
          "__rl": true,
          "value": 68281904,
          "mode": "list",
          "cachedResultName": "Listas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=68281904"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_lista": "={{ $('Datos Temporales').item.json.canal_temporal }}",
            "nombre_lista": "={{ $('Datos Temporales').item.json.nombre_temporal }}",
            "tipo": "={{ $('Datos Temporales').item.json.motivo_temporal }}",
            "creado_por": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_lista",
              "displayName": "id_lista",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre_lista",
              "displayName": "nombre_lista",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "tipo",
              "displayName": "tipo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6576,
        15552
      ],
      "id": "814090b4-9d09-4ab4-9f9e-9541054da629",
      "name": "Append row in sheet4",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "nombre_temporal": "=  ",
            "canal_temporal": "=  ",
            "motivo_temporal": "  ",
            "paso_actual": "0",
            "pantalla_actual": "MENU_LISTAS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6240,
        15728
      ],
      "id": "c2ff96a8-3a00-4ab4-a6bf-a63e10b7fa87",
      "name": "Almacenar16",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "f3a835c5-fe8c-4cf2-877e-c42485575441",
              "leftValue": "={{ $('Obtener Usuarios').item.json.rol }}",
              "rightValue": "ADMIN",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1488,
        2320
      ],
      "id": "7bf2dfbb-dd4d-4c06-99d3-fef361808772",
      "name": "If34"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nâœ¨ Estoy atento, elige una opciÃ³n y seguimos ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1856,
        2336
      ],
      "id": "12adb94f-ca99-4f4f-a604-509a4192b908",
      "name": "MenÃº Principal21",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ’¬ No cuentas con permisos de administrador.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1648,
        2336
      ],
      "id": "428c89c0-d639-4c63-be42-ad50a9594e62",
      "name": "Hasta Luego2",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ“… Perfecto, entremos a tu agenda\n\nÂ¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Agendar una nueva cita\n2ï¸âƒ£ Consultar tu agenda\n3ï¸âƒ£ Reprogramar una cita\n4ï¸âƒ£ Cancelar una cita\n5ï¸âƒ£ Marcar una cita como completada\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        608,
        1568
      ],
      "id": "7d3937e5-7c89-41c2-8e05-2db1785d778d",
      "name": "MenÃº Agenda",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_AGENDA",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        448,
        1568
      ],
      "id": "4a1ec2df-2109-4acf-87f9-625942b8d711",
      "name": "MenÃº Agendar",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, ese nÃºmero no estÃ¡ dentro de las opciones disponibles.\n\nðŸ”¢ AsegÃºrate de que estÃ© dentro del menÃº, Â¡asÃ­ avanzamos sin problema!\n\n1ï¸âƒ£ Activar recordatorios\n2ï¸âƒ£ Desactivar recordatorios\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4992,
        13840
      ],
      "id": "247209d9-4d2c-437f-b3fd-cf608bfc84de",
      "name": "OPC Invalido22",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "799b6e2d-3eb6-4300-9d8f-97b1e1c66977",
              "leftValue": "={{ !isNaN($('Telegram Trigger').item.json.message.text) && ((Number($('Telegram Trigger').item.json.message.text) >= 1 && Number($('Telegram Trigger').item.json.message.text) <= 2) || Number($('Telegram Trigger').item.json.message.text) === 9)}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4832,
        14000
      ],
      "id": "4aee6a5f-266f-4f2a-ad30-56934398ad72",
      "name": "Veri OPC16"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "71c271e0-019e-4e32-8615-538d15e03717"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "d435da4b-0c9a-4275-bd74-0db70494c30a",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        5040,
        14096
      ],
      "id": "696cb63a-7a80-4f12-b9bd-45b0b3add131",
      "name": "Switch"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "f3a835c5-fe8c-4cf2-877e-c42485575441",
              "leftValue": "={{ $('Obtener Usuarios').item.json.rol }}",
              "rightValue": "ADMIN",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1184,
        2784
      ],
      "id": "1a07c2fb-0558-4c7c-a20b-8ab2755834ef",
      "name": "If35"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nâœ¨ Estoy atento, elige una opciÃ³n y seguimos ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1680,
        2912
      ],
      "id": "5e8080f1-7917-4c42-af21-6ce9f38e49c4",
      "name": "MenÃº Principal24",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola Davisson!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5872,
        13904
      ],
      "id": "b8bbcd8a-7c7c-4b6d-9b27-fa87da2b6e99",
      "name": "MenÃº Principal25",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ’¬ Recordatorios activados exitosamente.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5568,
        13952
      ],
      "id": "8cc5d1d6-b726-44ef-b95a-f7fb4427e786",
      "name": "Hasta Luego4",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola Davisson!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5840,
        14144
      ],
      "id": "d5306714-0694-4057-8e11-268d835fa6bd",
      "name": "MenÃº Principal26",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ’¬ Recordatorios desactivados exitosamente.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5616,
        14160
      ],
      "id": "8b900a81-f189-448e-858b-bfa244c77b55",
      "name": "Hasta Luego5",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5200,
        13952
      ],
      "id": "9bd31a0d-a35a-4857-9b45-414e3ef01dad",
      "name": "AYUDA1",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5184,
        14256
      ],
      "id": "aea5c423-d4bc-44d7-871e-a0533af73c38",
      "name": "AYUDA2",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?gid=92232691#gid=92232691",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 264345966,
          "mode": "list",
          "cachedResultName": "Configuracion",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=264345966"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Recordar_citas": "Si",
            "Recordar_habitos": "Si",
            "configurar": "siks"
          },
          "matchingColumns": [
            "configurar"
          ],
          "schema": [
            {
              "id": "Recordar_citas",
              "displayName": "Recordar_citas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Recordar_habitos",
              "displayName": "Recordar_habitos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "configurar",
              "displayName": "configurar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5408,
        13952
      ],
      "id": "6da951ea-55b5-4f90-9041-6628f9898b90",
      "name": "Update row in sheet1",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?gid=92232691#gid=92232691",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 264345966,
          "mode": "list",
          "cachedResultName": "Configuracion",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=264345966"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Recordar_citas": "No",
            "configurar": "siks",
            "Recordar_habitos": "No"
          },
          "matchingColumns": [
            "configurar"
          ],
          "schema": [
            {
              "id": "Recordar_citas",
              "displayName": "Recordar_citas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Recordar_habitos",
              "displayName": "Recordar_habitos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "configurar",
              "displayName": "configurar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5392,
        14240
      ],
      "id": "28ef224d-35cb-42f0-851f-a8b99c4c2fb8",
      "name": "Update row in sheet2",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?gid=92232691#gid=92232691",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 264345966,
          "mode": "list",
          "cachedResultName": "Configuracion",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=264345966"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1712,
        7440
      ],
      "id": "a3dcade5-dc41-44bf-a357-01b37bb92424",
      "name": "Get row(s) in sheet",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "bb05d206-b25b-476a-a880-b3512c1a8d29",
              "leftValue": "={{ $json.Recordar_citas }}",
              "rightValue": "Si",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -1520,
        7456
      ],
      "id": "c96a68bf-9c20-484c-bf75-3b5d163162f0",
      "name": "If36"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_CONFIG",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1488,
        2608
      ],
      "id": "33fa2376-460f-400a-979a-847b1a40dd17",
      "name": "MenÃº Admin1",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ’¬ No cuentas con permisos de administrador.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1440,
        2912
      ],
      "id": "0154a4a7-7be4-4247-a189-38052ce8d854",
      "name": "No admin",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Bienvenido, administrador.\nÂ¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Activar recordatorios.\n2ï¸âƒ£ Desactivar recordatorios.\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1648,
        2608
      ],
      "id": "dadcd952-9c73-438c-b526-0c0be2edb667",
      "name": "MenÃº Config",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Â¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Crear una nueva lista\n2ï¸âƒ£ Consultar tus listas\n3ï¸âƒ£ Eliminar una lista\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6672,
        15728
      ],
      "id": "5d520484-ecfb-4eed-88ca-18a3a0b90f84",
      "name": "MenÃº Listas1",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âœ… Â¡Listo! Tu lista ya estÃ¡ creada\nðŸ  Te llevo de regreso al menÃº principal ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6480,
        15728
      ],
      "id": "dfdf6190-2953-4bf2-8d67-07cf945e5476",
      "name": "Lista Creada",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Citas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1040,
        1712
      ],
      "id": "2a481ed5-5cc0-4324-bff3-3483674b12e4",
      "name": "Agenda12",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 963194097,
          "mode": "list",
          "cachedResultName": "Tareas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=963194097"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1184,
        1712
      ],
      "id": "e16cea8e-849a-4481-b129-ac7523a29759",
      "name": "Tareas4",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1067611566,
          "mode": "list",
          "cachedResultName": "Habitos",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1067611566"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1328,
        1712
      ],
      "id": "7ea2312b-5327-4cde-bcb3-76d9e8b24ce4",
      "name": "Habitos4",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ===============================\n// ENTRADAS (YA FILTRADAS POR USUARIO)\n// ===============================\nconst citasRaw = $items(\"Agenda12\").map(i => i.json);\nconst tareasRaw = $items(\"Tareas4\").map(i => i.json);\nconst habitosRaw = $items(\"Habitos4\").map(i => i.json);\n\n// ===============================\n// FILTRAR OBJETOS VACÃOS\n// ===============================\nconst citas = citasRaw.filter(c => c && Object.keys(c).length > 0);\nconst tareas = tareasRaw.filter(t => t && Object.keys(t).length > 0);\nconst habitos = habitosRaw.filter(h => h && Object.keys(h).length > 0);\n\n// ===============================\n// CONTADORES\n// ===============================\nconst reporte = {\n  citas: citas.length,\n  tareas: tareas.length,\n  habitos: habitos.length\n};\n\nconst hayRegistros =\n  reporte.citas > 0 ||\n  reporte.tareas > 0 ||\n  reporte.habitos > 0;\n\n// ===============================\n// MENSAJE BASE\n// ===============================\nlet mensaje = `â° *RECORDATORIO GENERAL*\\n\\n`;\n\n// ===============================\n// RESUMEN (SOLO SI HAY REGISTROS)\n// ===============================\nif (hayRegistros) {\n  mensaje += `ðŸ“Š *Resumen actual*\\n`;\n  mensaje += `ðŸ“… Citas registradas: *${reporte.citas}*\\n`;\n  mensaje += `ðŸ“ Tareas registradas: *${reporte.tareas}*\\n`;\n  mensaje += `ðŸ” HÃ¡bitos registrados: *${reporte.habitos}*\\n\\n`;\n}\n\n// ===============================\n// DETALLE CITAS\n// ===============================\nif (citas.length > 0) {\n  mensaje += `ðŸ“… *Tus citas*\\n`;\n  citas.forEach((c, index) => {\n    mensaje += `\\n${index + 1}ï¸âƒ£ *${c.nombre || 'Cita'}*\\n`;\n    mensaje += `ðŸ“† ${c.fecha || 'Sin fecha'}\\n`;\n    mensaje += `â° ${c.hora || 'Sin hora'}\\n`;\n  });\n  mensaje += `\\n\\n`;\n}\n\n// ===============================\n// DETALLE TAREAS\n// ===============================\nif (tareas.length > 0) {\n  mensaje += `ðŸ“ *Tus tareas*\\n`;\n  tareas.forEach((t, index) => {\n    mensaje += `\\n${index + 1}ï¸âƒ£ *${t.nombre || 'Tarea'}*\\n`;\n    mensaje += `ðŸ“Œ Prioridad: ${t.prioridad || 'No definida'}\\n`;\n    if (t.fecha) {\n      mensaje += `ðŸ“† ${t.fecha}\\n`;\n    }\n  });\n  mensaje += `\\n\\n`;\n}\n\n// ===============================\n// DETALLE HABITOS\n// ===============================\nif (habitos.length > 0) {\n  mensaje += `ðŸ” *Tus hÃ¡bitos*\\n`;\n  habitos.forEach((h, index) => {\n    mensaje += `\\n${index + 1}ï¸âƒ£ *${h.nombre || 'HÃ¡bito'}*\\n`;\n    mensaje += `ðŸ“… Frecuencia: ${h.frecuencia || 'No definida'}\\n`;\n  });\n  mensaje += `\\n\\n`;\n}\n\n// ===============================\n// MENSAJE FINAL\n// ===============================\nif (!hayRegistros) {\n  mensaje += `ðŸŽ‰ *No tienes pendientes registrados.*\\n`;\n  mensaje += `Disfruta tu dÃ­a ðŸ˜Œ`;\n} else {\n  mensaje += `ðŸ‘‰ *Tip:* Avanza poco a poco, lo importante es no parar ðŸ˜‰`;\n}\n\n// ===============================\n// SALIDA\n// ===============================\nreturn [\n  {\n    json: {\n      mensaje,\n      usuario: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1504,
        1712
      ],
      "id": "3e98d316-65a6-4204-a409-ae7a68543797",
      "name": "Code in JavaScript8"
    },
    {
      "parameters": {
        "chatId": "={{$json.usuario}}",
        "text": "={{$json.mensaje}}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1712,
        1712
      ],
      "id": "ac5eaa2f-285a-45f9-bf4c-3b72370272da",
      "name": "Recordatorio Usuario",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nâœ¨ Estoy atento, elige una opciÃ³n y seguimos ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2608,
        2160
      ],
      "id": "7be3810b-fb59-439d-a0d2-842b1083def0",
      "name": "MenÃº Principal23",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Â¡Listo! ðŸ˜„âœ¨\nEntonces mantenemos tu tarea tal como estÃ¡ ðŸ“âœ…",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6736,
        7328
      ],
      "id": "d4a79fac-fdbe-42df-b688-ee3d6cc98129",
      "name": "Mantenemos",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, ese nÃºmero no estÃ¡ dentro de las opciones disponibles.\n\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieres usar.\nðŸ”¢ AsegÃºrate de que estÃ© dentro del menÃº, Â¡asÃ­ avanzamos sin problema!\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nâœ¨ Estoy atento, elige una opciÃ³n y seguimos ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1904,
        1712
      ],
      "id": "25d559a8-62c7-4f61-8e20-c9272a45af31",
      "name": "MenÃº Principal27",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b321f78b-8819-4417-8c19-8cc290dbcec4",
              "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
              "rightValue": "0",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -576,
        18672
      ],
      "id": "610564d3-d92f-4bac-979c-c41b29218ec5",
      "name": "If37"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "canal_temporal": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -256,
        18528
      ],
      "id": "42e1cea5-2b20-4dfe-a4b3-81b8a62ded01",
      "name": "Act Paso58",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n9ï¸âƒ£ Salir\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -112,
        18528
      ],
      "id": "cc814859-9776-44f6-a74f-b9517f7821e3",
      "name": "MenÃº Principal28",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âŒ Proceso cancelado\nðŸ”™ Regresando al menÃº principalâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -400,
        18528
      ],
      "id": "46a1dcb2-5058-4200-8a59-9e6cc2411ea7",
      "name": "Cancelado15",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const opcion = Number($('Telegram Trigger').first().json.message.text);\nconst listas = $input.first().json.listas;\n\nif (opcion === 0) {\n  return [\n    { json: { accion: 'cancelar', mensaje: 'âŒ Proceso cancelado, regresando al menÃº principalâ€¦' } }\n  ];\n}\n\nconst listaSeleccionada = listas.find(h => h.numero === opcion);\n\nif (!listaSeleccionada) {\n  return [\n    { json: { accion: 'error', mensaje: 'âš ï¸ OpciÃ³n invÃ¡lida, intenta de nuevo.' } }\n  ];\n}\n\nreturn [\n  { json: { habito: listaSeleccionada } }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        288,
        18720
      ],
      "id": "a0e01bb0-d76a-4011-87d7-cc06d03fcd48",
      "name": "Seleccion5"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('RecorrerListas1').item.json.creado_por }}",
            "paso_actual": "2",
            "timestamp_ultima_inteacciÃ³n": "={{ new Date().toISOString() }}",
            "cita_edit": "={{ $json.lista.id }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        688,
        18720
      ],
      "id": "56b33065-47e0-4724-95d9-2bd8c9133307",
      "name": "Act Paso59",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ Number($('Datos Temporales').item.json.paso_actual) }}",
                    "rightValue": 2,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -320,
        18784
      ],
      "id": "a20c4f58-eed0-4365-9553-2666f71960c9",
      "name": "Pasos Cancelar3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "799b6e2d-3eb6-4300-9d8f-97b1e1c66977",
              "leftValue": "={{ !isNaN($('Telegram Trigger').item.json.message.text) && ((Number($('Telegram Trigger').item.json.message.text) >= 1 && Number($('Telegram Trigger').item.json.message.text) <= 2))}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        0,
        18960
      ],
      "id": "6cc6f48c-002a-4c8b-898f-9f1bf91c2c0e",
      "name": "Veri OPC17"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_LISTAS",
            "cita_edit": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        896,
        18944
      ],
      "id": "7fddafb2-429b-4799-be7e-209842ed0cf0",
      "name": "Act Paso60",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1173250165,
          "mode": "list",
          "cachedResultName": "estado_usuario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=1173250165"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
            "paso_actual": "0",
            "pantalla_actual": "MENU_SELECCION",
            "fecha_temporar": "={{\"\"}}",
            "timestamp_ultima_inteacciÃ³n": "={{\"\"}}",
            "hora_temporal": "={{\"\"}}",
            "nombre_temporal": "={{\"\"}}",
            "motivo_temporal": "={{\"\"}}",
            "cita_edit": "={{\"\"}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_inteacciÃ³n",
              "displayName": "timestamp_ultima_inteacciÃ³n",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_temporar",
              "displayName": "fecha_temporar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_temporal",
              "displayName": "hora_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_temporal",
              "displayName": "nombre_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo_temporal",
              "displayName": "motivo_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal_temporal",
              "displayName": "canal_temporal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cita_edit",
              "displayName": "cita_edit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        576,
        19184
      ],
      "id": "df1d6ccb-175e-473a-bacb-ebf7c4163979",
      "name": "Act Paso63",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ˜… Ups, {{ $('Telegram Trigger').item.json.message.chat.first_name }}, ese nÃºmero no estÃ¡ dentro de las opciones disponibles.\n\nðŸ”¢ AsegÃºrate de que estÃ© dentro del menÃº, Â¡asÃ­ avanzamos sin problema!\n\nâ— AtenciÃ³n: Â¿EstÃ¡ seguro que desea cancelar la cita ID {{ $json.cita_edit }}?\n\n1ï¸âƒ£ SÃ­, confirmar y eliminar el habito\n2ï¸âƒ£ No, mantener el habito\n\nâœ¨ Responde solo con el nÃºmero de la opciÃ³n que prefieras, Â¡yo me encargo del resto! ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        272,
        18880
      ],
      "id": "f293e95a-8f30-487d-ad64-76b8456e0f26",
      "name": "OPC Invalido23",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=ðŸ‘‹ Â¡Hola {{ $('Telegram Trigger').item.json.message.from.first_name }}!\nSoy AgendaBot ðŸ¤–âœ¨\n\nEstoy aquÃ­ para ayudarte a organizar tus citas, tareas y recordatorios de forma fÃ¡cil y sin enredos.\n\nðŸ•’ Puedes escribirme en cualquier momento.\nðŸ‘‰ Para continuar, solo escribe el nÃºmero de la opciÃ³n que quieras usar.\n\nðŸ“‹ MenÃº principal\n0ï¸âƒ£ Ayuda\n1ï¸âƒ£ Agenda (citas)\n2ï¸âƒ£ Tareas\n3ï¸âƒ£ Recordatorios\n4ï¸âƒ£ HÃ¡bitos\n5ï¸âƒ£ Listas\n6ï¸âƒ£ Reportes\n7ï¸âƒ£ ConfiguraciÃ³n\n8ï¸âƒ£ Administrador\n\nðŸš€ Elige una opciÃ³n y empezamos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        816,
        19136
      ],
      "id": "4020f917-1a87-4bdb-bd6e-e170276730db",
      "name": "MenÃº Principal29",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a2b4574-9baa-470b-8381-3d39d2a4bdcf",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28bf0d23-1b1a-425c-b18a-28d5c603944f",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        272,
        19120
      ],
      "id": "30d62bf2-0a45-4270-9635-23540067c803",
      "name": "DecisiÃ³n4"
    },
    {
      "parameters": {
        "chatId": "={{ $('RecorrerListas1').item.json.creado_por }}",
        "text": "=â— AtenciÃ³n: Â¿EstÃ¡ seguro que desea completar o cancelar la lista ID {{ $json.cita_edit }}?\n\n1ï¸âƒ£ SÃ­, confirmar y eliminar\n2ï¸âƒ£ No, mantener la lista\n\nâœ¨ Responde solo con el nÃºmero de la opciÃ³n que prefieras, Â¡yo me encargo del resto! ðŸ˜‰",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        832,
        18720
      ],
      "id": "358788df-6f98-4b0b-93ea-f5247842a216",
      "name": "ConfirmaciÃ³n Cancelar2",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "delete",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 68281904,
          "mode": "list",
          "cachedResultName": "Listas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=68281904"
        },
        "startIndex": "={{ $json.row_number }}"
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        720,
        18976
      ],
      "id": "d46189ad-b30a-4807-953b-fbe5291cd1d1",
      "name": "Delete rows or columns from sheet3",
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 68281904,
          "mode": "list",
          "cachedResultName": "Listas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=68281904"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id_lista",
              "lookupValue": "={{ $('Datos Temporales').item.json.cita_edit }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        496,
        19024
      ],
      "id": "63b7e765-9a64-40e8-a332-798d00bdafde",
      "name": "Agenda13",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b4356d95-f796-454b-9da3-c31f8fa82a3d",
              "leftValue": "={{ $json.accion }}",
              "rightValue": "error",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        448,
        18704
      ],
      "id": "6f179fc9-00ea-475c-906b-a21eb947ed37",
      "name": "If38"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âŒ Upsâ€¦ esa opciÃ³n no estÃ¡ disponible\n\nðŸ‘‰ Por favor, intenta nuevamente ingresando una opciÃ³n vÃ¡lida.\n\nðŸ”™ Si deseas cancelar el proceso, envÃ­a ðŸ…¾ï¸",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        720,
        18528
      ],
      "id": "0b23303d-eeb2-4ed1-8e11-66ab1cbea77b",
      "name": "Error5",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 68281904,
          "mode": "list",
          "cachedResultName": "Listas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LNz82mXSrIrIRHljBG4tocZuwK1aUQPP4UMAg2lafKw/edit#gid=68281904"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -32,
        18720
      ],
      "id": "38dc1df4-6820-4a24-ab21-fdfccd7c71c0",
      "name": "Habitos5",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "9iDP2YtGpxr7iF76",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=âœ… Lista eliminada con Ã©xito.\nâª Te estamos regresando al MenÃº de Listasâ€¦",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1072,
        18944
      ],
      "id": "3b05a8a3-9b68-4ab9-9c5c-432f7e2df597",
      "name": "MenÃº Habitos6",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=\nÂ¿QuÃ© te gustarÃ­a hacer ahora? ðŸ‘‡\n\n1ï¸âƒ£ Crear una nuevo habito\n2ï¸âƒ£ Consultar tus habitos\n3ï¸âƒ£ Eliminar un habito\n9ï¸âƒ£ Volver al menÃº principal\n\nâœï¸ Solo escribe el nÃºmero de la opciÃ³n que quieras usar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1264,
        18928
      ],
      "id": "61b7303f-586e-4560-ad2a-d27d07fb998a",
      "name": "MenÃº Habitos7",
      "webhookId": "fb324b51-9ffb-4a97-81b3-3eef0fb617f1",
      "credentials": {
        "telegramApi": {
          "id": "ypnhxurBHlbgesip",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 1ï¸âƒ£ Filtrar listas vÃ¡lidas\nconst listas = items\n  .filter(item => item.json && Object.keys(item.json).length > 0)\n  .map((item, index) => ({\n    numero: index + 1,\n    id_lista: item.json.id_lista,\n    nombre_lista: item.json.nombre_lista,\n    tipo: item.json.tipo,\n    creado_por: item.json.creado_por\n  }));\n\n// 2ï¸âƒ£ Si no hay listas\nif (listas.length === 0) {\n  return [\n    {\n      json: {\n        mensaje: \"ðŸ“­ No tienes listas para borrar.\",\n        opciones: [],\n        total_listas: 0\n      }\n    }\n  ];\n}\n\n// 3ï¸âƒ£ Devolver opciones y listas\nreturn [\n  {\n    json: {\n      opciones: listas.map(l => l.numero).concat([9]), // 9 = volver / cancelar\n      listas,\n      total_listas: listas.length,\n      creado_por: $('Telegram Trigger').first().json.message.chat.id\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        144,
        18720
      ],
      "id": "fd625af8-f006-49b0-88cb-fa61d48e0cd7",
      "name": "RecorrerListas1"
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Obtener Usuarios",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Existe?": {
      "main": [
        [
          {
            "node": "Permitido?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Crear Usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crear Usuario": {
      "main": [
        [
          {
            "node": "Temporal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener Usuarios": {
      "main": [
        [
          {
            "node": "Existe?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Permitido?": {
      "main": [
        [
          {
            "node": "Acceso Denegado",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Datos Temporales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Temporal": {
      "main": [
        [
          {
            "node": "MenÃº Principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Datos Temporales": {
      "main": [
        [
          {
            "node": "Principal?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PANTALLAS": {
      "main": [
        [
          {
            "node": "Veri OPC1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Veri OPC6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If29",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If17",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If19",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [
          {
            "node": "If9",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Veri OPC4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Veri OPC16",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Veri OPC11",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If25",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If27",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Veri OPC15",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If32",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If37",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Principal?": {
      "main": [
        [
          {
            "node": "SelecciÃ³n?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act MSeleccion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SelecciÃ³n?": {
      "main": [
        [
          {
            "node": "Veri OPC",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "PANTALLAS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Veri OPC": {
      "main": [
        [
          {
            "node": "OPC Invalido",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cual Pantalla?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act MSeleccion": {
      "main": [
        [
          {
            "node": "MenÃº Principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cual Pantalla?": {
      "main": [
        [
          {
            "node": "AYUDA",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "MenÃº Agendar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "MenÃº Tareas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agenda12",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "MenÃº Habitos",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "MenÃº Listas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If34",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If35",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [
          {
            "node": "Saliendo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AYUDA": {
      "main": [
        [
          {
            "node": "Mensaje Ayuda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Veri OPC1": {
      "main": [
        [
          {
            "node": "OPC Invalido1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "MenÃº Agenda3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Nueva Cita": {
      "main": [
        [
          {
            "node": "Fecha Cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "OPC Invalido2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pasos Nueva Cita": {
      "main": [
        [
          {
            "node": "Verificar Fecha",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Validar Hora",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Veri OPC2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Veri OPC3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso": {
      "main": [
        [
          {
            "node": "Almacenar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "OPC Invalido3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verificar Fecha": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso1": {
      "main": [
        [
          {
            "node": "Almacenar1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso2": {
      "main": [
        [
          {
            "node": "Almacenar2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso3": {
      "main": [
        [
          {
            "node": "Almacenar3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Cancelado1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pasos Nueva Cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Veri OPC2": {
      "main": [
        [
          {
            "node": "OPC Invalido4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Canales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso4": {
      "main": [
        [
          {
            "node": "Datos Temporales1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Veri OPC3": {
      "main": [
        [
          {
            "node": "OPC Invalido5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ConfirmaciÃ³n",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar": {
      "main": [
        [
          {
            "node": "Hora Cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar1": {
      "main": [
        [
          {
            "node": "Nombre Cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar2": {
      "main": [
        [
          {
            "node": "Motivo Cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validar Hora": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar4": {
      "main": [
        [
          {
            "node": "Act Paso4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar5": {
      "main": [
        [
          {
            "node": "Act Paso4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar6": {
      "main": [
        [
          {
            "node": "Act Paso4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar3": {
      "main": [
        [
          {
            "node": "Canal Cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Datos Temporales1": {
      "main": [
        [
          {
            "node": "ConfirmaciÃ³n Cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Canales": {
      "main": [
        [
          {
            "node": "Almacenar4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Almacenar5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Almacenar6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ConfirmaciÃ³n": {
      "main": [
        [
          {
            "node": "Cant Citas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso9",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancelado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "If21",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cant Citas": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet": {
      "main": [
        [
          {
            "node": "Act Paso5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso5": {
      "main": [
        [
          {
            "node": "Que deseas hacer?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Veri OPC4": {
      "main": [
        [
          {
            "node": "OPC Invalido6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pasos Nueva Cita1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pasos Nueva Cita1": {
      "main": [
        [
          {
            "node": "Act Paso6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso6": {
      "main": [
        [
          {
            "node": "MenÃº Agenda1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso7": {
      "main": [
        [
          {
            "node": "MenÃº Principal1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso8": {
      "main": [
        [
          {
            "node": "MenÃº Principal3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado": {
      "main": [
        [
          {
            "node": "Act Paso8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado1": {
      "main": [
        [
          {
            "node": "Act Paso7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso9": {
      "main": [
        [
          {
            "node": "Volver a empezar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agenda": {
      "main": [
        [
          {
            "node": "Recorrer Agenda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recorrer Agenda": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "No Citas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mi Agenda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Citas": {
      "main": [
        [
          {
            "node": "MenÃº Agenda2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mi Agenda": {
      "main": [
        [
          {
            "node": "MenÃº Agenda2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agenda1": {
      "main": [
        [
          {
            "node": "Recorrer Agenda1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recorrer Agenda1": {
      "main": [
        [
          {
            "node": "If7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mi Agenda1": {
      "main": [
        [
          {
            "node": "Act Paso10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MenÃº Agenda3": {
      "main": [
        [
          {
            "node": "Nueva Cita",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agenda",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agenda1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agenda3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agenda6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancelado4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agenda2": {
      "main": [
        [
          {
            "node": "Recorrer Agenda2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recorrer Agenda2": {
      "main": [
        [
          {
            "node": "Seleccion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pasos Reprogramar": {
      "main": [
        [
          {
            "node": "Agenda2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Verificar Fecha1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Validar Hora1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Seleccion": {
      "main": [
        [
          {
            "node": "If11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso11": {
      "main": [
        [
          {
            "node": "Fecha Cita Edit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "Cancelado2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pasos Reprogramar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso12": {
      "main": [
        [
          {
            "node": "MenÃº Principal2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado2": {
      "main": [
        [
          {
            "node": "Act Paso12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If5": {
      "main": [
        [
          {
            "node": "OPC Invalido7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso13": {
      "main": [
        [
          {
            "node": "Almacenar7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verificar Fecha1": {
      "main": [
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar7": {
      "main": [
        [
          {
            "node": "Hora Cita1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If6": {
      "main": [
        [
          {
            "node": "OPC Invalido8",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validar Hora1": {
      "main": [
        [
          {
            "node": "If6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso15": {
      "main": [
        [
          {
            "node": "Que deseas hacer?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row in sheet": {
      "main": [
        [
          {
            "node": "Act Paso15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If7": {
      "main": [
        [
          {
            "node": "No Citas1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mi Agenda1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Citas1": {
      "main": [
        [
          {
            "node": "MenÃº Agenda4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agenda3": {
      "main": [
        [
          {
            "node": "Recorrer Agenda3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recorrer Agenda3": {
      "main": [
        [
          {
            "node": "If8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mi Agenda2": {
      "main": [
        [
          {
            "node": "Act Paso14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Citas2": {
      "main": [
        [
          {
            "node": "MenÃº Agenda5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If8": {
      "main": [
        [
          {
            "node": "No Citas2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mi Agenda2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If9": {
      "main": [
        [
          {
            "node": "Cancelado3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pasos Cancelar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso16": {
      "main": [
        [
          {
            "node": "MenÃº Principal4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado3": {
      "main": [
        [
          {
            "node": "Act Paso16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agenda4": {
      "main": [
        [
          {
            "node": "Recorrer Agenda4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recorrer Agenda4": {
      "main": [
        [
          {
            "node": "Seleccion1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Seleccion1": {
      "main": [
        [
          {
            "node": "If12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso17": {
      "main": [
        [
          {
            "node": "ConfirmaciÃ³n Cancelar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pasos Cancelar": {
      "main": [
        [
          {
            "node": "Agenda4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Veri OPC5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Veri OPC5": {
      "main": [
        [
          {
            "node": "OPC Invalido9",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "DecisiÃ³n",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso18": {
      "main": [
        [
          {
            "node": "MenÃº Agenda7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso19": {
      "main": [
        [
          {
            "node": "MenÃº Principal5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DecisiÃ³n": {
      "main": [
        [
          {
            "node": "Agenda5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso19",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete rows or columns from sheet": {
      "main": [
        [
          {
            "node": "Act Paso18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agenda5": {
      "main": [
        [
          {
            "node": "Delete rows or columns from sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MenÃº Agenda7": {
      "main": [
        [
          {
            "node": "MenÃº Agenda6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso20": {
      "main": [
        [
          {
            "node": "MenÃº Principal6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado4": {
      "main": [
        [
          {
            "node": "Act Paso20",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agenda6": {
      "main": [
        [
          {
            "node": "Recorrer Agenda5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recorrer Agenda5": {
      "main": [
        [
          {
            "node": "If10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If10": {
      "main": [
        [
          {
            "node": "No Citas3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mi Agenda3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mi Agenda3": {
      "main": [
        [
          {
            "node": "Act Paso21",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Citas3": {
      "main": [
        [
          {
            "node": "MenÃº Agenda8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Saliendo": {
      "main": [
        [
          {
            "node": "Hasta Luego",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If11": {
      "main": [
        [
          {
            "node": "Error",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If12": {
      "main": [
        [
          {
            "node": "Error1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MenÃº Tareas": {
      "main": [
        [
          {
            "node": "MenÃº Tareas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Veri OPC6": {
      "main": [
        [
          {
            "node": "OPC Invalido10",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "MenÃº Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If13": {
      "main": [
        [
          {
            "node": "No Tareas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mis Tareas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If14": {
      "main": [
        [
          {
            "node": "No Tareas1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mis Tareas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If15": {
      "main": [
        [
          {
            "node": "No Tareas2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mi Agenda6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mi Agenda6": {
      "main": [
        [
          {
            "node": "Act Paso23",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso24": {
      "main": [
        [
          {
            "node": "MenÃº Principal7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado5": {
      "main": [
        [
          {
            "node": "Act Paso24",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Nueva Tarea": {
      "main": [
        [
          {
            "node": "Nombre Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MenÃº Tarea": {
      "main": [
        [
          {
            "node": "Nueva Tarea",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Tareas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Tareas1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Tareas2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancelado5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recorrer Tareas": {
      "main": [
        [
          {
            "node": "If13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Tareas": {
      "main": [
        [
          {
            "node": "MenÃº Tareas2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mis Tareas": {
      "main": [
        [
          {
            "node": "MenÃº Tareas2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tareas": {
      "main": [
        [
          {
            "node": "Recorrer Tareas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tareas1": {
      "main": [
        [
          {
            "node": "Recorrer Tareas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recorrer Tareas1": {
      "main": [
        [
          {
            "node": "If14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Tareas1": {
      "main": [
        [
          {
            "node": "MenÃº Tareas3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mis Tareas1": {
      "main": [
        [
          {
            "node": "Act Paso22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tareas2": {
      "main": [
        [
          {
            "node": "Recorrer Tareas2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recorrer Tareas2": {
      "main": [
        [
          {
            "node": "If15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Tareas2": {
      "main": [
        [
          {
            "node": "MenÃº Tareas4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If16": {
      "main": [
        [
          {
            "node": "OPC Invalido11",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso25",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso25": {
      "main": [
        [
          {
            "node": "Almacenar8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verificar Fecha2": {
      "main": [
        [
          {
            "node": "If16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso27": {
      "main": [
        [
          {
            "node": "Almacenar10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Veri OPC7": {
      "main": [
        [
          {
            "node": "OPC Invalido13",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prioridad",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso29": {
      "main": [
        [
          {
            "node": "Datos Temporales2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Veri OPC8": {
      "main": [
        [
          {
            "node": "OPC Invalido14",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ConfirmaciÃ³n1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar8": {
      "main": [
        [
          {
            "node": "Proridad",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar10": {
      "main": [
        [
          {
            "node": "Fecha Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar12": {
      "main": [
        [
          {
            "node": "Act Paso29",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar13": {
      "main": [
        [
          {
            "node": "Act Paso29",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar14": {
      "main": [
        [
          {
            "node": "Act Paso29",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Datos Temporales2": {
      "main": [
        [
          {
            "node": "ConfirmaciÃ³n Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ConfirmaciÃ³n1": {
      "main": [
        [
          {
            "node": "Cant Tareas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso32",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancelado6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet1": {
      "main": [
        [
          {
            "node": "Act Paso30",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Append row in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso30": {
      "main": [
        [
          {
            "node": "Que deseas hacer?2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso31": {
      "main": [
        [
          {
            "node": "MenÃº Principal8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado6": {
      "main": [
        [
          {
            "node": "Act Paso31",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso32": {
      "main": [
        [
          {
            "node": "Volver a empezar1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pasos Nueva Tarea": {
      "main": [
        [
          {
            "node": "Act Paso27",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Verificar Fecha2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Veri OPC7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Veri OPC8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prioridad": {
      "main": [
        [
          {
            "node": "Almacenar12",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Almacenar13",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Almacenar14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cant Tareas": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If17": {
      "main": [
        [
          {
            "node": "Cancelado7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pasos Cancelar1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso26": {
      "main": [
        [
          {
            "node": "MenÃº Principal9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado7": {
      "main": [
        [
          {
            "node": "Act Paso26",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agenda7": {
      "main": [
        [
          {
            "node": "Recorrer Tareas3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Seleccion2": {
      "main": [
        [
          {
            "node": "If18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso28": {
      "main": [
        [
          {
            "node": "ConfirmaciÃ³n Eliminar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pasos Cancelar1": {
      "main": [
        [
          {
            "node": "Agenda7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Veri OPC9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Veri OPC9": {
      "main": [
        [
          {
            "node": "OPC Invalido15",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "DecisiÃ³n1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso33": {
      "main": [
        [
          {
            "node": "MenÃº Tareas5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso34": {
      "main": [
        [
          {
            "node": "Mantenemos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DecisiÃ³n1": {
      "main": [
        [
          {
            "node": "Agenda8",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso34",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete rows or columns from sheet1": {
      "main": [
        [
          {
            "node": "Act Paso33",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agenda8": {
      "main": [
        [
          {
            "node": "Delete rows or columns from sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If18": {
      "main": [
        [
          {
            "node": "Error2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso28",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recorrer Tareas3": {
      "main": [
        [
          {
            "node": "Seleccion2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MenÃº Tareas5": {
      "main": [
        [
          {
            "node": "MenÃº Agenda9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If19": {
      "main": [
        [
          {
            "node": "Cancelado8",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pasos CambiarEstado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso35": {
      "main": [
        [
          {
            "node": "MenÃº Principal11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado8": {
      "main": [
        [
          {
            "node": "Act Paso35",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agenda9": {
      "main": [
        [
          {
            "node": "Recorrer Tareas4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Seleccion3": {
      "main": [
        [
          {
            "node": "If20",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso36": {
      "main": [
        [
          {
            "node": "ConfirmaciÃ³n Cambio Estado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Veri OPC10": {
      "main": [
        [
          {
            "node": "OPC Invalido16",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "DecisiÃ³n2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso37": {
      "main": [
        [
          {
            "node": "MenÃº Tareas6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso38": {
      "main": [
        [
          {
            "node": "MenÃº Principal12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DecisiÃ³n2": {
      "main": [
        [
          {
            "node": "Act Paso39",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso38",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If20": {
      "main": [
        [
          {
            "node": "Error3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso36",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recorrer Tareas4": {
      "main": [
        [
          {
            "node": "Seleccion3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MenÃº Tareas6": {
      "main": [
        [
          {
            "node": "MenÃº Agenda10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pasos CambiarEstado": {
      "main": [
        [
          {
            "node": "Agenda9",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Veri OPC10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso39": {
      "main": [
        [
          {
            "node": "Act Paso37",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If21": {
      "main": [
        [
          {
            "node": "Act Paso40",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Append row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso40": {
      "main": [
        [
          {
            "node": "Que deseas hacer?3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cant Citas1": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "If22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If22": {
      "main": [
        [
          {
            "node": "MenÃº Principal13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MenÃº Habitos": {
      "main": [
        [
          {
            "node": "MenÃº Habitos1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Veri OPC11": {
      "main": [
        [
          {
            "node": "OPC Invalido12",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Menu Habitos1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If23": {
      "main": [
        [
          {
            "node": "No Habitos",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mis Habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso43": {
      "main": [
        [
          {
            "node": "MenÃº Principal14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado9": {
      "main": [
        [
          {
            "node": "Act Paso43",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Menu Habitos1": {
      "main": [
        [
          {
            "node": "Nuevo Habito",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Habitos",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Habitos1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancelado9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Nuevo Habito": {
      "main": [
        [
          {
            "node": "NombreHabito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso45": {
      "main": [
        [
          {
            "node": "Almacenar11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Veri OPC13": {
      "main": [
        [
          {
            "node": "OPC Invalido19",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ConfirmaciÃ³n2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar11": {
      "main": [
        [
          {
            "node": "Frecuencia Habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ConfirmaciÃ³n2": {
      "main": [
        [
          {
            "node": "Cant Habitos",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso49",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancelado10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet2": {
      "main": [
        [
          {
            "node": "Act Paso47",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "Append row in sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso47": {
      "main": [
        [
          {
            "node": "Que deseas hacer?4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso48": {
      "main": [
        [
          {
            "node": "MenÃº Principal15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado10": {
      "main": [
        [
          {
            "node": "Act Paso48",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso49": {
      "main": [
        [
          {
            "node": "Volver a empezar2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Habitos": {
      "main": [
        [
          {
            "node": "Recorrer Habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recorrer Habitos": {
      "main": [
        [
          {
            "node": "If23",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Habitos": {
      "main": [
        [
          {
            "node": "MenÃº Habitos2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mis Habitos": {
      "main": [
        [
          {
            "node": "MenÃº Habitos2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If24": {
      "main": [
        [
          {
            "node": "No Habitos1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mis Habitos1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Habitos1": {
      "main": [
        [
          {
            "node": "Recorrer Habitos1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Habitos1": {
      "main": [
        [
          {
            "node": "MenÃº Habitos3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mis Habitos1": {
      "main": [
        [
          {
            "node": "Act Paso41",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pasos Nueva Habito": {
      "main": [
        [
          {
            "node": "Act Paso45",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Veri OPC14",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Validar Hora2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Veri OPC13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If25": {
      "main": [
        [
          {
            "node": "Cancelado11",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pasos Nueva Habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso42": {
      "main": [
        [
          {
            "node": "MenÃº Principal16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado11": {
      "main": [
        [
          {
            "node": "Act Paso42",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Veri OPC14": {
      "main": [
        [
          {
            "node": "OPC Invalido20",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso50",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso50": {
      "main": [
        [
          {
            "node": "Almacenar18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If26": {
      "main": [
        [
          {
            "node": "OPC Invalido17",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso44",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso44": {
      "main": [
        [
          {
            "node": "Almacenar9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar9": {
      "main": [
        [
          {
            "node": "Datos Temporales3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validar Hora2": {
      "main": [
        [
          {
            "node": "If26",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar18": {
      "main": [
        [
          {
            "node": "Hora Cita2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Datos Temporales3": {
      "main": [
        [
          {
            "node": "ConfirmaciÃ³n Habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cant Habitos": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If27": {
      "main": [
        [
          {
            "node": "Cancelado12",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pasos Cancelar2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso46": {
      "main": [
        [
          {
            "node": "MenÃº Principal17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado12": {
      "main": [
        [
          {
            "node": "Act Paso46",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Seleccion4": {
      "main": [
        [
          {
            "node": "If28",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso51": {
      "main": [
        [
          {
            "node": "ConfirmaciÃ³n Cancelar1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pasos Cancelar2": {
      "main": [
        [
          {
            "node": "Habitos2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Veri OPC12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Veri OPC12": {
      "main": [
        [
          {
            "node": "OPC Invalido18",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "DecisiÃ³n3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso52": {
      "main": [
        [
          {
            "node": "MenÃº Habitos4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso53": {
      "main": [
        [
          {
            "node": "MenÃº Principal18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DecisiÃ³n3": {
      "main": [
        [
          {
            "node": "Agenda11",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso53",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete rows or columns from sheet2": {
      "main": [
        [
          {
            "node": "Act Paso52",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agenda11": {
      "main": [
        [
          {
            "node": "Delete rows or columns from sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If28": {
      "main": [
        [
          {
            "node": "Error4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso51",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Habitos2": {
      "main": [
        [
          {
            "node": "Recorrer Habitos2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recorrer Habitos1": {
      "main": [
        [
          {
            "node": "If24",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recorrer Habitos2": {
      "main": [
        [
          {
            "node": "Seleccion4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MenÃº Habitos4": {
      "main": [
        [
          {
            "node": "MenÃº Habitos5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If29": {
      "main": [
        [
          {
            "node": "Cancelado13",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pasos Nueva Tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso54": {
      "main": [
        [
          {
            "node": "MenÃº Principal19",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado13": {
      "main": [
        [
          {
            "node": "Act Paso54",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agenda10": {
      "main": [
        [
          {
            "node": "Tareas3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tareas3": {
      "main": [
        [
          {
            "node": "Habitos3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Habitos3": {
      "main": [
        [
          {
            "node": "Usuarios",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Usuarios": {
      "main": [
        [
          {
            "node": "Code in JavaScript4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript4": {
      "main": [
        [
          {
            "node": "Hasta Luego1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MenÃº Listas": {
      "main": [
        [
          {
            "node": "Menu Listas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Veri OPC15": {
      "main": [
        [
          {
            "node": "OPC Invalido21",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Menu Listas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If30": {
      "main": [
        [
          {
            "node": "No Listas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mis Listas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso55": {
      "main": [
        [
          {
            "node": "MenÃº Principal20",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado14": {
      "main": [
        [
          {
            "node": "Act Paso55",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If31": {
      "main": [
        [
          {
            "node": "NoListas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "MisListas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Menu Listas1": {
      "main": [
        [
          {
            "node": "Nombre Lista",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Listas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Listas1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancelado14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Nombre Lista": {
      "main": [
        [
          {
            "node": "Nombre Lista1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Listas": {
      "main": [
        [
          {
            "node": "recorrer_listas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "recorrer_listas": {
      "main": [
        [
          {
            "node": "items_listas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Listas": {
      "main": [
        []
      ]
    },
    "Mis Listas": {
      "main": [
        [
          {
            "node": "Menu Listas2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "items_listas": {
      "main": [
        [
          {
            "node": "Code in JavaScript5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript5": {
      "main": [
        [
          {
            "node": "If30",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Listas1": {
      "main": [
        [
          {
            "node": "RecorrerListas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RecorrerListas": {
      "main": [
        [
          {
            "node": "If31",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MisListas": {
      "main": [
        [
          {
            "node": "Act Paso56",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NoListas": {
      "main": [
        [
          {
            "node": "MenuListas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso57": {
      "main": [
        [
          {
            "node": "Code in JavaScript6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar15": {
      "main": [
        [
          {
            "node": "Tipopregunta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If32": {
      "main": [
        [
          {
            "node": "Cancelado16",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pasos Nueva Lista",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso61": {
      "main": [
        [
          {
            "node": "MenÃº Principal22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado16": {
      "main": [
        [
          {
            "node": "Act Paso61",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso62": {
      "main": [
        [
          {
            "node": "Almacenar19",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar19": {
      "main": [
        [
          {
            "node": "Hora Cita3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pasos Nueva Lista": {
      "main": [
        [
          {
            "node": "Act Paso57",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso62",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If33",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript6": {
      "main": [
        [
          {
            "node": "Almacenar15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If33": {
      "main": [
        [
          {
            "node": "Almacenar16",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code in JavaScript7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript7": {
      "main": [
        [
          {
            "node": "Append row in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet3": {
      "main": [
        [
          {
            "node": "Hora Cita4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar16": {
      "main": [
        [
          {
            "node": "Lista Creada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If34": {
      "main": [
        [
          {
            "node": "Agenda10",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Hasta Luego2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Hasta Luego2": {
      "main": [
        [
          {
            "node": "MenÃº Principal21",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MenÃº Agendar": {
      "main": [
        [
          {
            "node": "MenÃº Agenda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Veri OPC16": {
      "main": [
        [
          {
            "node": "OPC Invalido22",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If35": {
      "main": [
        [
          {
            "node": "MenÃº Admin1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No admin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Hasta Luego4": {
      "main": [
        [
          {
            "node": "MenÃº Principal25",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Hasta Luego5": {
      "main": [
        [
          {
            "node": "MenÃº Principal26",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "AYUDA1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AYUDA2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AYUDA1": {
      "main": [
        [
          {
            "node": "Update row in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row in sheet1": {
      "main": [
        [
          {
            "node": "Hasta Luego4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AYUDA2": {
      "main": [
        [
          {
            "node": "Update row in sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row in sheet2": {
      "main": [
        [
          {
            "node": "Hasta Luego5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "If36",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If36": {
      "main": [
        [
          {
            "node": "Cant Citas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Hora Cita3": {
      "main": [
        [
          {
            "node": "Append row in sheet4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MenÃº Admin1": {
      "main": [
        [
          {
            "node": "MenÃº Config",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No admin": {
      "main": [
        [
          {
            "node": "MenÃº Principal24",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Lista Creada": {
      "main": [
        [
          {
            "node": "MenÃº Listas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agenda12": {
      "main": [
        [
          {
            "node": "Tareas4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tareas4": {
      "main": [
        [
          {
            "node": "Habitos4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Habitos4": {
      "main": [
        [
          {
            "node": "Code in JavaScript8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript8": {
      "main": [
        [
          {
            "node": "Recordatorio Usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Hasta Luego1": {
      "main": [
        [
          {
            "node": "MenÃº Principal23",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mantenemos": {
      "main": [
        [
          {
            "node": "MenÃº Principal10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recordatorio Usuario": {
      "main": [
        [
          {
            "node": "MenÃº Principal27",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If37": {
      "main": [
        [
          {
            "node": "Cancelado15",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pasos Cancelar3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso58": {
      "main": [
        [
          {
            "node": "MenÃº Principal28",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado15": {
      "main": [
        [
          {
            "node": "Act Paso58",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Seleccion5": {
      "main": [
        [
          {
            "node": "If38",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso59": {
      "main": [
        [
          {
            "node": "ConfirmaciÃ³n Cancelar2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pasos Cancelar3": {
      "main": [
        [
          {
            "node": "Habitos5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Veri OPC17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Veri OPC17": {
      "main": [
        [
          {
            "node": "OPC Invalido23",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "DecisiÃ³n4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso60": {
      "main": [
        [
          {
            "node": "MenÃº Habitos6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Act Paso63": {
      "main": [
        [
          {
            "node": "MenÃº Principal29",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DecisiÃ³n4": {
      "main": [
        [
          {
            "node": "Agenda13",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso63",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete rows or columns from sheet3": {
      "main": [
        [
          {
            "node": "Act Paso60",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agenda13": {
      "main": [
        [
          {
            "node": "Delete rows or columns from sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If38": {
      "main": [
        [
          {
            "node": "Error5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Act Paso59",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Habitos5": {
      "main": [
        [
          {
            "node": "RecorrerListas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MenÃº Habitos6": {
      "main": [
        [
          {
            "node": "MenÃº Habitos7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RecorrerListas1": {
      "main": [
        [
          {
            "node": "Seleccion5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "a4e12e5a-6646-4d98-a3eb-773e5fe78600",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9df5d91811fdb3d73aea278702e0fafc82772a4c193fde8132a4495c1e55230c"
  },
  "id": "TsQuzO-9SVymRHmKGfoil",
  "tags": []
}